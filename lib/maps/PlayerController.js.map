{"version":3,"file":"../PlayerController.js","sourceRoot":"../../src","sources":["PlayerController.coffee"],"names":[],"mappings":"AAAA,IAAA,OAAA,EAAA;;AAAA,OAAA,GAAU,OAAA,CAAQ,eAAR,CAAwB,CAAC;;AAEnC,MAAM,CAAC,OAAP,GAAuB;EAAN,MAAA,iBAAA,QAA+B,QAA/B;IACf,WAAa,CAAC,OAAD,CAAA;WACX,CAAA;MACA,IAAC,CAAA,aAAD,CAAe,OAAf;IAFW;;IAeb,WAAa,CAAA,CAAA;MACX,IAAA,CAAO,IAAC,CAAA,WAAR;eACE,IAAC,CAAA,WAAD,GAAe,QAAQ,CAAC,KAD1B;;IADW;;IAIb,UAAY,CAAC,CAAD,CAAA;aACV,IAAC,CAAA,SAAD,CAAW,CAAC,CAAC,MAAb,EAAqB,CAAC,MAAD,CAAA,GAAA;QACnB,IAAG,IAAC,CAAA,MAAM,CAAC,UAAR,CAAmB,MAAnB,CAAH;UACE,IAAC,CAAA,MAAM,CAAC,OAAR,GAAkB;AAClB,iBAAO,KAFT;;MADmB,CAArB;IADU;;IAKZ,uBAAyB,CAAC,CAAD,CAAA;aACvB,IAAC,CAAA,SAAD,CAAW,CAAC,CAAC,MAAb,EAAqB,CAAC,MAAD,CAAA,GAAA;AACnB,YAAA;QAAA,IAAG,MAAA,GAAS,IAAC,CAAA,MAAM,CAAC,iBAAR,CAA0B,MAA1B,CAAZ;UACE,IAAC,CAAA,MAAM,CAAC,cAAR,GAAyB;UACzB,IAAC,CAAA,MAAM,CAAC,eAAR,CAAwB,MAAxB;AACA,iBAAO,KAHT;SAAA,MAIK,IAAG,IAAC,CAAA,MAAM,CAAC,SAAR,CAAkB,MAAlB,CAAH;UACH,IAAC,CAAA,MAAM,CAAC,QAAR,GAAmB;AACnB,iBAAO,KAFJ;;MALc,CAArB;IADuB;;IASzB,SAAW,CAAC,MAAD,EAAQ,YAAR,CAAA;AACT,UAAA;AAAA,aAAM,MAAN;QACE,MAAA,GAAY,8BAAH,GACP,MAAM,CAAC,eADA,GAED,yBAAH,GACH,MAAM,CAAC,UADJ,GAEG,YAAA,CAAa,MAAb,CAAH,GACH,IADG,GAEG,mBAAH,GACH,MAAM,CAAC,IADJ,GAEG,yEAAH,GACH,MAAM,CAAC,OAAO,CAAC,GAAf,CAAmB,CAAnB,CAAqB,CAAC,UADnB,GAGH;MAZJ;aAaA;IAdS;;EAlCI;;EAIf,gBAAC,CAAA,UAAD,CACE;IAAA,MAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAA,CAAA;QACN,IAAG,IAAC,CAAA,MAAJ;iBACE,IAAC,CAAA,WAAD,CAAA,EADF;;MADM;IAAR,CADF;IAKA,WAAA,EACE;MAAA,MAAA,EAAQ,QAAA,CAAA,CAAA;QACN,IAAG,IAAC,CAAA,WAAJ;UACE,CAAA,CAAE,IAAC,CAAA,WAAH,CAAe,CAAC,EAAhB,CAAmB,OAAnB,EAA2B,IAAC,CAAA,QAAD,CAAU,yBAAV,CAA3B;iBACA,CAAA,CAAE,IAAC,CAAA,WAAH,CAAe,CAAC,EAAhB,CAAmB,WAAnB,EAA+B,IAAC,CAAA,QAAD,CAAU,YAAV,CAA/B,EAFF;;MADM;IAAR;EANF,CADF","sourcesContent":["Element = require('spark-starter').Element\n\nmodule.exports = class PlayerController extends Element\n  constructor: (options) ->\n    super()\n    @setProperties(options)\n  @properties\n    player:\n      change: ->\n        if @player\n          @setDefaults()\n\n    gameDisplay:\n      change: ->\n        if @gameDisplay\n          $(@gameDisplay).on('click',@callback('checkTargetOrSelectable'))\n          $(@gameDisplay).on('mouseover',@callback('checkFocus'))\n\n  setDefaults: ()->\n    unless @gameDisplay\n      @gameDisplay = document.body\n\n  checkFocus: (e)->\n    @_bubbleUp e.target, (target)=>\n      if @player.canFocusOn(target)\n        @player.focused = target\n        return true\n  checkTargetOrSelectable: (e)->\n    @_bubbleUp e.target, (target)=>\n      if action = @player.canTargetActionOn(target)\n        @player.selectedAction = action\n        @player.setActionTarget(target)\n        return true\n      else if @player.canSelect(target)\n        @player.selected = target\n        return true\n  _bubbleUp: (target,stopCallback)->\n    while target\n      target = if target._parallelio_obj?\n        target._parallelio_obj\n      else if target.parentNode?\n        target.parentNode\n      else if stopCallback(target)\n        null\n      else if target.tile?\n        target.tile\n      else if target.display?.get(0).parentNode?\n        target.display.get(0).parentNode\n      else\n        null\n    null  "]}