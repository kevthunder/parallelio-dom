(function(){var t,e=[].slice,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty,r=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};t="undefined"!=typeof module&&null!==module?module.exports={}:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio),null==t.Spark&&(t.Spark={}),t.strings={greekAlphabet:["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"],starNames:["Achernar","Maia","Atlas","Salm","Alnilam","Nekkar","Elnath","Thuban","Achird","Marfik","Auva","Sargas","Alnitak","Nihal","Enif","Torcularis","Acrux","Markab","Avior","Sarin","Alphard","Nunki","Etamin","Turais","Acubens","Matar","Azelfafage","Sceptrum","Alphekka","Nusakan","Fomalhaut","Tyl","Adara","Mebsuta","Azha","Scheat","Alpheratz","Peacock","Fornacis","Unukalhai","Adhafera","Megrez","Azmidiske","Segin","Alrai","Phad","Furud","Vega","Adhil","Meissa","Baham","Seginus","Alrisha","Phaet","Gacrux","Vindemiatrix","Agena","Mekbuda","Becrux","Sham","Alsafi","Pherkad","Gianfar","Wasat","Aladfar","Menkalinan","Beid","Sharatan","Alsciaukat","Pleione","Gomeisa","Wezen","Alathfar","Menkar","Bellatrix","Shaula","Alshain","Polaris","Graffias","Wezn","Albaldah","Menkent","Betelgeuse","Shedir","Alshat","Pollux","Grafias","Yed","Albali","Menkib","Botein","Sheliak","Alsuhail","Porrima","Grumium","Yildun","Albireo","Merak","Brachium","Sirius","Altair","Praecipua","Hadar","Zaniah","Alchiba","Merga","Canopus","Situla","Altarf","Procyon","Haedi","Zaurak","Alcor","Merope","Capella","Skat","Alterf","Propus","Hamal","Zavijah","Alcyone","Mesarthim","Caph","Spica","Aludra","Rana","Hassaleh","Zibal","Alderamin","Metallah","Castor","Sterope","Alula","Ras","Heze","Zosma","Aldhibah","Miaplacidus","Cebalrai","Sualocin","Alya","Rasalgethi","Hoedus","Aquarius","Alfirk","Minkar","Celaeno","Subra","Alzirr","Rasalhague","Homam","Aries","Algenib","Mintaka","Chara","Suhail","Ancha","Rastaban","Hyadum","Cepheus","Algieba","Mira","Chort","Sulafat","Angetenar","Regulus","Izar","Cetus","Algol","Mirach","Cursa","Syrma","Ankaa","Rigel","Jabbah","Columba","Algorab","Miram","Dabih","Tabit","Anser","Rotanev","Kajam","Coma","Alhena","Mirphak","Deneb","Talitha","Antares","Ruchba","Kaus","Corona","Alioth","Mizar","Denebola","Tania","Arcturus","Ruchbah","Keid","Crux","Alkaid","Mufrid","Dheneb","Tarazed","Arkab","Rukbat","Kitalpha","Draco","Alkalurops","Muliphen","Diadem","Taygeta","Arneb","Sabik","Kocab","Grus","Alkes","Murzim","Diphda","Tegmen","Arrakis","Sadalachbia","Kornephoros","Hydra","Alkurhah","Muscida","Dschubba","Tejat","Ascella","Sadalmelik","Kraz","Lacerta","Almaak","Naos","Dsiban","Terebellum","Asellus","Sadalsuud","Kuma","Mensa","Alnair","Nash","Dubhe","Thabit","Asterope","Sadr","Lesath","Maasym","Alnath","Nashira","Electra","Theemim","Atik","Saiph","Phoenix","Norma"]},function(e){t.Spark.Collection=e(),t.Spark.Collection.definition=e}(function(){return function(){function t(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}return t.prototype.changed=function(){},t.prototype.get=function(t){return this._array[t]},t.prototype.set=function(t,e){var n;return this._array[t]!==e&&(n=this.toArray(),this._array[t]=e,this.changed(n)),e},t.prototype.add=function(t){if(!this._array.includes(t))return this.push(t)},t.prototype.remove=function(t){var e,n;if(-1!==(e=this._array.indexOf(t)))return n=this.toArray(),this._array.splice(e,1),this.changed(n)},t.prototype.toArray=function(){return this._array.slice()},t.prototype.count=function(){return this._array.length},t.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],t.readListFunctions=["concat","filter","slice"],t.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],t.readFunctions.forEach(function(n){return t.prototype[n]=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],(i=this._array)[n].apply(i,t)}}),t.readListFunctions.forEach(function(n){return t.prototype[n]=function(){var t,i;return t=1<=arguments.length?e.call(arguments,0):[],this.copy((i=this._array)[n].apply(i,t))}}),t.writefunctions.forEach(function(n){return t.prototype[n]=function(){var t,i,r,o;return t=1<=arguments.length?e.call(arguments,0):[],i=this.toArray(),o=(r=this._array)[n].apply(r,t),this.changed(i),o}}),t.newSubClass=function(t,e){var i;return"object"==typeof t?(i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(this),Object.assign(i.prototype,t),new i(e)):new this(e)},t.prototype.copy=function(t){return null==t&&(t=this.toArray()),new this.constructor(t)},t.prototype.equals=function(t){return this.count()===(tyepeof("function"===t.count)?t.count():t.length)&&this.every(function(e,n){return t[n]===e})},t.prototype.getAddedFrom=function(t){return this._array.filter(function(e){return!t.includes(e)})},t.prototype.getRemovedFrom=function(t){return t.filter(function(t){return function(e){return!t.includes(e)}}(this))},t}()}),function(e){t.Spark.EventBind=e(),t.Spark.EventBind.definition=e}(function(){return function(){function t(t,e,n){this.event=t,this.target=e,this.callback=n,this.binded=!1}return t.prototype.bind=function(){if(!this.binded)if("function"==typeof this.target.addEventListener)this.target.addEventListener(this.event,this.callback);else if("function"==typeof this.target.addListener)this.target.addListener(this.event,this.callback);else{if("function"!=typeof this.target.on)throw new Error("No function to add event listeners was found");this.target.on(this.event,this.callback)}return this.binded=!0},t.prototype.unbind=function(){if(this.binded)if("function"==typeof this.target.removeEventListener)this.target.removeEventListener(this.event,this.callback);else if("function"==typeof this.target.removeListener)this.target.removeListener(this.event,this.callback);else{if("function"!=typeof this.target.off)throw new Error("No function to remove event listeners was found");this.target.off(this.event,this.callback)}return this.binded=!1},t.prototype.equals=function(t){return t.event===this.event&&t.target===this.target&&t.callback===this.callback},t.prototype.match=function(t,e){return t===this.event&&e===this.target},t}()}),function(e){t.Spark.Invalidator=e(),t.Spark.Invalidator.definition=e}(function(e){var n,i;return null==e&&(e={}),n=e.hasOwnProperty("EventBind")?e.EventBind:t.Spark.EventBind,i=function(t,e){var n,i;return i=t.findIndex(e),i>-1?(n=t[i],t.splice(i,1),n):null},function(){function t(t,e){this.property=t,this.obj=null!=e?e:null,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.invalidateCallback=function(t){return function(){return t.invalidate(),null}}(this)}return t.prototype.invalidate=function(){var t;return"function"==typeof this.property.invalidate?this.property.invalidate():(t="invalidate"+this.property.charAt(0).toUpperCase()+this.property.slice(1),"function"==typeof this.obj[t]?this.obj[t]():this.obj[this.property]=null)},t.prototype.unknown=function(){return"function"==typeof this.property.unknown?this.property.unknown():this.invalidate()},t.prototype.addEventBind=function(t,e,r){if(!this.invalidationEvents.some(function(n){return n.match(t,e)}))return this.invalidationEvents.push(i(this.recycled,function(n){return n.match(t,e)})||new n(t,e,r))},t.prototype.getUnknownCallback=function(t,e){return function(n){return function(){if(!n.unknowns.some(function(n){return n.prop===t&&n.target===e}))return n.unknowns.push({prop:t,target:e}),n.unknown()}}(this)},t.prototype.event=function(t,e){return null==e&&(e=this.obj),this.addEventBind(t,e,this.invalidateCallback)},t.prototype.value=function(t,e,n){return null==n&&(n=this.obj),this.event(e,n),t},t.prototype.prop=function(t,e){if(null==e&&(e=this.obj),"string"!=typeof t)throw new Error("Property name must be a string");return this.addEventBind(t+"Invalidated",e,this.getUnknownCallback(t,e)),this.value(e[t],t+"Updated",e)},t.prototype.propInitiated=function(t,e){var n;return null==e&&(e=this.obj),n=e.getPropertyInstance(t).initiated,n||this.event(t+"Updated",e),n},t.prototype.validateUnknowns=function(t,e){var n;return null==e&&(e=this.obj),n=this.unknowns,this.unknowns=[],n.forEach(function(t){return t.target[t.prop]})},t.prototype.isEmpty=function(){return 0===this.invalidationEvents.length},t.prototype.bind=function(){return this.invalidationEvents.forEach(function(t){return t.bind()})},t.prototype.recycle=function(t){var e,n;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=function(t){return function(){return t.recycled.forEach(function(t){return t.unbind()}),t.recycled=[]}}(this),"function"==typeof t?t.length>1?t(this,e):(n=t(this),e(),n):e},t.prototype.unbind=function(){return this.invalidationEvents.forEach(function(t){return t.unbind()})},t}()}),function(e){t.Spark.PropertyInstance=e(),t.Spark.PropertyInstance.definition=e}(function(n){var i;return null==n&&(n={}),i=n.hasOwnProperty("Invalidator")?n.Invalidator:t.Spark.Invalidator,function(){function t(t,e){this.property=t,this.obj=e,this.init()}return t.prototype.init=function(){return this.value=this.ingest(this.property.options.default),this.calculated=!1,this.initiated=void 0!==this.property.options.default,this.revalidateCallback=function(t){return function(){return t.get()}}(this)},t.prototype.get=function(){var t,e;return!1===this.property.options.get?void 0:"function"==typeof this.property.options.get?this.callOptionFunct("get"):(this.invalidator&&this.invalidator.validateUnknowns(),this.isActive()?(this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.value!==e&&(t?this.changed(e):"function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.property.getUpdateEventName(),[e]))),this.pendingChanges&&this.changed(this.pendingOld),this.output()):void(this.initiated=!0))},t.prototype.set=function(t){var e;return!1===this.property.options.set||("function"==typeof this.property.options.set?this.callOptionFunct("set",t):(t=this.ingest(t),this.revalidated(),this.value!==t&&(e=this.value,this.value=t,this.changed(e)))),this},t.prototype.invalidate=function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()&&null!=this.invalidator&&this.invalidator.unbind()),this},t.prototype.unknown=function(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this},t.prototype._invalidateNotice=function(){return this.isImmediate()?(this.get(),!1):("function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.property.getInvalidateEventName()),null!=this.getUpdater()&&this.getUpdater().bind(),!0)},t.prototype.destroy=function(){if(null!=this.invalidator)return this.invalidator.unbind()},t.prototype.callOptionFunct=function(){var t,n;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],"string"==typeof n&&(n=this.property.options[n]),"function"==typeof n.overrided&&t.push(function(t){return function(){var i;return i=1<=arguments.length?e.call(arguments,0):[],t.callOptionFunct.apply(t,[n.overrided].concat(e.call(i)))}}(this)),n.apply(this.obj,t)},t.prototype.isActive=function(){var t;return"boolean"==typeof this.property.options.active?this.property.options.active:"function"!=typeof this.property.options.active||(t=this.activeInvalidator||new i(this,this.obj),t.recycle(function(t){return function(e,n){return t.active=t.callOptionFunct("active",e),n(),t.active||e.isEmpty()?(e.unbind(),t.activeInvalidator=null):(t.invalidator=e,t.activeInvalidator=e,e.bind())}}(this)),this.active)},t.prototype.calcul=function(){return"function"==typeof this.property.options.calcul&&(this.invalidator||(this.invalidator=new i(this,this.obj)),this.invalidator.recycle(function(t){return function(e,n){return t.value=t.callOptionFunct("calcul",e),n(),e.isEmpty()?t.invalidator=null:e.bind()}}(this))),this.revalidated(),this.value},t.prototype.revalidated=function(){if(this.calculated=!0,this.initiated=!0,null!=this.getUpdater())return this.getUpdater().unbind()},t.prototype.getUpdater=function(){return void 0===this.updater&&(null!=this.property.options.updater?(this.updater=this.property.options.updater,"function"==typeof this.updater.getBinder&&(this.updater=this.updater.getBinder()),"function"!=typeof this.updater.bind||"function"!=typeof this.updater.unbind?this.updater=null:this.updater.callback=this.revalidateCallback):this.updater=null),this.updater},t.prototype.ingest=function(t){return"function"==typeof this.property.options.ingest?t=this.callOptionFunct("ingest",t):t},t.prototype.output=function(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value},t.prototype.changed=function(t){return this.isActive()?(this.pendingChanges=!1,this.pendingOld=void 0,"function"==typeof this.property.options.change&&this.callOptionFunct("change",t),"function"==typeof this.obj.emitEvent&&(this.obj.emitEvent(this.property.getUpdateEventName(),[t]),this.obj.emitEvent(this.property.getChangeEventName(),[t]))):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t)),this},t.prototype.isImmediate=function(){return!1!==this.property.options.immediate&&(!0===this.property.options.immediate||("function"==typeof this.property.options.immediate?this.callOptionFunct("immediate"):null==this.getUpdater()&&("function"==typeof this.obj.getListeners&&this.obj.getListeners(this.property.getChangeEventName()).length>0||"function"==typeof this.property.options.change)))},t.bind=function(t,e){var n;return n=e.name.charAt(0).toUpperCase()+e.name.slice(1),Object.defineProperty(t,e.name,{configurable:!0,get:function(){return e.getInstance(this).get()},set:function(t){return e.getInstance(this).set(t)}}),t["get"+n]=function(){return e.getInstance(this).get()},t["set"+n]=function(t){return e.getInstance(this).set(t),this},t["invalidate"+n]=function(){return e.getInstance(this).invalidate(),this}},t}()}),function(e){t.Spark.CollectionProperty=e(),t.Spark.CollectionProperty.definition=e}(function(e){var i,r;return null==e&&(e={}),r=e.hasOwnProperty("PropertyInstance")?e.PropertyInstance:t.Spark.PropertyInstance,i=e.hasOwnProperty("Collection")?e.Collection:t.Spark.Collection,function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.ingest=function(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]},e.prototype.output=function(){var t,e,n;return n=this.value,"function"==typeof this.property.options.output&&(n=this.callOptionFunct("output",this.value)),e=this,t=i.newSubClass(this.property.options.collection,n),t.changed=function(t){return e.changed(t)},t},e}(r)}),function(e){t.Spark.ComposedProperty=e(),t.Spark.ComposedProperty.definition=e}(function(e){var i,r,o,s;return null==e&&(e={}),s=e.hasOwnProperty("PropertyInstance")?e.PropertyInstance:t.Spark.PropertyInstance,o=e.hasOwnProperty("Invalidator")?e.Invalidator:t.Spark.Invalidator,i=e.hasOwnProperty("Collection")?e.Collection:t.Spark.Collection,r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.init=function(){return e.__super__.init.call(this),this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new e.Members(this.property.options.members),this.members.changed=function(t){return function(e){return t.invalidate()}}(this),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?e.joinFunctions.or:e.joinFunctions.and},e.prototype.calcul=function(){return this.invalidator||(this.invalidator=new o(this,this.obj)),this.invalidator.recycle(function(t){return function(e,n){return t.value=t.members.reduce(function(e,n){var i;return i="function"==typeof n?n(t.invalidator):n,t.join(e,i)},t.default),n(),e.isEmpty()?t.invalidator=null:e.bind()}}(this)),this.revalidated(),this.value},e.bind=function(t,e){return s.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})},e.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},e}(s),r.Members=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.addPropertyRef=function(t,e){var n;if(-1===this.findPropertyRefIndex(t,e))return n=function(n){return n.prop(t,e)},n.ref={name:t,obj:e},this.push(n)},e.prototype.findPropertyRefIndex=function(t,e){return this._array.findIndex(function(n){return null!=n.ref&&n.ref.obj===e&&n.ref.name===t})},e.prototype.removePropertyRef=function(t,e){var n,i;if(-1!==(n=this.findPropertyRefIndex(t,e)))return i=this.toArray(),this._array.splice(n,1),this.changed(i)},e}(i),r}),function(e){t.Spark.Property=e(),t.Spark.Property.definition=e}(function(e){var n,i,r;return null==e&&(e={}),r=e.hasOwnProperty("PropertyInstance")?e.PropertyInstance:t.Spark.PropertyInstance,n=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t.Spark.CollectionProperty,i=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t.Spark.ComposedProperty,function(){function t(t,e){this.name=t,this.options=null!=e?e:{}}return t.prototype.bind=function(t){var e,n;return n=this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,n),t._properties=(t._properties||[]).concat([n]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.checkFunctions(t),this.checkAfterAddListener(t)),n},t.prototype.override=function(t){var e,n,i,r;if(null==this.options.parent){this.options.parent=t.options,n=t.options,i=[];for(e in n)r=n[e],"function"==typeof this.options[e]&&"function"==typeof r?i.push(this.options[e].overrided=r):void 0===this.options[e]?i.push(this.options[e]=r):i.push(void 0);return i}},t.prototype.checkFunctions=function(e){var n,i,r,o;this.checkAfterAddListener(e),r=t.fn,o=[];for(i in r)n=r[i],void 0===e[i]?o.push(e[i]=n):o.push(void 0);return o},t.prototype.checkAfterAddListener=function(e){var n;if("function"==typeof e.addListener&&void 0===e.afterAddListener&&void 0===e.addListener.overrided)return e.afterAddListener=t.optionalFn.afterAddListener,n=e.addListener,e.addListener=function(t,e){return this.addListener.overrided.call(this,t,e),this.afterAddListener(t)},e.addListener.overrided=n},t.prototype.getInstanceVarName=function(){return this.options.instanceVarName||"_"+this.name},t.prototype.isInstantiated=function(t){return null!=t[this.getInstanceVarName()]},t.prototype.getInstance=function(t){var e,n;return n=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[n]=new e(this,t)),t[n]},t.prototype.getInstanceType=function(){return null!=this.options.composed?i:null!=this.options.collection?n:r},t.prototype.getChangeEventName=function(){return this.options.changeEventName||this.name+"Changed"},t.prototype.getUpdateEventName=function(){return this.options.changeEventName||this.name+"Updated"},t.prototype.getInvalidateEventName=function(){return this.options.changeEventName||this.name+"Invalidated"},t.fn={getProperty:function(t){return this._properties.find(function(e){return e.name===t})},getPropertyInstance:function(t){var e;if(e=this.getProperty(t))return e.getInstance(this)},getProperties:function(){return this._properties.slice()},getPropertyInstances:function(){return this._properties.map(function(t){return function(e){return e.getInstance(t)}}(this))},getInstantiatedProperties:function(){return this._properties.filter(function(t){return function(e){return e.isInstantiated(t)}}(this)).map(function(t){return function(e){return e.getInstance(t)}}(this))},setProperties:function(t,e){var n,i,r;null==e&&(e={});for(n in t)r=t[n],null!=e.whitelist&&-1===e.whitelist.indexOf(n)||null!=e.blacklist&&-1!==e.blacklist.indexOf(n)||null!=(i=this.getPropertyInstance(n))&&i.set(r);return this},destroyProperties:function(){return this.getInstantiatedProperties().forEach(function(t){return function(t){return t.destroy()}}()),this._properties=[],!0}},t.optionalFn={afterAddListener:function(t){return this._properties.forEach(function(e){return function(n){if(n.getChangeEventName()===t)return n.getInstance(e).get()}}(this))}},t}()}),function(e){t.Spark.Element=e(),t.Spark.Element.definition=e}(function(n){var i;return null==n&&(n={}),i=n.hasOwnProperty("Property")?n.Property:t.Spark.Property,function(){function t(){}return t.elementKeywords=["extended","included","__super__","constructor"],t.prototype.tap=function(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this},t.prototype.callback=function(t){return null==this._callbacks&&(this._callbacks={}),null!=this._callbacks[t]?this._callbacks[t]:this._callbacks[t]=function(n){return function(){var i;return i=1<=arguments.length?e.call(arguments,0):[],n[t].call(n,i),null}}(this)},t.extend=function(e){var n,i,o;for(n in e)o=e[n],r.call(t.elementKeywords,n)<0&&(this[n]=o);return null!=e.prototype&&this.include(e.prototype),null!=(i=e.extended)&&i.apply(this),this},t.include=function(e){var n,i,o,s,a,l;for(i in e)if(l=e[i],r.call(t.elementKeywords,i)<0)if("_properties"===i)for(n=0,o=l.length;n<o;n++)s=l[n],s.bind(this.prototype);else this.prototype[i]=l;return null!=(a=e.included)&&a.apply(this),this},t.property=function(t,e){return new i(t,e).bind(this.prototype)},t.properties=function(t){var e,n,i;i=[];for(n in t)e=t[n],i.push(this.property(n,e));return i},t}()}),function(e){t.Tile=e(),t.Tile.definition=e}(function(e){var i;return null==e&&(e={}),i=e.hasOwnProperty("Element")?e.Element:t.Spark.Element,function(t){function e(t,e){this.x=t,this.y=e,this.init()}return n(e,t),e.prototype.init=function(){return this.children=[]},e.prototype.getRelativeTile=function(t,e){return this.container.getTile(this.x+t,this.y+e)},e.prototype.addChild=function(t){var e;return e=this.children.indexOf(t),-1===e&&this.children.push(t),t.tile=this,t},e.prototype.removeChild=function(t){var e;if(e=this.children.indexOf(t),e>-1&&this.children.splice(e,1),t.tile===this)return t.tile=null},e}(i)}),function(e){t.Door=e(),t.Door.definition=e}(function(e){var i;return null==e&&(e={}),i=e.hasOwnProperty("Tiled")?e.Tiled:t.Tile,function(t){function e(t){this.direction=null!=t?t:e.directions.horizontal,e.__super__.constructor.call(this)}return n(e,t),e.properties({tile:{change:function(t,e){var n,i,r,o;if(e(),null!=t&&(null!=(n=t.walkableMembers)&&n.removePropertyRef("open",this),null!=(i=t.transparentMembers)&&i.removePropertyRef("open",this)),this.tile)return null!=(r=this.tile.walkableMembers)&&r.addPropertyRef("open",this),null!=(o=this.tile.transparentMembers)?o.addPropertyRef("open",this):void 0}},open:{default:!1},direction:{}}),e.directions={horizontal:"horizontal",vertical:"vertical"},e}(i)}),function(e){t.Element=e(),t.Element.definition=e}(function(e){return null==e&&(e={}),e.hasOwnProperty("Element")?e.Element:t.Spark.Element}),function(e){t.Floor=e(),t.Floor.definition=e}(function(e){var i;return null==e&&(e={}),i=e.hasOwnProperty("Tile")?e.Tile:t.Tile,function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.properties({walkable:{composed:!0},transparent:{composed:!0}}),e}(i)}),function(e){t.TileContainer=e(),t.TileContainer.definition=e}(function(e){var i;return null==e&&(e={}),i=e.hasOwnProperty("Element")?e.Element:t.Spark.Element,function(t){function e(){this.init()}return n(e,t),e.prototype.init=function(){return this.coords={},this.tiles=[]},e.prototype.addTile=function(t){return this.tiles.includes(t)||(this.tiles.push(t),null==this.coords[t.x]&&(this.coords[t.x]={}),this.coords[t.x][t.y]=t,t.container=this),this},e.prototype.getTile=function(t,e){var n;if(null!=(null!=(n=this.coords[t])?n[e]:void 0))return this.coords[t][e]},e.prototype.loadMatrix=function(t){var e,n,i,r,o;for(o in t){n=t[o];for(r in n)i=n[r],e={x:parseInt(r),y:parseInt(o)},"function"==typeof i?this.addTile(i(e)):(i.x=e.x,i.y=e.y,this.addTile(i))}return this},e.prototype.allTiles=function(){return this.tiles.slice()},e.prototype.clearAll=function(){var t,e,n,i;for(n=this.tiles,t=0,e=n.length;t<e;t++)i=n[t],i.container=null;return this.coords={},this.tiles=[],this},e}(i)}),function(e){t.RoomGenerator=e(),t.RoomGenerator.definition=e}(function(e){var i,o,s,a,l;return null==e&&(e={}),o=e.hasOwnProperty("Element")?e.Element:t.Spark.Element,l=e.hasOwnProperty("TileContainer")?e.TileContainer:t.TileContainer,a=e.hasOwnProperty("Tile")?e.Tile:t.Tile,i=e.hasOwnProperty("Door")?e.Door:t.Door,s=function(t){function e(t){this.setProperties(t),this.directions=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}],this.corners=[{x:1,y:1},{x:-1,y:-1},{x:-1,y:1},{x:1,y:-1}],this.allDirections=this.directions.concat(this.corners)}return n(e,t),e.properties({rng:{default:Math.random},maxVolume:{default:25},minVolume:{default:50},width:{default:30},height:{default:15},tiles:{calcul:function(){var t,e,n,i,r,o,s;for(r=new l,o=t=0,n=this.width;0<=n?t<=n:t>=n;o=0<=n?++t:--t)for(s=e=0,i=this.height;0<=i?e<=i:e>=i;s=0<=i?++e:--e)r.addTile(new a(o,s));return r}},floorFactory:{default:function(t){return new a(t.x,t.y)}},wallFactory:{default:null},doorFactory:{calcul:function(){return this.floorFactory}}}),e.prototype.init=function(){return this.finalTiles=null,this.rooms=[],this.free=this.tiles.allTiles().filter(function(t){return function(e){var n,i,r,o;for(o=t.allDirections,i=0,r=o.length;i<r;i++)if(n=o[i],null==t.tiles.getTile(e.x+n.x,e.y+n.y))return!1;return!0}}(this))},e.prototype.calcul=function(){var t;for(this.init(),t=0;this.step()||this.newRoom();)t++;return this.createDoors(),this.rooms,this.makeFinalTiles()},e.prototype.makeFinalTiles=function(){return this.finalTiles=this.tiles.allTiles().map(function(t){return function(t){var e;if(null!=t.factory)return e={x:t.x,y:t.y},null!=t.factoryOptions&&(e=Object.assign(e,t.factoryOptions)),t.factory(e)}}()).filter(function(t){return function(t){return null!=t}}())},e.prototype.getTiles=function(){return null==this.finalTiles&&this.calcul(),this.finalTiles},e.prototype.newRoom=function(){if(this.free.length)return this.volume=Math.floor(this.rng()*(this.maxVolume-this.minVolume))+this.minVolume,this.room=new e.Room},e.prototype.randomDirections=function(){var t,e,n,i;for(n=this.directions.slice(),e=void 0,i=void 0,t=n.length;t;)e=Math.floor(this.rng()*t),i=n[--t],n[t]=n[e],n[e]=i;return n},e.prototype.step=function(){var t,e;if(this.room){if(this.free.length&&this.room.tiles.length<this.volume-1){if(this.room.tiles.length){for(e=this.randomDirections(),t=!1;e.length&&!t;)t=this.expand(this.room,e.pop(),this.volume);return t||this.roomDone(),t}return this.allocateTile(this.randomFreeTile(),this.room),!0}return this.roomDone(),!1}},e.prototype.roomDone=function(){return this.rooms.push(this.room),this.allocateWalls(this.room),this.room=null},e.prototype.expand=function(t,e,n){var i,r,o,s,a,l,u;for(null==n&&(n=0),l=!1,s=t.tiles,i=0,r=s.length;i<r;i++)u=s[i],(0===n||t.tiles.length<n)&&((o=this.tileOffsetIsFree(u,e))&&(this.allocateTile(o,t),l=!0),(a=this.tileOffsetIsFree(u,e,2))&&!this.tileOffsetIsFree(u,e,3)&&this.allocateTile(a,t));return l},e.prototype.allocateWalls=function(t){var e,n,i,o,s,a,l,u,h;for(l=t.tiles,u=[],n=0,i=l.length;n<i;n++)h=l[n],u.push(function(){var n,i,l,u;for(l=this.allDirections,u=[],n=0,i=l.length;n<i;n++)e=l[n],o=this.tiles.getTile(h.x+e.x,h.y+e.y),null!=o&&o.room!==t?(r.call(this.corners,e)<0&&(a=this.tiles.getTile(h.x+2*e.x,h.y+2*e.y),s=null!=(null!=a?a.room:void 0)?a.room:null,t.addWall(o,s),null!=s&&s.addWall(o,t)),o.factory=this.wallFactory,u.push(this.allocateTile(o))):u.push(void 0);return u}.call(this));return u},e.prototype.createDoors=function(){var t,e,n,r,o,s,a;for(r=this.rooms,o=[],e=0,n=r.length;e<n;e++)s=r[e],o.push(function(){var e,n,r,o;for(r=s.wallsByRooms(),o=[],e=0,n=r.length;e<n;e++)a=r[e],null!=a.room&&s.doorsForRoom(a.room)<1?(t=a.tiles[Math.floor(this.rng()*a.tiles.length)],t.factory=this.doorFactory,t.factoryOptions={direction:this.tiles.getTile(t.x+1,t.y).factory===this.floorFactory?i.directions.vertical:i.directions.horizontal},s.addDoor(t,a.room),o.push(a.room.addDoor(t,s))):o.push(void 0);return o}.call(this));return o},e.prototype.allocateTile=function(t,e){var n;if(null==e&&(e=null),null!=e&&(e.addTile(t),t.factory=this.floorFactory),(n=this.free.indexOf(t))>-1)return this.free.splice(n,1)},e.prototype.tileOffsetIsFree=function(t,e,n){return null==n&&(n=1),this.tileIsFree(t.x+e.x*n,t.y+e.y*n)},e.prototype.tileIsFree=function(t,e){var n;return null!=(n=this.tiles.getTile(t,e))&&r.call(this.free,n)>=0&&n},e.prototype.randomFreeTile=function(){return this.free[Math.floor(this.rng()*this.free.length)]},e}(o),s.Room=function(){function t(){this.tiles=[],this.walls=[],this.doors=[]}return t.prototype.addTile=function(t){return this.tiles.push(t),t.room=this},t.prototype.containsWall=function(t){var e,n,i,r;for(i=this.walls,e=0,n=i.length;e<n;e++)if(r=i[e],r.tile===t)return r;return!1},t.prototype.addWall=function(t,e){var n;return n=this.containsWall(t),n?n.nextRoom=e:this.walls.push({tile:t,nextRoom:e})},t.prototype.wallsByRooms=function(){var t,e,n,i,r,o,s;for(o=[],r=[],i=this.walls,t=0,e=i.length;t<e;t++)s=i[t],n=o.indexOf(s.nextRoom),-1===n&&(n=o.length,o.push(s.nextRoom),r.push({room:s.nextRoom,tiles:[]})),r[n].tiles.push(s.tile);return r},t.prototype.addDoor=function(t,e){return this.doors.push({tile:t,nextRoom:e})},t.prototype.doorsForRoom=function(t){var e,n,i,r,o;for(o=[],r=this.doors,n=0,i=r.length;n<i;n++)e=r[n],e.nextRoom===t&&o.push(e.tile);return o},t}(),s}),function(e){t.Star=e(),t.Star.definition=e}(function(e){var i,r;return null==e&&(e={}),i=e.hasOwnProperty("Element")?e.Element:t.Spark.Element,r=function(t){function e(t,e){this.x=t,this.y=e,this.init()}return n(e,t),e.properties({x:{},y:{},links:{collection:{findStar:function(t){return this.find(function(e){return e.star2===t||e.star1===t})}}}}),e.prototype.init=function(){},e.prototype.linkTo=function(t){if(!this.links.findStar(t))return this.addLink(new this.constructor.Link(this,t))},e.prototype.addLink=function(t){return this.links.add(t),t.otherStar(this).links.add(t),t},e.prototype.dist=function(t,e){var n,i;return n=this.x-t,i=this.y-e,Math.sqrt(n*n+i*i)},e.collenctionFn={closest:function(t,e){var n,i;return n=null,i=null,this.forEach(function(r){var o;if(o=r.dist(t,e),null==n||i>o)return n=r,i=o}),n},closests:function(t,e){var n;return n=this.map(function(n){return{dist:n.dist(t,e),star:n}}),n.sort(function(t,e){return t.dist-e.dist}),this.copy(n.map(function(t){return t.star}))}},e}(i),r.Link=function(t){function e(t,e){this.star1=t,this.star2=e}return n(e,t),e.prototype.remove=function(){return this.star1.links.remove(this),this.star2.links.remove(this)},e.prototype.otherStar=function(t){return t===this.star1?this.star2:this.star1},e.prototype.getLength=function(){return this.star1.dist(this.star2.x,this.star2.y)},e.prototype.inBoundaryBox=function(t,e,n){var i,r,o,s;return null==n&&(n=0),i=Math.min(this.star1.x,this.star2.x)-n,o=Math.min(this.star1.y,this.star2.y)-n,r=Math.max(this.star1.x,this.star2.x)+n,s=Math.max(this.star1.y,this.star2.y)+n,t>=i&&t<=r&&e>=o&&e<=s},e.prototype.closeToPoint=function(t,e,n){var i,r,o,s,a,l,u,h,p,c,f;return!!this.inBoundaryBox(t,e,n)&&(i=this.star1,l=this.star2,u={x:t,y:e},h=l.x-i.x,c=l.y-i.y,Math.sqrt(h*h+c*c),o=Math.atan(c/h),p=u.x-i.x,f=u.y-i.y,s=Math.sqrt(p*p+f*f),a=Math.atan(f/p),
r=o-a,Math.abs(Math.sin(r)*s)<=n)},e.prototype.intersectLink=function(t){var e,n,i,r,o,s,a,l,u,h,p,c,f,d;return a=this.star1.x,p=this.star1.y,l=this.star2.x,c=this.star2.y,u=t.star1.x,f=t.star1.y,h=t.star2.x,d=t.star2.y,n=l-a,i=c-p,r=h-u,o=d-f,e=(-i*(a-u)+n*(p-f))/(-r*i+n*o),s=(r*(p-f)-o*(a-u))/(-r*i+n*o),e>0&&e<1&&s>0&&s<1},e}(i),r}),function(e){t.PathFinder=e(),t.PathFinder.definition=e}(function(e){var i,r;return null==e&&(e={}),i=e.hasOwnProperty("Element")?e.Element:t.Spark.Element,r=function(t){function e(t,e,n,i){this.tilesContainer=t,this.from=e,this.to=n,null==i&&(i={}),this.reset(),null!=i.validTile&&(this.validTileCallback=i.validTile)}return n(e,t),e.properties({validTileCallback:{}}),e.prototype.reset=function(){return this.queue=[],this.paths={},this.solution=null,this.started=!1},e.prototype.calcul=function(){for(;!this.solution&&(!this.started||this.queue.length);)this.step();return this.getPath()},e.prototype.step=function(){var t;return this.queue.length?(t=this.queue.pop(),this.addNextSteps(t),!0):this.started?void 0:(this.started=!0,this.addNextSteps(),!0)},e.prototype.getPath=function(){var t,e;if(this.solution){for(t=[this.solution],e=this.solution;null!=e.prev;)t.unshift(e.prev),e=e.prev;return t}},e.prototype.getPosAtTime=function(t){var e,n;if(this.solution){if(t>=this.solution.getTotalLength())return this.solution.posToTileOffset(this.solution.getExit().x,this.solution.getExit().y);for(n=this.solution;n.getStartLength()>t&&null!=n.prev;)n=n.prev;return e=(t-n.getStartLength())/n.getLength(),n.posToTileOffset(n.getEntry().x+(n.getExit().x-n.getEntry().x)*e,n.getEntry().y+(n.getExit().y-n.getEntry().y)*e)}},e.prototype.tileIsValid=function(t){return null!=this.validTileCallback?this.validTileCallback(t):!t.emulated||0!==t.tile&&!1!==t.tile},e.prototype.getTile=function(t,e){var n;return null!=this.tilesContainer.getTile?this.tilesContainer.getTile(t,e):null!=(null!=(n=this.tilesContainer[e])?n[t]:void 0)?{x:t,y:e,tile:this.tilesContainer[e][t],emulated:!0}:void 0},e.prototype.getConnectedToTile=function(t){var e,n;return null!=t.getConnected?t.getConnected():(e=[],(n=this.getTile(t.x+1,t.y))&&e.push(n),(n=this.getTile(t.x-1,t.y))&&e.push(n),(n=this.getTile(t.x,t.y+1))&&e.push(n),(n=this.getTile(t.x,t.y-1))&&e.push(n),e)},e.prototype.addNextSteps=function(t){var n,i,r,o,s,a;for(null==t&&(t=null),a=null!=t?t.nextTile:this.from,o=this.getConnectedToTile(a),s=[],n=0,i=o.length;n<i;n++)r=o[n],this.tileIsValid(r)?s.push(this.addStep(new e.Step(this,null!=t?t:null,a,r))):s.push(void 0);return s},e.prototype.tileEqual=function(t,e){return t===e||(t.emulated||e.emulated)&&t.x===e.x&&t.y===e.y},e.prototype.addStep=function(t){if(null==this.paths[t.getExit().x]&&(this.paths[t.getExit().x]={}),!(null!=this.paths[t.getExit().x][t.getExit().y]&&this.paths[t.getExit().x][t.getExit().y].getTotalLength()<=t.getTotalLength())&&(null!=this.paths[t.getExit().x][t.getExit().y]&&this.removeStep(this.paths[t.getExit().x][t.getExit().y]),this.paths[t.getExit().x][t.getExit().y]=t,this.queue.splice(this.getStepRank(t),0,t),this.tileEqual(t.nextTile,this.to)&&!(null!=this.solution&&this.solution.prev.getTotalLength()<=t.getTotalLength())))return this.solution=new e.Step(this,t,t.nextTile,null)},e.prototype.removeStep=function(t){var e;if((e=this.queue.indexOf(t))>-1)return this.queue.splice(e,1)},e.prototype.best=function(){return this.queue[this.queue.length-1]},e.prototype.getStepRank=function(t){return 0===this.queue.length?0:this._getStepRank(t.getEfficiency(),0,this.queue.length-1)},e.prototype._getStepRank=function(t,e,n){var i,r;return r=Math.floor((n-e)/2)+e,i=this.queue[r].getEfficiency(),i===t?r:i>t?r===e?e:this._getStepRank(t,e,r-1):r===n?n+1:this._getStepRank(t,r+1,n)},e}(i),r.Step=function(){function t(t,e,n,i){this.pathFinder=t,this.prev=e,this.tile=n,this.nextTile=i}return t.prototype.posToTileOffset=function(t,e){var n;return n=Math.floor(t)===this.tile.x&&Math.floor(e)===this.tile.y?this.tile:Math.floor(t)===this.nextTile.x&&Math.floor(e)===this.nextTile.y?this.nextTile:null!=this.prev&&Math.floor(t)===this.prev.tile.x&&Math.floor(e)===this.prev.tile.y?this.prev.tile:console.log("Math.floor("+t+") == "+this.tile.x,"Math.floor("+e+") == "+this.tile.y,this),{x:t,y:e,tile:n,offsetX:t-n.x,offsetY:e-n.y}},t.prototype.getExit=function(){return null==this.exit&&(null!=this.nextTile?this.exit={x:(this.tile.x+this.nextTile.x+1)/2,y:(this.tile.y+this.nextTile.y+1)/2}:this.exit={x:this.tile.x+.5,y:this.tile.y+.5}),this.exit},t.prototype.getEntry=function(){return null==this.entry&&(null!=this.prev?this.entry={x:(this.tile.x+this.prev.tile.x+1)/2,y:(this.tile.y+this.prev.tile.y+1)/2}:this.entry={x:this.tile.x+.5,y:this.tile.y+.5}),this.entry},t.prototype.getLength=function(){return null==this.length&&(this.length=null==this.nextTile||null==this.prev?.5:this.prev.tile.x===this.nextTile.x||this.prev.tile.y===this.nextTile.y?1:Math.sqrt(.5)),this.length},t.prototype.getStartLength=function(){return null==this.startLength&&(this.startLength=null!=this.prev?this.prev.getTotalLength():0),this.startLength},t.prototype.getTotalLength=function(){return null==this.totalLength&&(this.totalLength=this.getStartLength()+this.getLength()),this.totalLength},t.prototype.getEfficiency=function(){return null==this.efficiency&&(this.efficiency=1.1*-this.getRemaining()-this.getTotalLength()),this.efficiency},t.prototype.getRemaining=function(){var t,e,n,i;return null==this.remaining&&(t=this.getExit(),e={x:this.pathFinder.to.x+.5,y:this.pathFinder.to.y+.5},n=e.x-t.x,i=e.y-t.y,this.remaining=Math.sqrt(n*n+i*i)),this.remaining},t}(),r}),function(e){t.Tiled=e(),t.Tiled.definition=e}(function(e){var i;return null==e&&(e={}),i=e.hasOwnProperty("Element")?e.Element:t.Spark.Element,function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.properties({tile:{change:function(t){if(null!=t&&t.removeChild(this),this.tile)return this.tile.addChild(this)}}}),e}(i)}),function(e){t.Spark.Updater=e(),t.Spark.Updater.definition=e}(function(){var t;return t=function(){function t(){this.callbacks=[]}return t.prototype.update=function(){return this.callbacks.slice().forEach(function(t){return t()})},t.prototype.addCallback=function(t){if(!this.callbacks.includes(t))return this.callbacks.push(t)},t.prototype.removeCallback=function(t){var e;if(-1!==(e=this.callbacks.indexOf(t)))return this.callbacks.splice(e,1)},t.prototype.getBinder=function(){return new t.Binder(this)},t}(),t.Binder=function(){function t(t){this.target=t,this.binded=!1}return t.prototype.bind=function(){return this.binded||null==this.callback||this.target.addCallback(this.callback),this.binded=!0},t.prototype.unbind=function(){return this.binded&&null!=this.callback&&this.target.removeCallback(this.callback),this.binded=!1},t}(),t})}).call(this),function(){var t,e,n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;t="undefined"!=typeof module&&null!==module?(e=module.exports,null==e.DOM&&(e.DOM={}),e.DOM):(e=this.Parallelio,null==this.Parallelio.DOM&&(this.Parallelio.DOM={}),this.Parallelio.DOM),function(e){t.Updater=e(),t.Updater.definition=e}(function(t){var i,r;return null==t&&(t={}),i=t.hasOwnProperty("BaseUpdater")?t.BaseUpdater:e.Spark.Updater,r=function(t){function e(){e.__super__.constructor.call(this),this.updateCallback=function(t){return function(){return t.update()}}(this),this.binded=!1}return n(e,t),e.prototype.update=function(){for(;;){if(0===this.callbacks.length)break;this.callbacks[0]()}return this.binded=!1},e.prototype.requestFrame=function(){if(!this.binded)return window.requestAnimationFrame(this.updateCallback),this.binded=!0},e.prototype.addCallback=function(t){return e.__super__.addCallback.call(this,t),this.requestFrame()},e}(i),r.instance=new r,r}),function(e){t.Display=e(),t.Display.definition=e}(function(i){var r,o;return null==i&&(i={}),r=i.hasOwnProperty("Element")?i.Element:e.Element,o=i.hasOwnProperty("Updater")?i.Updater:t.Updater,function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.include(EventEmitter.prototype),e.prototype.initDisplay=function(){return this.displayContainer},e.properties({displayContainer:{updater:o.instance,change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},cls:{updater:o.instance,change:function(t){if(this.getPropertyInstance("display").calculated&&(null!=t&&this.display.removeClass(t),null!=this.cls))return this.display.addClass(this.cls)}},display:{calcul:function(){var t,e;return e=document.createElement("div"),t=jQuery(e).addClass(this.baseCls).addClass(this.cls).css({top:this.displayY,left:this.displayX}),t.get(0)._parallelio_obj=this,t}},displayX:{updater:o.instance,default:0,change:function(t){if(this.getPropertyInstance("display").calculated)return this.display.css({left:this.displayX})}},displayY:{updater:o.instance,default:0,change:function(t){if(this.getPropertyInstance("display").calculated)return this.display.css({top:this.displayY})}}}),e}(r)}),function(e){t.Tiled=e(),t.Tiled.definition=e}(function(i){var r,o;return null==i&&(i={}),r=i.hasOwnProperty("BaseTiled")?i.BaseTiled:e.Tiled,o=i.hasOwnProperty("Display")?i.Display:t.Display,function(t){function e(){e.__super__.constructor.call(this),this.initDisplay()}return n(e,t),e.extend(o),e.include(EventEmitter.prototype),e.properties({displayContainer:{calcul:function(t){var e;if(null!=(e=t.prop("tile")))return t.prop("displayContainer",e)}},displayX:{calcul:function(t){var e;return null!=(e=t.prop("tile"))?e.displayX:void 0}},displayY:{calcul:function(t){var e;return null!=(e=t.prop("tile"))?e.displayY:void 0}}}),e}(r)}),function(e){t.Door=e(),t.Door.definition=e}(function(i){var r,o,s;return null==i&&(i={}),o=i.hasOwnProperty("Tiled")?i.Tiled:t.Tiled,r=i.hasOwnProperty("BaseDoor")?i.BaseDoor:e.Door.definition({Tiled:o}),s=i.hasOwnProperty("Updater")?i.Updater:t.Updater,function(t){function e(t){this.baseCls="door",e.__super__.constructor.call(this,t)}return n(e,t),e.properties({direction:{updater:s.instance,active:function(t){return t.propInitiated("display")},change:function(t){if(null!=t&&this.display.removeClass(t),null!=this.direction)return this.display.addClass(this.direction)}}}),e}(r)}),function(e){t.Tile=e(),t.Tile.definition=e}(function(i){var r,o,s,a;return null==i&&(i={}),r=i.hasOwnProperty("BaseTile")?i.BaseTile:e.Tile,s=i.hasOwnProperty("Floor")?i.Floor:e.Floor,o=i.hasOwnProperty("Display")?i.Display:t.Display,a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.extend(o),e.size=20,e.prototype.init=function(){return e.__super__.init.call(this),this.baseCls="tile",this.initDisplay()},e.properties({container:{},displayContainer:{calcul:function(t){var e;return e=t.prop("container"),(null!=e?e.getProperty("tileDisplay"):void 0)?t.prop("tileDisplay",e):(null!=e?e.getProperty("display"):void 0)?t.prop("display",e):void 0}},displayX:{calcul:function(t){return this.tileToDisplayX(t.prop("x"))}},displayY:{calcul:function(t){return this.tileToDisplayY(t.prop("y"))}}}),e.prototype.tileToDisplayX=function(t){return t*e.size},e.prototype.tileToDisplayY=function(t){return t*e.size},e}(r),a.Floor=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.init=function(){return e.__super__.init.call(this),this.cls="floor"},e}(s.definition({Tile:a})),a}),function(e){t.Ship=e(),t.Ship.definition=e}(function(i){var r,o,s,a,l;return null==i&&(i={}),a=i.hasOwnProperty("Tile")?i.Tile:t.Tile,l=i.hasOwnProperty("TileContainer")?i.TileContainer:e.TileContainer,r=i.hasOwnProperty("DefaultGenerator")?i.DefaultGenerator:e.RoomGenerator,o=i.hasOwnProperty("Door")?i.Door:t.Door,s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.include(EventEmitter.prototype),e.prototype.init=function(){return e.__super__.init.call(this),this.displayContainer},e.properties({container:{},displayContainer:{calcul:function(t){var e;if(e=t.prop("container"),null!=e?e.getProperty("display"):void 0)return e.display},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},display:{calcul:function(){var t;return t=$(document.createElement("div")).addClass("ship"),t.get(0)._parallelio_obj=this,t}}}),e.prototype.generate=function(t){return t=t||(new e.Generator).tap(function(){}),t.getTiles().forEach(function(t){return function(e){return t.addTile(e)}}(this))},e}(l),s.Generator=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.wallFactory=function(t){return new a(t.x,t.y).tap(function(){return this.cls="wall",this.walkable=!1})},e.prototype.floorFactory=function(t){return new a.Floor(t.x,t.y)},e.prototype.doorFactory=function(t){return new a.Floor(t.x,t.y).tap(function(){return this.addChild(new o(t.direction))})},e}(r),s}),function(e){t.View=e(),t.View.definition=e}(function(t){var i;return null==t&&(t={}),i=t.hasOwnProperty("Element")?t.Element:e.Element,function(t){function e(t){this.display=null!=t?t:null,this.hovered=!1,this.keysInterval={}}return n(e,t),e.directionkeys={38:{name:"top",x:0,y:-1},39:{name:"right",x:1,y:0},40:{name:"bottom",x:0,y:1},37:{name:"left",x:-1,y:0}},e.properties({x:{default:0,change:function(){return this.updateDisplayPos()}},y:{default:0,change:function(){return this.updateDisplayPos()}},display:{change:function(){return 0===$(".viewContent",this.display).length&&$(this.display).append('<div class="viewContent"></div>'),this.updateDisplayPos(),$(this.display).mouseenter(this.callback("mouseEnter")),$(this.display).mouseleave(this.callback("mouseLeave"))}}}),e.prototype.mouseEnter=function(){return this.hovered=!0,$("body").keydown(this.callback("keyDown")),$("body").keyup(this.callback("keyUp"))},e.prototype.mouseLeave=function(){var t,e,n,i;this.hovered=!1,$("body").off("keydown",this.callback("keyDown")),$("body").off("keyup",this.callback("keyUp")),n=this.keysInterval,i=[];for(t in n)e=n[t],i.push(clearInterval(e));return i},e.prototype.keyDown=function(t){var n;if(null!=e.directionkeys[t.which])return n=e.directionkeys[t.which],null!=this.keysInterval[n.name]&&clearInterval(this.keysInterval[n.name]),this.keysInterval[n.name]=setInterval(function(t){return function(){return t.x+=2*n.x,t.y+=2*n.y}}(this),10)},e.prototype.keyUp=function(t){var n;if(null!=e.directionkeys[t.which]&&(n=e.directionkeys[t.which],null!=this.keysInterval[n.name]))return clearInterval(this.keysInterval[n.name])},e.prototype.updateDisplayPos=function(){return $(".viewContent",this.display).css({left:this.x+"px",top:this.y+"px"})},e.prototype.containsPoint=function(t,e){var n;for(n=this.display[0];n;)t-=n.offsetLeft,e-=n.offsetTop,n=n.offsetParent;return 0<=t&&t<=this.display.width()&&0<=e&&e<=this.display.height()},e}(i)})}.call(this);