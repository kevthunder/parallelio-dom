(function(){var e,t;e="undefined"!=typeof module&&null!==module?module.exports={}:(null==this.Parallelio&&(this.Parallelio={}),null==this.Parallelio.DOM&&(this.Parallelio.DOM={}),this.Parallelio.DOM),t=function(e={}){var t,i;return t=e.hasOwnProperty("BaseUpdater")?e.BaseUpdater:Parallelio.Spark.Updater,(i=class extends t{constructor(){super(),this.updateCallback=(()=>this.update()),this.binded=!1}update(){if(super.update(),this.binded=!1,this.callbacks.length>0)return this.requestFrame()}requestFrame(){if(!this.binded)return window.requestAnimationFrame(this.updateCallback),this.binded=!0}addCallback(e){return super.addCallback(e),this.requestFrame()}}).instance=new i,i},e.Updater=t(),e.Updater.definition=t,function(t){e.Display=t(),e.Display.definition=t}(function(t={}){var i,n,a;return i=t.hasOwnProperty("Element")?t.Element:Parallelio.Element,a=t.hasOwnProperty("Updater")?t.Updater:e.Updater,n=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,function(){class e extends i{initDisplay(){return this.cls,this.displayX,this.displayY,this.displayContainer}destroyDisplay(){if(null!=this._display)return this.display.remove()}}return e.include(n.prototype),e.properties({displayContainer:{updater:a.instance,default:null,change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},cls:{updater:a.instance,active:function(e){return e.propInitiated("display")},change:function(e){if(null!=e&&this.display.removeClass(e),null!=this.cls)return this.display.addClass(this.cls)}},display:{calcul:function(){var e,t;return t=document.createElement("div"),(e=jQuery(t).addClass(this.baseCls)).get(0)._parallelio_obj=this,e}},displayX:{updater:a.instance,active:function(e){return e.propInitiated("display")},change:function(e){return this.display.css({left:this.displayX})}},displayY:{updater:a.instance,active:function(e){return e.propInitiated("display")},change:function(e){return this.display.css({top:this.displayY})}}}),e}.call(this)}),function(t){e.Tiled=t(),e.Tiled.definition=t}(function(t={}){var i,n,a;return i=t.hasOwnProperty("BaseTiled")?t.BaseTiled:Parallelio.Tiled,n=t.hasOwnProperty("Display")?t.Display:e.Display,a=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,function(){class e extends i{constructor(){super(),this.initDisplay()}}return e.extend(n),e.include(a.prototype),e.properties({displayContainer:{calcul:function(e){var t;if(null!=(t=e.prop("tile")))return e.prop("displayContainer",t)}},displayX:{calcul:function(e){var t;if(null!=(t=e.prop("tile")))return t.displayX+t.tileToDisplayX(e.prop("offsetX"))}},displayY:{calcul:function(e){var t;if(null!=(t=e.prop("tile")))return t.displayY+t.tileToDisplayY(e.prop("offsetY"))}}}),e}.call(this)}),function(t){e.Door=t(),e.Door.definition=t}(function(t={}){var i,n,a,r;return a=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,i=t.hasOwnProperty("BaseDoor")?t.BaseDoor:Parallelio.Door,r=t.hasOwnProperty("Updater")?t.Updater:e.Updater,n=t.hasOwnProperty("Element")?t.Element:Parallelio.Spark.Element,function(){class e extends i{constructor(e){super(e),this.initDisplay(),this.open,this.baseCls="door"}}return e.extend(a.definition({BaseTiled:n})),e.properties({direction:{updater:r.instance,active:function(e){return e.propInitiated("display")},change:function(e){if(null!=e&&this.display.removeClass(e),null!=this.direction)return this.display.addClass(this.direction)}},open:{updater:r.instance,active:function(e){return e.propInitiated("display")},change:function(e){return this.display.toggleClass("close",!this.open),this.display.toggleClass("open",this.open)}}}),e}.call(this)}),function(t){e.AutomaticDoor=t(),e.AutomaticDoor.definition=t}(function(t={}){var i,n;return n=t.hasOwnProperty("Door")?t.Door:e.Door,i=t.hasOwnProperty("BaseAutomaticDoor")?t.BaseAutomaticDoor:Parallelio.AutomaticDoor,class extends(n.definition({BaseDoor:i})){}}),function(t){e.Character=t(),e.Character.definition=t}(function(t={}){var i,n,a,r;return a=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,i=t.hasOwnProperty("BaseCharacter")?t.BaseCharacter:Parallelio.Character,r=t.hasOwnProperty("Updater")?t.Updater:e.Updater,n=t.hasOwnProperty("Element")?t.Element:Parallelio.Spark.Element,function(){class e extends i{constructor(){super(),this.initDisplay(),this.baseCls="character"}}return e.extend(a.definition({BaseTiled:n})),e.properties({selected:{updater:r.instance,active:function(e){return e.propInitiated("display")},change:function(e){return this.display.toggleClass("selected",this.selected)}}}),e}.call(this)}),function(t){e.Damageable=t(),e.Damageable.definition=t}(function(t={}){var i,n,a,r;return i=t.hasOwnProperty("BaseDamageable")?t.BaseDamageable:Parallelio.Damageable,n=t.hasOwnProperty("Display")?t.Display:e.Display,r=t.hasOwnProperty("Updater")?t.Updater:e.Updater,a=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,function(){class e extends i{constructor(){super(),this.healthCls(),this.initDisplay()}}return e.extend(n),e.include(a.prototype),e.properties({healthClsSteps:{default:10},healthCls:{updater:r.instance,active:function(e){return e.propInitiated("display")},calcul:function(e){return"health-"+Math.ceil(e.prop("health")/e.prop("maxHealth")*e.prop("healthClsSteps"))},change:function(e){if(null!=e&&this.display.removeClass(e),null!=this.healthCls)return this.display.addClass(this.healthCls)}}}),e}.call(this)}),function(t){e.PlayerController=t(),e.PlayerController.definition=t}(function(e={}){var t;return t=e.hasOwnProperty("Element")?e.Element:Parallelio.Spark.Element,function(){class e extends t{constructor(e){super(),this.setProperties(e)}setDefaults(){if(!this.gameDisplay)return this.gameDisplay=document.body}checkFocus(e){return this._bubbleUp(e.target,e=>{if(this.player.canFocusOn(e))return this.player.focused=e,!0})}checkTargetOrSelectable(e){return this._bubbleUp(e.target,e=>{var t;return(t=this.player.canTargetActionOn(e))?(this.player.selectedAction=t,this.player.setActionTarget(e),!0):this.player.canSelect(e)?(this.player.selected=e,!0):void 0})}_bubbleUp(e,t){for(var i;e;)e=null!=e._parallelio_obj?e._parallelio_obj:null!=e.parentNode?e.parentNode:t(e)?null:null!=e.tile?e.tile:null!=(null!=(i=e.display)?i.get(0).parentNode:void 0)?e.display.get(0).parentNode:null;return null}}return e.properties({player:{change:function(){if(this.player)return this.setDefaults()}},gameDisplay:{change:function(){if(this.gameDisplay)return $(this.gameDisplay).on("click",this.callback("checkTargetOrSelectable")),$(this.gameDisplay).on("mouseover",this.callback("checkFocus"))}}}),e}.call(this)}),function(t){e.View=t(),e.View.definition=t}(function(t={}){var i,n,a;return i=t.hasOwnProperty("BaseView")?t.BaseView:Parallelio.View,a=t.hasOwnProperty("Updater")?t.Updater:e.Updater,n=t.hasOwnProperty("Display")?t.Display:e.Display,function(){class e extends i{constructor(e=null){super(),null!=e&&(this.display=e),this.hovered=!1,this.keysInterval={},this.baseCls="view",this.boundsStyles}setDefaults(){if(super.setDefaults(),null==this.displayContainer)return this.displayContainer=$("body")}mouseEnter(){return this.hovered=!0,$("body").keydown(this.callback("keyDown")),$("body").keyup(this.callback("keyUp"))}mouseLeave(){var e,t,i,n;for(e in this.hovered=!1,$("body").off("keydown",this.callback("keyDown")),$("body").off("keyup",this.callback("keyUp")),n=[],i=this.keysInterval)t=i[e],n.push(clearInterval(t));return n}keyDown(t){var i;if(null!=e.directionkeys[t.which])return i=e.directionkeys[t.which],null!=this.keysInterval[i.name]&&clearInterval(this.keysInterval[i.name]),this.keysInterval[i.name]=setInterval(()=>(this.x+=2*i.x,this.y+=2*i.y),10)}keyUp(t){var i;if(null!=e.directionkeys[t.which]&&(i=e.directionkeys[t.which],null!=this.keysInterval[i.name]))return clearInterval(this.keysInterval[i.name])}updateDisplayPos(){return $(".viewContent",this.display).css({left:this.x+"px",top:this.y+"px"})}containsPoint(e,t){var i;for(i=this.display[0];i;)e-=i.offsetLeft,t-=i.offsetTop,i=i.offsetParent;return 0<=e&&e<=this.display.width()&&0<=t&&t<=this.display.height()}}return e.extend(n),e.directionkeys={38:{name:"top",x:0,y:1},39:{name:"right",x:-1,y:0},40:{name:"bottom",x:0,y:-1},37:{name:"left",x:1,y:0}},e.properties({x:{default:0,change:function(){return this.updateDisplayPos()}},y:{default:0,change:function(){return this.updateDisplayPos()}},display:{calcul:function(e,t){var i;return i=t(),0===$(".viewContent",i).length&&$(i).append('<div class="viewContent"></div>'),$(i).mouseenter(this.callback("mouseEnter")),$(i).mouseleave(this.callback("mouseLeave"))},change:function(){return this.updateDisplayPos()}},contentDisplay:{calcul:function(){return $(".viewContent",this.display)}},boundsStyles:{updater:a.instance,calcul:function(e){return{top:100*e.prop("top",this.bounds)+"%",left:100*e.prop("left",this.bounds)+"%",bottom:100*(1-e.prop("bottom",this.bounds))+"%",right:100*(1-e.prop("right",this.bounds))+"%"}},active:function(e){return e.propInitiated("display")&&null!=e.prop("bounds")},change:function(e){return this.display.css(this.boundsStyles)}}}),e}.call(this)}),function(t){e.Game=t(),e.Game.definition=t}(function(t={}){var i,n,a,r;return i=t.hasOwnProperty("BaseGame")?t.BaseGame:Parallelio.Game,r=t.hasOwnProperty("View")?t.View:e.View,n=t.hasOwnProperty("PlayerController")?t.PlayerController:e.PlayerController,a=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{}return e.properties({timing:{calcul:function(e,t){var i;return(i=t()).updater=a.instance,i}},mainUI:{calcul:function(){var e;return(e=document.createElement("div")).classList.add("ui"),document.body.appendChild(e),e}}}),e.prototype.defaultViewClass=r,e.prototype.defaultPlayerControllerClass=n,e}.call(this)}),function(t){e.PlayerSelectionInfo=t(),e.PlayerSelectionInfo.definition=t}(function(t={}){var i,n;return i=t.hasOwnProperty("Display")?t.Display:e.Display,n=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{constructor(){super(),this.initDisplay(),this.baseCls="selectionInfo",this.name,this.game,this.actions}setDefaults(){if(!this.displayContainer&&this.game.mainUI&&(this.displayContainer=this.game.mainUI),!this.player&&this.game.currentPlayer)return this.player=this.game.currentPlayer}}return e.properties({display:{calcul:function(e,t){var i;return(i=t()).html('<div class="name"></div><div class="actions"><span class="title">Actions :</span><ul></ul></div>'),i}},player:{default:null},selection:{calcul:function(e){return e.propPath("player.selected")}},name:{updater:n.instance,active:function(e){return e.propInitiated("display")},calcul:function(e){var t;if(null!=(t=e.prop("selection")))return e.prop("name",t)||t.constructor.name},change:function(){return this.display.find(".name").text(this.name)}},actions:{collection:!0,calcul:function(e){return e.propPath("selection.availableActions")||[]},change:function(){var e;return(e=this.display.find(".actions ul")).empty(),this.actions.forEach(function(t){var i,n;return n=t.name||t.constructor.name,(i=$("<li>"+n+"</li>")).on("click",function(){return t.start()}),e.append(i)})}},game:{change:function(e){if(this.game)return this.setDefaults()}}}),e}.call(this)}),function(t){e.Projectile=t(),e.Projectile.definition=t}(function(t={}){var i,n,a;return i=t.hasOwnProperty("BaseProjectile")?t.BaseProjectile:Parallelio.Projectile,n=t.hasOwnProperty("Display")?t.Display:e.Display,a=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{init(){return super.init(),this.baseCls="projectile",this.initDisplay()}destroy(){return this.destroyDisplay(),a.instance.removeCallback(this.callback("invalidatePrcPath"))}}return e.extend(n),e.properties({displayContainer:{calcul:function(e){var t;return(null!=(t=e.prop("container"))?t.getProperty("tileDisplay"):void 0)?e.prop("tileDisplay",t):(null!=t?t.getProperty("display"):void 0)?e.prop("display",t):e.prop("originTile").displayContainer}},displayX:{calcul:function(e){return this.originTile.tileToDisplayX(e.prop("x"))}},displayY:{calcul:function(e){return this.originTile.tileToDisplayY(e.prop("y"))}},moving:{change:function(){return this.moving?a.instance.addCallback(this.callback("invalidatePrcPath")):a.instance.removeCallback(this.callback("invalidatePrcPath"))}}}),e}.call(this)}),function(t){e.Tile=t(),e.Tile.definition=t}(function(t={}){var i,n,a,r;return n=t.hasOwnProperty("BaseTile")?t.BaseTile:Parallelio.Tile,i=t.hasOwnProperty("BaseFloor")?t.BaseFloor:Parallelio.Floor,a=t.hasOwnProperty("Display")?t.Display:e.Display,(r=function(){class e extends n{init(){return super.init(),this.baseCls="tile",this.initDisplay()}tileToDisplayX(t){return t*e.size}tileToDisplayY(t){return t*e.size}}return e.extend(a),e.size=20,e.properties({container:{},displayContainer:{calcul:function(e){var t;return(null!=(t=e.prop("container"))?t.getProperty("tileDisplay"):void 0)?e.prop("tileDisplay",t):(null!=t?t.getProperty("display"):void 0)?e.prop("display",t):void 0}},displayX:{calcul:function(e){return this.tileToDisplayX(e.prop("x"))}},displayY:{calcul:function(e){return this.tileToDisplayY(e.prop("y"))}}}),e}.call(this)).Floor=class extends(i.definition({Tile:r})){init(){return super.init(),this.cls="floor"}},r}),function(t){e.Ship=t(),e.Ship.definition=t}(function(t={}){var i,n,a,r,l,s;return l=t.hasOwnProperty("Tile")?t.Tile:e.Tile,s=t.hasOwnProperty("TileContainer")?t.TileContainer:Parallelio.TileContainer,i=t.hasOwnProperty("DefaultGenerator")?t.DefaultGenerator:Parallelio.RoomGenerator,n=t.hasOwnProperty("Door")?t.Door:e.AutomaticDoor,a=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,(r=function(){class e extends s{init(){return super.init(),this.displayContainer}setDefaults(){if(null==this.displayContainer&&(this.displayContainer=this.game.mainView.contentDisplay),this.tiles.length>0||this.generate(),null==this.game.mainTileContainer)return this.game.mainTileContainer=this}generate(t){return(t=t||(new e.Generator).tap(function(){})).getTiles().forEach(e=>this.addTile(e))}}return e.include(a.prototype),e.properties({container:{},displayContainer:{calcul:function(e){var t;return(null!=(t=e.prop("container"))?t.getProperty("contentDisplay"):void 0)?t.contentDisplay:(null!=t?t.getProperty("display"):void 0)?t.display:void 0},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},display:{calcul:function(){var e;return(e=$(document.createElement("div")).addClass("ship")).get(0)._parallelio_obj=this,e}},game:{change:function(e){if(this.game)return this.setDefaults()}}}),e}.call(this)).Generator=class extends i{wallFactory(e){return new l(e.x,e.y).tap(function(){return this.cls="wall",this.walkable=!1})}floorFactory(e){return new l.Floor(e.x,e.y)}doorFactory(e){return new l.Floor(e.x,e.y).tap(function(){return this.addChild(new n(e.direction))})}},r}),function(t){e.Weapon=t(),e.Weapon.definition=t}(function(t={}){var i,n,a,r,l;return r=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,a=t.hasOwnProperty("Projectile")?t.Projectile:e.Projectile,n=t.hasOwnProperty("Damageable")?t.Damageable:e.Damageable,i=t.hasOwnProperty("BaseWeapon")?t.BaseWeapon:Parallelio.Weapon.definition({Tiled:r,Damageable:n,Projectile:a}),l=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{constructor(e){super(e),this.baseCls="weapon"}}return e.properties({direction:{updater:l.instance,active:function(e){return e.propInitiated("display")},change:function(e){if(null!=e&&this.display.removeClass(e.name),null!=this.direction.name)return this.display.addClass(this.direction.name)}}}),e}.call(this)}),function(t){e.Wire=t(),e.Wire.definition=t}(function(t={}){var i,n,a;return n=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,i=t.hasOwnProperty("BaseWire")?t.BaseWire:Parallelio.Wire.definition({Tiled:n}),a=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{constructor(e){super(e),this.baseCls="wire",this.connectedDirections}getClassFromDirection(e){return"conn"+e.name.charAt(0).toUpperCase()+e.name.slice(1)}}return e.properties({display:{calcul:function(e,t){return t()}},connectedDirections:{updater:a.instance,active:function(e){return e.propInitiated("display")},change:function(e){return e&&e.forEach(e=>this.display.removeClass(this.getClassFromDirection(e))),this.connectedDirections.forEach(e=>this.display.addClass(this.getClassFromDirection(e)))}},wireType:{updater:a.instance,active:function(e){return e.propInitiated("display")},change:function(e){return e&&this.display.removeClass(e),this.display.addClass(this.wireType)}}}),e}.call(this)})}).call(this);