(function(){var t=function(t,n){function i(){this.constructor=t}for(var l in n)e.call(n,l)&&(t[l]=n[l]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Parallelio.DOM={},function(t){Parallelio.DOM.Tile=t(),Parallelio.DOM.Tile.definition=t}(function(e){var n;return null==e&&(e={}),n=e.hasOwnProperty("BaseTile")?e.BaseTile:Parallelio.Tile,function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.include(EventEmitter.prototype),n.size=20,n.prototype.init=function(){return n.__super__.init.call(this),this.displayContainer},n.properties({container:{},displayContainer:{calcul:function(t){var e;return e=t.prop("container"),(null!=e?e.getProperty("tileDisplay"):void 0)?t.prop("tileDisplay",e):(null!=e?e.getProperty("display"):void 0)?t.prop("display",e):void 0},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},cls:{change:function(t){if(this.getPropertyInstance("display").calculated&&(null!=t&&this.display.removeClass(t),null!=this.cls))return this.display.addClass(this.cls)}},display:{calcul:function(){var t,e,n;return n=document.createElement("div"),e=this.getDisplayPos(),t=jQuery(n).addClass("tile").addClass(this.cls).css({top:e.y,left:e.x}),t.get(0)._parallelio_obj=this,t}}}),n.prototype.getDisplayPos=function(){return this.tileToDisplayPos(this.x,this.y)},n.prototype.tileToDisplayPos=function(t,e){return{x:t*n.size,y:e*n.size}},n}(n)}),function(t){Parallelio.DOM.Ship=t(),Parallelio.DOM.Ship.definition=t}(function(e){var n,i,l,r;return null==e&&(e={}),l=e.hasOwnProperty("Tile")?e.Tile:Parallelio.DOM.Tile,r=e.hasOwnProperty("TileContainer")?e.TileContainer:Parallelio.TileContainer,n=e.hasOwnProperty("DefaultGenerator")?e.DefaultGenerator:Parallelio.RoomGenerator,i={},i.Tiled=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.include(EventEmitter.prototype),i.prototype.init=function(){return i.__super__.init.call(this),this.displayContainer},i.properties({container:{},displayContainer:{calcul:function(t){var e;if(e=t.prop("container"),null!=e?e.getProperty("display"):void 0)return e.display},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},display:{calcul:function(){var t;return t=$(document.createElement("div")).addClass("ship"),t.get(0)._parallelio_obj=this,t}}}),i.prototype.generate=function(t){return t=t||(new n).tap(function(){return this.wallFactory=function(t){return new l(t.x,t.y).tap(function(){return this.cls="wall",this.walkable=!1})},this.floorFactory=function(t){return new l(t.x,t.y).tap(function(){return this.cls="floor",this.walkable=!0})}}),t.getTiles().forEach(function(t){return function(e){return t.addTile(e)}}(this))},i}(r),i}),function(t){Parallelio.DOM.View=t(),Parallelio.DOM.View.definition=t}(function(e){var n;return null==e&&(e={}),n=e.hasOwnProperty("Element")?e.Element:Parallelio.Element,function(e){function n(t){this.display=null!=t?t:null,this.hovered=!1,this.keysInterval={}}return t(n,e),n.directionkeys={38:{name:"top",x:0,y:-1},39:{name:"right",x:1,y:0},40:{name:"bottom",x:0,y:1},37:{name:"left",x:-1,y:0}},n.properties({x:{default:0,change:function(){return this.updateDisplayPos()}},y:{default:0,change:function(){return this.updateDisplayPos()}},display:{change:function(){return 0===$(".viewContent",this.display).length&&$(this.display).append('<div class="viewContent"></div>'),this.updateDisplayPos(),$(this.display).mouseenter(this.callback("mouseEnter")),$(this.display).mouseleave(this.callback("mouseLeave"))}}}),n.prototype.mouseEnter=function(){return this.hovered=!0,$("body").keydown(this.callback("keyDown")),$("body").keyup(this.callback("keyUp"))},n.prototype.mouseLeave=function(){var t,e,n,i;this.hovered=!1,$("body").off("keydown",this.callback("keyDown")),$("body").off("keyup",this.callback("keyUp")),n=this.keysInterval,i=[];for(t in n)e=n[t],i.push(clearInterval(e));return i},n.prototype.keyDown=function(t){var e;if(null!=n.directionkeys[t.which])return e=n.directionkeys[t.which],null!=this.keysInterval[e.name]&&clearInterval(this.keysInterval[e.name]),this.keysInterval[e.name]=setInterval(function(t){return function(){return t.x+=2*e.x,t.y+=2*e.y}}(this),10)},n.prototype.keyUp=function(t){var e;if(null!=n.directionkeys[t.which]&&(e=n.directionkeys[t.which],null!=this.keysInterval[e.name]))return clearInterval(this.keysInterval[e.name])},n.prototype.updateDisplayPos=function(){return $(".viewContent",this.display).css({left:this.x+"px",top:this.y+"px"})},n.prototype.containsPoint=function(t,e){var n;for(n=this.display[0];n;)t-=n.offsetLeft,e-=n.offsetTop,n=n.offsetParent;return 0<=t&&t<=this.display.width()&&0<=e&&e<=this.display.height()},n}(n)}),"undefined"!=typeof module&&null!==module?module.exports=Parallelio.DOM:this.Parallelio.DOM=Parallelio.DOM}).call(this);