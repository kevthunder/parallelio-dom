(function(){var e,t;e="undefined"!=typeof module&&null!==module?module.exports={}:(null==this.Parallelio&&(this.Parallelio={}),null==this.Parallelio.DOM&&(this.Parallelio.DOM={}),this.Parallelio.DOM),t=function(e={}){var t,i;return t=e.hasOwnProperty("BaseUpdater")?e.BaseUpdater:Parallelio.Spark.Updater,(i=class extends t{constructor(){super(),this.updateCallback=(()=>this.update()),this.binded=!1}update(){if(super.update(),this.binded=!1,this.callbacks.length>0)return this.requestFrame()}requestFrame(){if(!this.binded)return window.requestAnimationFrame(this.updateCallback),this.binded=!0}addCallback(e){return super.addCallback(e),this.requestFrame()}}).instance=new i,i},e.Updater=t(),e.Updater.definition=t,function(t){e.Display=t(),e.Display.definition=t}(function(t={}){var i,a,n;return i=t.hasOwnProperty("Element")?t.Element:Parallelio.Element,n=t.hasOwnProperty("Updater")?t.Updater:e.Updater,a=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,function(){class e extends i{initDisplay(){return this.cls,this.displayX,this.displayY,this.displayContainer}destroyDisplay(){if(null!=this._display)return this.display.remove()}}return e.include(a.prototype),e.properties({displayContainer:{updater:n.instance,default:null,change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},cls:{updater:n.instance,active:function(e){return e.propInitiated("display")},change:function(e){if(null!=e&&this.display.removeClass(e),null!=this.cls)return this.display.addClass(this.cls)}},display:{calcul:function(){var e,t;return t=document.createElement("div"),(e=jQuery(t).addClass(this.baseCls)).get(0)._parallelio_obj=this,e}},displayX:{updater:n.instance,active:function(e){return e.propInitiated("display")},change:function(e){return this.display.css({left:this.displayX})}},displayY:{updater:n.instance,active:function(e){return e.propInitiated("display")},change:function(e){return this.display.css({top:this.displayY})}}}),e}.call(this)}),function(t){e.Tiled=t(),e.Tiled.definition=t}(function(t={}){var i,a,n;return i=t.hasOwnProperty("BaseTiled")?t.BaseTiled:Parallelio.Tiled,a=t.hasOwnProperty("Display")?t.Display:e.Display,n=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,function(){class e extends i{constructor(){super(),this.initDisplay()}}return e.extend(a),e.include(n.prototype),e.properties({displayContainer:{calcul:function(e){var t;if(null!=(t=e.prop("tile")))return e.prop("displayContainer",t)}},displayX:{calcul:function(e){var t;if(null!=(t=e.prop("tile")))return t.displayX+t.tileToDisplayX(e.prop("offsetX"))}},displayY:{calcul:function(e){var t;if(null!=(t=e.prop("tile")))return t.displayY+t.tileToDisplayY(e.prop("offsetY"))}}}),e}.call(this)}),function(t){e.Character=t(),e.Character.definition=t}(function(t={}){var i,a;return a=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,i=t.hasOwnProperty("BaseCharacter")?t.BaseCharacter:Parallelio.Character.definition({Tiled:a}),t.hasOwnProperty("Updater")?t.Updater:e.Updater,class extends i{constructor(){super(),this.baseCls="character"}}}),function(t){e.Damageable=t(),e.Damageable.definition=t}(function(t={}){var i,a,n,r;return i=t.hasOwnProperty("BaseDamageable")?t.BaseDamageable:Parallelio.Damageable,a=t.hasOwnProperty("Display")?t.Display:e.Display,r=t.hasOwnProperty("Updater")?t.Updater:e.Updater,n=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,function(){class e extends i{constructor(){super(),this.healthCls(),this.initDisplay()}}return e.extend(a),e.include(n.prototype),e.properties({healthClsSteps:{default:10},healthCls:{updater:r.instance,active:function(e){return e.propInitiated("display")},calcul:function(e){return"health-"+Math.ceil(e.prop("health")/e.prop("maxHealth")*e.prop("healthClsSteps"))},change:function(e){if(null!=e&&this.display.removeClass(e),null!=this.healthCls)return this.display.addClass(this.healthCls)}}}),e}.call(this)}),function(t){e.Door=t(),e.Door.definition=t}(function(t={}){var i,a,n;return a=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,i=t.hasOwnProperty("BaseDoor")?t.BaseDoor:Parallelio.Door.definition({Tiled:a}),n=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{constructor(e){super(e),this.baseCls="door"}}return e.properties({direction:{updater:n.instance,active:function(e){return e.propInitiated("display")},change:function(e){if(null!=e&&this.display.removeClass(e),null!=this.direction)return this.display.addClass(this.direction)}}}),e}.call(this)}),function(t){e.Projectile=t(),e.Projectile.definition=t}(function(t={}){var i,a,n;return i=t.hasOwnProperty("BaseProjectile")?t.BaseProjectile:Parallelio.Projectile,a=t.hasOwnProperty("Display")?t.Display:e.Display,n=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{init(){return super.init(),this.baseCls="projectile",this.initDisplay()}destroy(){return this.destroyDisplay(),n.instance.removeCallback(this.callback("invalidatePrcPath"))}}return e.extend(a),e.properties({displayContainer:{calcul:function(e){var t;return(null!=(t=e.prop("container"))?t.getProperty("tileDisplay"):void 0)?e.prop("tileDisplay",t):(null!=t?t.getProperty("display"):void 0)?e.prop("display",t):e.prop("originTile").displayContainer}},displayX:{calcul:function(e){return this.originTile.tileToDisplayX(e.prop("x"))}},displayY:{calcul:function(e){return this.originTile.tileToDisplayY(e.prop("y"))}},moving:{change:function(){return this.moving?n.instance.addCallback(this.callback("invalidatePrcPath")):n.instance.removeCallback(this.callback("invalidatePrcPath"))}}}),e}.call(this)}),function(t){e.Tile=t(),e.Tile.definition=t}(function(t={}){var i,a,n,r;return a=t.hasOwnProperty("BaseTile")?t.BaseTile:Parallelio.Tile,i=t.hasOwnProperty("BaseFloor")?t.BaseFloor:Parallelio.Floor,n=t.hasOwnProperty("Display")?t.Display:e.Display,(r=function(){class e extends a{init(){return super.init(),this.baseCls="tile",this.initDisplay()}tileToDisplayX(t){return t*e.size}tileToDisplayY(t){return t*e.size}}return e.extend(n),e.size=20,e.properties({container:{},displayContainer:{calcul:function(e){var t;return(null!=(t=e.prop("container"))?t.getProperty("tileDisplay"):void 0)?e.prop("tileDisplay",t):(null!=t?t.getProperty("display"):void 0)?e.prop("display",t):void 0}},displayX:{calcul:function(e){return this.tileToDisplayX(e.prop("x"))}},displayY:{calcul:function(e){return this.tileToDisplayY(e.prop("y"))}}}),e}.call(this)).Floor=class extends(i.definition({Tile:r})){init(){return super.init(),this.cls="floor"}},r}),function(t){e.Ship=t(),e.Ship.definition=t}(function(t={}){var i,a,n,r,l,s;return l=t.hasOwnProperty("Tile")?t.Tile:e.Tile,s=t.hasOwnProperty("TileContainer")?t.TileContainer:Parallelio.TileContainer,i=t.hasOwnProperty("DefaultGenerator")?t.DefaultGenerator:Parallelio.RoomGenerator,a=t.hasOwnProperty("Door")?t.Door:e.Door,n=t.hasOwnProperty("EventEmitter")?t.EventEmitter:Parallelio.Spark.EventEmitter,(r=function(){class e extends s{init(){return super.init(),this.displayContainer}generate(t){return(t=t||(new e.Generator).tap(function(){})).getTiles().forEach(e=>this.addTile(e))}}return e.include(n.prototype),e.properties({container:{},displayContainer:{calcul:function(e){var t;return(null!=(t=e.prop("container"))?t.getProperty("contentDisplay"):void 0)?t.contentDisplay:(null!=t?t.getProperty("display"):void 0)?t.display:void 0},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},display:{calcul:function(){var e;return(e=$(document.createElement("div")).addClass("ship")).get(0)._parallelio_obj=this,e}}}),e}.call(this)).Generator=class extends i{wallFactory(e){return new l(e.x,e.y).tap(function(){return this.cls="wall",this.walkable=!1})}floorFactory(e){return new l.Floor(e.x,e.y)}doorFactory(e){return new l.Floor(e.x,e.y).tap(function(){return this.addChild(new a(e.direction))})}},r}),function(t){e.View=t(),e.View.definition=t}(function(e={}){var t;return t=e.hasOwnProperty("Element")?e.Element:Parallelio.Element,function(){class e extends t{constructor(e=null){super(),this.display=e,this.hovered=!1,this.keysInterval={}}mouseEnter(){return this.hovered=!0,$("body").keydown(this.callback("keyDown")),$("body").keyup(this.callback("keyUp"))}mouseLeave(){var e,t,i,a;for(e in this.hovered=!1,$("body").off("keydown",this.callback("keyDown")),$("body").off("keyup",this.callback("keyUp")),a=[],i=this.keysInterval)t=i[e],a.push(clearInterval(t));return a}keyDown(t){var i;if(null!=e.directionkeys[t.which])return i=e.directionkeys[t.which],null!=this.keysInterval[i.name]&&clearInterval(this.keysInterval[i.name]),this.keysInterval[i.name]=setInterval(()=>(this.x+=2*i.x,this.y+=2*i.y),10)}keyUp(t){var i;if(null!=e.directionkeys[t.which]&&(i=e.directionkeys[t.which],null!=this.keysInterval[i.name]))return clearInterval(this.keysInterval[i.name])}updateDisplayPos(){return $(".viewContent",this.display).css({left:this.x+"px",top:this.y+"px"})}containsPoint(e,t){var i;for(i=this.display[0];i;)e-=i.offsetLeft,t-=i.offsetTop,i=i.offsetParent;return 0<=e&&e<=this.display.width()&&0<=t&&t<=this.display.height()}}return e.directionkeys={38:{name:"top",x:0,y:-1},39:{name:"right",x:1,y:0},40:{name:"bottom",x:0,y:1},37:{name:"left",x:-1,y:0}},e.properties({x:{default:0,change:function(){return this.updateDisplayPos()}},y:{default:0,change:function(){return this.updateDisplayPos()}},display:{change:function(){return 0===$(".viewContent",this.display).length&&$(this.display).append('<div class="viewContent"></div>'),this.updateDisplayPos(),$(this.display).mouseenter(this.callback("mouseEnter")),$(this.display).mouseleave(this.callback("mouseLeave"))}},contentDisplay:{calcul:function(){return $(".viewContent",this.display)}}}),e}.call(this)}),function(t){e.Weapon=t(),e.Weapon.definition=t}(function(t={}){var i,a,n,r,l;return r=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,n=t.hasOwnProperty("Projectile")?t.Projectile:e.Projectile,a=t.hasOwnProperty("Damageable")?t.Damageable:e.Damageable,i=t.hasOwnProperty("BaseWeapon")?t.BaseWeapon:Parallelio.Weapon.definition({Tiled:r,Damageable:a,Projectile:n}),l=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{constructor(e){super(e),this.baseCls="weapon"}}return e.properties({direction:{updater:l.instance,active:function(e){return e.propInitiated("display")},change:function(e){if(null!=e&&this.display.removeClass(e.name),null!=this.direction.name)return this.display.addClass(this.direction.name)}}}),e}.call(this)}),function(t){e.Wire=t(),e.Wire.definition=t}(function(t={}){var i,a,n;return a=t.hasOwnProperty("Tiled")?t.Tiled:e.Tiled,i=t.hasOwnProperty("BaseWire")?t.BaseWire:Parallelio.Wire.definition({Tiled:a}),n=t.hasOwnProperty("Updater")?t.Updater:e.Updater,function(){class e extends i{constructor(e){super(e),this.baseCls="wire",this.connectedDirections}getClassFromDirection(e){return"conn"+e.name.charAt(0).toUpperCase()+e.name.slice(1)}}return e.properties({display:{calcul:function(e,t){return t()}},connectedDirections:{updater:n.instance,active:function(e){return e.propInitiated("display")},change:function(e){return e&&e.forEach(e=>this.display.removeClass(this.getClassFromDirection(e))),this.connectedDirections.forEach(e=>this.display.addClass(this.getClassFromDirection(e)))}},wireType:{updater:n.instance,active:function(e){return e.propInitiated("display")},change:function(e){return e&&this.display.removeClass(e),this.display.addClass(this.wireType)}}}),e}.call(this)})}).call(this);