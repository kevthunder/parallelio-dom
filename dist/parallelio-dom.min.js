!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Parallelio=t()}}(function(){return function(){return function t(e,i,r){function n(s,o){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){return n(e[s][1][t]||t)},p,p.exports,t,e,i,r)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}}()({1:[function(t,e,i){var r,n;n=t("./Door"),r=t("parallelio").AutomaticDoor,e.exports=function(){class AutomaticDoor extends r{init(){return this.baseCls="door",super.init(),this.initDisplay()}}return AutomaticDoor.extend(n),AutomaticDoor}.call(this)},{"./Door":6,parallelio:71}],2:[function(t,e,i){var r,n,a;a=t("./Tiled"),r=t("parallelio").Character,n=t("./DomUpdater"),t("spark-starter").Element,e.exports=function(){class Character extends r{init(){return this.baseCls="character",super.init(),this.initDisplay()}}return Character.extend(a),Character.properties({selected:{change:new n({callback:function(t){return this.display.toggleClass("selected",this.selected)}})}}),Character}.call(this)},{"./DomUpdater":5,"./Tiled":18,parallelio:71,"spark-starter":194}],3:[function(t,e,i){var r,n,a;r=t("parallelio").Damageable,n=t("./Display"),a=t("./DomUpdater"),e.exports=function(){class Damageable extends r{constructor(){super(),this.healthCls(),this.initDisplay()}}return Damageable.extend(n),Damageable.properties({healthClsSteps:{default:10},healthCls:{calcul:function(t){return"health-"+Math.ceil(t.propByName("health")/t.propByName("maxHealth")*t.propByName("healthClsSteps"))},change:new a({callback:function(t){if(null!=t&&this.display.removeClass(t),null!=this.healthCls)return this.display.addClass(this.healthCls)}})}}),Damageable}.call(this)},{"./Display":4,"./DomUpdater":5,parallelio:71}],4:[function(t,e,i){var r,n;n=t("parallelio").Element,r=t("./DomUpdater"),e.exports=function(){class Display extends n{initDisplay(){}destroyDisplay(){if(null!=this.displayProperty.value)return this.display.remove()}}return Display.properties({displayContainer:{default:null,change:new r({callback:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}})},cls:{change:new r({callback:function(t){if(null!=t&&this.display.removeClass(t),null!=this.cls)return this.display.addClass(this.cls)}})},display:{calcul:function(){var t,e;return e=document.createElement("div"),(t=jQuery(e).addClass(this.baseCls)).get(0)._parallelio_obj=this,t}},displayX:{change:new r({callback:function(){return this.display.css({left:this.displayX})}})},displayY:{change:new r({callback:function(){return this.display.css({top:this.displayY})}})}}),Display}.call(this)},{"./DomUpdater":5,parallelio:71}],5:[function(t,e,i){var r;r=t("parallelio").Spark.watchers.PropertyWatcher,e.exports=class DomUpdater extends r{constructor(t){super(t)}init(){return this.updateDomCallback=(()=>this.updateDom()),super.init()}requestFrame(){if(!this.framebinded)return this.framebinded=!0,window.requestAnimationFrame(this.updateDomCallback)}validContext(){return!0}invalidate(){return this.requestFrame()}update(){return this.requestFrame()}updateDom(t){var e;return(e=this.getProperty().get())!==this.old&&(this.old=e,this.handleChange(e,t)),this.framebinded=!1}}},{parallelio:71}],6:[function(t,e,i){var r,n,a;a=t("./Tiled"),r=t("parallelio").Door,n=t("./DomUpdater"),t("spark-starter").Element,e.exports=function(){class Door extends r{init(){return this.baseCls="door",super.init(),this.initDisplay()}}return Door.extend(a),Door.properties({direction:{change:new n({callback:function(t){if(null!=t&&this.display.removeClass(t),null!=this.direction)return this.display.addClass(this.direction)}})},open:{change:new n({callback:function(t){return this.display.toggleClass("close",!this.open),this.display.toggleClass("open",this.open)}})}}),Door}.call(this)},{"./DomUpdater":5,"./Tiled":18,parallelio:71,"spark-starter":194}],7:[function(t,e,i){var r,n,a;r=t("parallelio").Game,a=t("./View"),n=t("./PlayerController"),e.exports=function(){class Game extends r{}return Game.properties({timing:{calcul:function(t,e){return e()}},mainUI:{calcul:function(){var t;return(t=document.createElement("div")).classList.add("ui"),document.body.appendChild(t),t}}}),Game.prototype.defaultViewClass=a,Game.prototype.defaultPlayerControllerClass=n,Game}.call(this)},{"./PlayerController":9,"./View":20,parallelio:71}],8:[function(t,e,i){var r;r=t("parallelio").Map,e.exports=function(){class Map extends r{setDefaults(){if(null==this.displayContainer)return this.displayContainer=this.game.mainView.contentDisplay}drawBackground(t){var e;return e=t.getContext("2d"),this.locations.forEach(t=>"function"==typeof t.draw?t.draw(this,e):void 0)}}return Map.properties({displayContainer:{default:null,change:function(){if(this.locations.forEach(t=>t.displayContainer=this.displayContainer),null!=this.displayContainer)return this.displayContainer.append(this.backgroundCanvas)}},game:{change:function(t,e){if(this.game)return this.setDefaults()}},starMargin:{default:10},backgroundCanvas:{calcul:function(){var t;return(t=document.createElement("canvas")).width=this.boundaries.right-this.boundaries.left+2*this.starMargin,t.height=this.boundaries.bottom-this.boundaries.top+2*this.starMargin,t.classList.add("mapBackground"),t.style.top=this.boundaries.top-this.starMargin+"px",t.style.left=this.boundaries.left-this.starMargin+"px",this.drawBackground(t),t}}}),Map}.call(this)},{parallelio:71}],9:[function(t,e,i){var r;r=t("spark-starter").Element,e.exports=function(){class PlayerController extends r{setDefaults(){if(!this.gameDisplay)return this.gameDisplay=document.body}checkFocus(t){return this._bubbleUp(t.target,t=>{if(this.player.canFocusOn(t))return this.player.focused=t,!0})}checkTargetOrSelectable(t){return this._bubbleUp(t.target,t=>{var e;return(e=this.player.canTargetActionOn(t))?(this.player.selectedAction=e,this.player.setActionTarget(t),!0):this.player.canSelect(t)?(this.player.selected=t,!0):void 0})}_bubbleUp(t,e){for(var i;t;)t=null!=t._parallelio_obj?t._parallelio_obj:null!=t.parentNode?t.parentNode:e(t)?null:null!=t.tile?t.tile:null!=(null!=(i=t.display)?i.get(0).parentNode:void 0)?t.display.get(0).parentNode:null;return null}}return PlayerController.properties({player:{change:function(){if(this.player)return this.setDefaults()}},gameDisplay:{change:function(){if(this.gameDisplay)return $(this.gameDisplay).on("click",this.callback("checkTargetOrSelectable")),$(this.gameDisplay).on("mouseover",this.callback("checkFocus"))}}}),PlayerController}.call(this)},{"spark-starter":194}],10:[function(t,e,i){var r,n;r=t("./Display"),n=t("./DomUpdater"),e.exports=function(){class PlayerSelectionInfo extends r{constructor(){super(),this.initDisplay(),this.baseCls="selectionInfo",this.name,this.game,this.actions}setDefaults(){if(!this.displayContainer&&this.game.mainUI&&(this.displayContainer=this.game.mainUI),!this.player&&this.game.currentPlayer)return this.player=this.game.currentPlayer}}return PlayerSelectionInfo.properties({display:{calcul:function(t,e){var i;return(i=e()).html('<div class="name"></div><div class="actions"><span class="title">Actions :</span><ul></ul></div>'),i}},player:{default:null},selection:{calcul:function(t){return t.propPath("player.selected")}},name:{calcul:function(t){var e;if(null!=(e=t.prop(this.selectionProperty)))return t.prop(e.nameProperty)||e.constructor.name},change:new n({callback:function(t){return this.display.find(".name").text(this.name)}})},actions:{collection:!0,calcul:function(t){return t.propPath("player.availableActions")||[]},change:new n({callback:function(t){var e;return(e=this.display.find(".actions ul")).empty(),this.actions.forEach(t=>{var i,r;return r=t.name||t.constructor.name,(i=$("<li>"+r+"</li>")).on("click",()=>this.player.selectAction(t)),e.append(i)})}})},game:{change:function(t,e){if(this.game)return this.setDefaults()}}}),PlayerSelectionInfo}.call(this)},{"./Display":4,"./DomUpdater":5}],11:[function(t,e,i){var r,n;r=t("parallelio").Projectile,n=t("./Display"),t("./Updater"),e.exports=function(){class Projectile extends r{init(){return super.init(),this.baseCls="projectile",this.initDisplay()}destroy(){return this.destroyDisplay()}}return Projectile.extend(n),Projectile.properties({displayContainer:{calcul:function(t){var e;return(null!=(e=t.propByName("container"))?e.propertiesManager.getProperty("tileDisplay"):void 0)?t.propByName("tileDisplay",e):(null!=e?e.propertiesManager.getProperty("display"):void 0)?t.propByName("display",e):t.propByName("originTile").displayContainer}},displayX:{calcul:function(t){return this.originTile.tileToDisplayX(t.propByName("x"))}},displayY:{calcul:function(t){return this.originTile.tileToDisplayY(t.propByName("y"))}}}),Projectile}.call(this)},{"./Display":4,"./Updater":19,parallelio:71}],12:[function(t,e,i){var r,n,a;r=t("parallelio").Ship,n=t("./Display"),a=t("./DomUpdater"),e.exports=function(){class Ship extends r{init(){return this.baseCls="ship",super.init()}}return Ship.extend(n),Ship.properties({displayContainer:{calcul:function(t){return t.propPath("location.displayContainer")}},displayX:{calcul:function(t){return t.propPath("location.x")}},displayY:{calcul:function(t){return t.propPath("location.y")}},orbiting:{calcul:function(t){return null===t.propByName("travel")},change:new a({callback:function(t){return this.orbiting?this.display.addClass("orbiting"):this.display.removeClass("orbiting")}})}}),Ship}.call(this)},{"./Display":4,"./DomUpdater":5,parallelio:71}],13:[function(t,e,i){var r,n,a,s,o;s=t("./Tile"),o=t("parallelio").tiles.TileContainer,r=t("parallelio").generators.RoomGenerator,n=t("./AutomaticDoor"),e.exports=a=function(){class ShipInterior extends o{init(){return super.init(),this.displayContainer}setDefaults(){if(null==this.displayContainer&&(this.displayContainer=this.game.mainView.contentDisplay),this.tiles.length>0||this.generate(),null==this.game.mainTileContainer)return this.game.mainTileContainer=this}generate(t){return(t=t||(new ShipInterior.Generator).tap(function(){})).getTiles().forEach(t=>this.addTile(t))}}return ShipInterior.properties({container:{},displayContainer:{calcul:function(t){var e;return(null!=(e=t.propByName("container"))?e.propertiesManager.getProperty("contentDisplay"):void 0)?e.contentDisplay:(null!=e?e.propertiesManager.getProperty("display"):void 0)?e.display:void 0},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},display:{calcul:function(){var t;return(t=$(document.createElement("div")).addClass("ship")).get(0)._parallelio_obj=this,t}},game:{change:function(t,e){if(this.game)return this.setDefaults()}}}),ShipInterior}.call(this),a.Generator=class Generator extends r{wallFactory(t){return new s(t.x,t.y).tap(function(){return this.cls="wall",this.walkable=!1})}floorFactory(t){return new s.Floor(t.x,t.y)}doorFactory(t){return new s.Floor(t.x,t.y).tap(function(){return this.addChild(new n({direction:t.direction}))})}}},{"./AutomaticDoor":1,"./Tile":17,parallelio:71}],14:[function(t,e,i){var r,n,a,s,o;o=t("./Tiled"),s=t("./Projectile"),n=t("./Damageable"),r=t("parallelio").ShipWeapon,a=t("./DomUpdater"),e.exports=function(){class ShipWeapon extends r{constructor(t){super(t),this.baseCls="weapon"}}return ShipWeapon.extend(o),ShipWeapon.extend(n),ShipWeapon.properties({direction:{change:new a({callback:function(t){if(null!=t&&this.display.removeClass(t.name),null!=this.direction.name)return this.display.addClass(this.direction.name)}})},projectileClass:{default:s}}),ShipWeapon}.call(this)},{"./Damageable":3,"./DomUpdater":5,"./Projectile":11,"./Tiled":18,parallelio:71}],15:[function(t,e,i){var r,n,a;r=t("parallelio").generators.StarMapGenerator,n=t("./Map"),a=t("./StarSystem"),e.exports=function(){class StarMapGenerator extends r{}return StarMapGenerator.prototype.defOpt=Object.assign({},r.prototype.defOpt,{mapClass:n,starClass:a,linkClass:a.Link}),StarMapGenerator}.call(this)},{"./Map":8,"./StarSystem":16,parallelio:71}],16:[function(t,e,i){var r,n,a;r=t("parallelio").StarSystem,n=t("./Display"),e.exports=a=function(){class StarSystem extends r{init(){return this.baseCls="star",super.init()}draw(t,e){return e.beginPath(),e.lineWidth=1.5,e.strokeStyle="#336",e.arc(this.x-t.boundaries.left+t.starMargin,this.y-t.boundaries.top+t.starMargin,t.starMargin,0,2*Math.PI),e.stroke(),this.links.forEach(i=>{if(i.star1===this)return"function"==typeof i.draw?i.draw(t,e):void 0})}}return StarSystem.extend(n),StarSystem.properties({displayX:{calcul:function(t){return t.propByName("x")}},displayY:{calcul:function(t){return t.propByName("y")}}}),StarSystem}.call(this),a.Link=class Link extends r.Link{draw(t,e){var i,r,n,a,s,o,l;return a=this.star2.x-this.star1.x,l=this.star2.y-this.star1.y,i=Math.sqrt(a*a+l*l),r=this.star1.x+t.starMargin*a/i-t.boundaries.left+t.starMargin,s=this.star1.y+t.starMargin*l/i-t.boundaries.top+t.starMargin,n=this.star2.x-t.starMargin*a/i-t.boundaries.left+t.starMargin,o=this.star2.y-t.starMargin*l/i-t.boundaries.top+t.starMargin,e.beginPath(),e.lineWidth=1,e.strokeStyle="#336",e.moveTo(r,s),e.lineTo(n,o),e.stroke()}}},{"./Display":4,parallelio:71}],17:[function(t,e,i){var r,n,a,s;n=t("parallelio").tiles.Tile,r=t("parallelio").Floor,a=t("./Display"),e.exports=s=function(){class Tile extends n{init(){return super.init(),this.baseCls="tile",this.initDisplay()}tileToDisplayX(t){return t*Tile.size}tileToDisplayY(t){return t*Tile.size}}return Tile.extend(a),Tile.size=20,Tile.properties({container:{},displayContainer:{calcul:function(t){var e;return(null!=(e=t.propByName("container"))?e.propertiesManager.getProperty("tileDisplay"):void 0)?t.propByName("tileDisplay",e):(null!=e?e.propertiesManager.getProperty("display"):void 0)?t.propByName("display",e):void 0}},displayX:{calcul:function(t){return this.tileToDisplayX(t.propByName("x"))}},displayY:{calcul:function(t){return this.tileToDisplayY(t.propByName("y"))}}}),Tile}.call(this),s.Floor=function(){class Floor extends r{init(){return super.init(),this.baseCls="tile",this.cls="floor"}}return Floor.extend(s),Floor}.call(this)},{"./Display":4,parallelio:71}],18:[function(t,e,i){var r;t("parallelio").tiles.Tiled,r=t("./Display"),e.exports=function(){class Tiled extends r{constructor(){super(),this.initDisplay()}}return Tiled.properties({displayContainer:{calcul:function(t){var e;if(null!=(e=t.propByName("tile")))return t.propByName("displayContainer",e)}},displayX:{calcul:function(t){var e;if(null!=(e=t.propByName("tile")))return e.displayX+e.tileToDisplayX(t.propByName("offsetX"))}},displayY:{calcul:function(t){var e;if(null!=(e=t.propByName("tile")))return e.displayY+e.tileToDisplayY(t.propByName("offsetY"))}}}),Tiled}.call(this)},{"./Display":4,parallelio:71}],19:[function(t,e,i){var r,n;r=t("parallelio").Spark.Updater,e.exports=n=class Updater extends r{constructor(){super(),this.updateCallback=(()=>this.update()),this.binded=!1}update(){if(super.update(),this.binded=!1,this.callbacks.length>0)return this.requestFrame()}requestFrame(){if(!this.binded)return window.requestAnimationFrame(this.updateCallback),this.binded=!0}addCallback(t){return super.addCallback(t),this.requestFrame()}},n.instance=new n},{parallelio:71}],20:[function(t,e,i){var r,n,a;r=t("parallelio").View,a=t("./DomUpdater"),n=t("./Display"),e.exports=function(){class View extends r{constructor(t=null){super(),null!=t&&(this.display=t),this.hovered=!1,this.keysInterval={},this.baseCls="view",this.boundsStyles}setDefaults(){if(super.setDefaults(),null==this.displayContainer)return this.displayContainer=$("body")}mouseEnter(){return this.hovered=!0,$("body").keydown(this.callback("keyDown")),$("body").keyup(this.callback("keyUp"))}mouseLeave(){var t,e,i,r;for(t in this.hovered=!1,$("body").off("keydown",this.callback("keyDown")),$("body").off("keyup",this.callback("keyUp")),r=[],i=this.keysInterval)e=i[t],r.push(clearInterval(e));return r}keyDown(t){var e;if(null!=View.directionkeys[t.which])return e=View.directionkeys[t.which],null!=this.keysInterval[e.name]&&clearInterval(this.keysInterval[e.name]),this.keysInterval[e.name]=setInterval(()=>(this.x+=2*e.x,this.y+=2*e.y),10)}keyUp(t){var e;if(null!=View.directionkeys[t.which]&&(e=View.directionkeys[t.which],null!=this.keysInterval[e.name]))return clearInterval(this.keysInterval[e.name])}updateDisplayPos(){return $(".viewContent",this.display).css({left:this.x+"px",top:this.y+"px"})}containsPoint(t,e){var i;for(i=this.display[0];i;)t-=i.offsetLeft,e-=i.offsetTop,i=i.offsetParent;return 0<=t&&t<=this.display.width()&&0<=e&&e<=this.display.height()}}return View.extend(n),View.directionkeys={38:{name:"top",x:0,y:1},39:{name:"right",x:-1,y:0},40:{name:"bottom",x:0,y:-1},37:{name:"left",x:1,y:0}},View.properties({x:{default:0,change:function(){return this.updateDisplayPos()}},y:{default:0,change:function(){return this.updateDisplayPos()}},display:{calcul:function(t,e){var i;return i=e(),0===$(".viewContent",i).length&&$(i).append('<div class="viewContent"></div>'),$(i).mouseenter(this.callback("mouseEnter")),$(i).mouseleave(this.callback("mouseLeave"))},change:function(){return this.updateDisplayPos()}},contentDisplay:{calcul:function(){return $(".viewContent",this.display)}},boundsStyles:{calcul:function(t){return{top:100*t.propPath("bounds.top")+"%",left:100*t.propPath("bounds.left")+"%",bottom:100*(1-t.propPath("bounds.bottom"))+"%",right:100*(1-t.propPath("bounds.right"))+"%"}},change:new a({callback:function(t){return this.display.css(this.boundsStyles)}})}}),View}.call(this)},{"./Display":4,"./DomUpdater":5,parallelio:71}],21:[function(t,e,i){var r,n,a;a=t("./Tiled"),r=t("parallelio").wiring.Wire,n=t("./DomUpdater"),e.exports=function(){class Wire extends r{constructor(t){super(t),this.baseCls="wire",this.connectedDirections}getClassFromDirection(t){return"conn"+t.name.charAt(0).toUpperCase()+t.name.slice(1)}}return Wire.extend(a),Wire.properties({connectedDirections:{change:new n({callback:function(t){return t&&t.forEach(t=>this.display.removeClass(this.getClassFromDirection(t))),this.connectedDirections.forEach(t=>this.display.addClass(this.getClassFromDirection(t)))}})},wireType:{change:new n({callback:function(t){return t&&this.display.removeClass(t),this.display.addClass(this.wireType)}})}}),Wire}.call(this)},{"./DomUpdater":5,"./Tiled":18,parallelio:71}],22:[function(t,e,i){e.exports={AutomaticDoor:t("./AutomaticDoor"),Character:t("./Character"),Damageable:t("./Damageable"),Display:t("./Display"),DomUpdater:t("./DomUpdater"),Door:t("./Door"),Game:t("./Game"),Map:t("./Map"),PlayerController:t("./PlayerController"),PlayerSelectionInfo:t("./PlayerSelectionInfo"),Projectile:t("./Projectile"),Ship:t("./Ship"),ShipInterior:t("./ShipInterior"),ShipWeapon:t("./ShipWeapon"),StarMapGenerator:t("./StarMapGenerator"),StarSystem:t("./StarSystem"),Tile:t("./Tile"),Tiled:t("./Tiled"),Updater:t("./Updater"),View:t("./View"),Wire:t("./Wire")}},{"./AutomaticDoor":1,"./Character":2,"./Damageable":3,"./Display":4,"./DomUpdater":5,"./Door":6,"./Game":7,"./Map":8,"./PlayerController":9,"./PlayerSelectionInfo":10,"./Projectile":11,"./Ship":12,"./ShipInterior":13,"./ShipWeapon":14,"./StarMapGenerator":15,"./StarSystem":16,"./Tile":17,"./Tiled":18,"./Updater":19,"./View":20,"./Wire":21}],23:[function(t,e,i){var r,n;n=t("./libs"),r=t("parallelio"),e.exports=Object.assign({},r,{DOM:n})},{"./libs":22,parallelio:71}],24:[function(t,e,i){var r=Object.create||function(t){var e=function(){};return e.prototype=t,new e},n=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return i},a=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=r(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var o,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),o=0===c.x}catch(t){o=!1}function p(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function h(t,e,i,n){var a,s,o;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((s=t._events)?(s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),o=s[e]):(s=t._events=r(null),t._eventsCount=0),o){if("function"==typeof o?o=s[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),!o.warned&&(a=p(t))&&a>0&&o.length>a){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else o=s[e]=i,++t._eventsCount;return t}function u(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function d(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=a.call(u,r);return n.listener=i,r.wrapFn=n,n}function f(t,e,i){var r=t._events;if(!r)return[];var n=r[e];return n?"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):g(n,n.length):[]}function y(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function g(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}o?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');l=t}}):s.defaultMaxListeners=l,s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return p(this)},s.prototype.emit=function(t){var e,i,r,n,a,s,o="error"===t;if(s=this._events)o=o&&null==s.error;else if(!o)return!1;if(o){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var l=new Error('Unhandled "error" event. ('+e+")");throw l.context=e,l}if(!(i=s[t]))return!1;var c="function"==typeof i;switch(r=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var r=t.length,n=g(t,r),a=0;a<r;++a)n[a].call(i)}(i,c,this);break;case 2:!function(t,e,i,r){if(e)t.call(i,r);else for(var n=t.length,a=g(t,n),s=0;s<n;++s)a[s].call(i,r)}(i,c,this,arguments[1]);break;case 3:!function(t,e,i,r,n){if(e)t.call(i,r,n);else for(var a=t.length,s=g(t,a),o=0;o<a;++o)s[o].call(i,r,n)}(i,c,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,r,n,a){if(e)t.call(i,r,n,a);else for(var s=t.length,o=g(t,s),l=0;l<s;++l)o[l].call(i,r,n,a)}(i,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),a=1;a<r;a++)n[a-1]=arguments[a];!function(t,e,i,r){if(e)t.apply(i,r);else for(var n=t.length,a=g(t,n),s=0;s<n;++s)a[s].apply(i,r)}(i,c,this,n)}return!0},s.prototype.addListener=function(t,e){return h(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return h(this,t,e,!0)},s.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,d(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,d(this,t,e)),this},s.prototype.removeListener=function(t,e){var i,n,a,s,o;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=r(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(a=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){o=i[s].listener,a=s;break}if(a<0)return this;0===a?i.shift():function(t,e){for(var i=e,r=i+1,n=t.length;r<n;i+=1,r+=1)t[i]=t[r];t.pop()}(i,a),1===i.length&&(n[t]=i[0]),n.removeListener&&this.emit("removeListener",t,o||e)}return this},s.prototype.removeAllListeners=function(t){var e,i,a;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=r(null),this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=r(null):delete i[t]),this;if(0===arguments.length){var s,o=n(i);for(a=0;a<o.length;++a)"removeListener"!==(s=o[a])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=r(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)for(a=e.length-1;a>=0;a--)this.removeListener(t,e[a]);return this},s.prototype.listeners=function(t){return f(this,t,!0)},s.prototype.rawListeners=function(t){return f(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},s.prototype.listenerCount=y,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],25:[function(t,e,i){var r,n,a=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var c,p=[],h=!1,u=-1;function d(){h&&c&&(h=!1,c.length?p=c.concat(p):u=-1,p.length&&f())}function f(){if(!h){var t=l(d);h=!0;for(var e=p.length;e;){for(c=p,p=[];++u<e;)c&&c[u].run();u=-1,e=p.length}c=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function g(){}a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new y(t,e)),1!==p.length||h||l(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],26:[function(t,e,i){(function(e,r){var n=t("process/browser.js").nextTick,a=Function.prototype.apply,s=Array.prototype.slice,o={},l=0;function c(t,e){this._id=t,this._clearFn=e}i.setTimeout=function(){return new c(a.call(setTimeout,window,arguments),clearTimeout)},i.setInterval=function(){return new c(a.call(setInterval,window,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(t){t.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},i.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},i.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},i._unrefActive=i.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i.setImmediate="function"==typeof e?e:function(t){var e=l++,r=!(arguments.length<2)&&s.call(arguments,1);return o[e]=!0,n(function(){o[e]&&(r?t.apply(null,r):t.call(null),i.clearImmediate(e))}),e},i.clearImmediate="function"==typeof r?r:function(t){delete o[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":25,timers:26}],27:[function(t,e,i){const r=t("parallelio-tiles").Tile;class Airlock extends r{attachTo(t){this.attachedTo=t}copyAndRotate(t,e){const i=super.copyAndRotate(t,e);return i.direction=this.direction.rotate(t),i}}Airlock.properties({direction:{},attachedTo:{}}),e.exports=Airlock},{"parallelio-tiles":118}],28:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-timing");class Approach extends r{start(){this.valid&&(this.moving=!0,this.subject.xMembers.addPropertyPath("currentPos.x",this),this.subject.yMembers.addPropertyPath("currentPos.x",this),this.timeout=this.timing.setTimeout(()=>this.done(),this.duration))}done(){this.subject.xMembers.removeRef({name:"currentPos.x",obj:this}),this.subject.yMembers.removeRef({name:"currentPos.x",obj:this}),this.subject.x=this.targetPos.x,this.subject.y=this.targetPos.x,this.subjectAirlock.attachTo(this.targetAirlock),this.moving=!1,this.complete=!0}destroy(){this.timeout&&this.timeout.destroy()}}Approach.properties({timing:{calcul:function(){return new n}},initialDist:{default:500},rng:{default:Math.random},angle:{calcul:function(){return this.rng*Math.PI*2}},startingPos:{calcul:function(){return{x:this.startingPos.x+this.initialDist*Math.cos(this.angle),y:this.startingPos.y+this.initialDist*Math.sin(this.angle)}}},targetPos:{calcul:function(){return{x:this.targetAirlock.x-this.subjectAirlock.x,y:this.targetAirlock.y-this.subjectAirlock.y}}},subject:{},target:{},valid:{calcul:function(){return null!=this.subject&&null!=this.target&&this.subject.airlocks.length>0&&this.target.airlocks.length>0}},subjectAirlock:{calcul:function(){var t;return(t=this.subject.airlocks.slice()).sort((t,e)=>{return Math.abs(t.direction.x-Math.cos(this.angle))+Math.abs(t.direction.y-Math.sin(this.angle))-(Math.abs(e.direction.x-Math.cos(this.angle))+Math.abs(e.direction.y-Math.sin(this.angle)))}),t.get(0)}},targetAirlock:{calcul:function(){return this.target.airlocks.find(t=>t.direction.getInverse()===this.subjectAirlock.direction)}},moving:{default:!1},complete:{default:!1},currentPos:{calcul:function(t){var e,i,r;return r=t.prop(this.startingPosProperty),e=t.prop(this.targetPosProperty),i=t.propPath("timeout.prc")||0,{x:(e.x-r.x)*i+r.x,y:(e.y-r.y)*i+r.y}}},duration:{default:1e4},timeout:{}}),e.exports=Approach},{"parallelio-timing":128,"spark-starter":185}],29:[function(t,e,i){const r=t("./Door"),n=t("./Character");class AutomaticDoor extends r{updateTileMembers(t){var e,i,r,n;if(null!=t&&(null!=(e=t.walkableMembers)&&e.removeProperty(this.unlockedProperty),null!=(i=t.transparentMembers)&&i.removeProperty(this.openProperty)),this.tile)return null!=(r=this.tile.walkableMembers)&&r.addProperty(this.unlockedProperty),null!=(n=this.tile.transparentMembers)?n.addProperty(this.openProperty):null}init(){return super.init(),this.open}isActivatorPresent(t){return this.getReactiveTiles(t).some(e=>{return(t?t.prop(e.childrenProperty):e.children).some(t=>this.canBeActivatedBy(t))})}canBeActivatedBy(t){return t instanceof n}getReactiveTiles(t){var e;return(e=t?t.prop(this.tileProperty):this.tile)?(t?t.prop(this.directionProperty):this.direction)===r.directions.horizontal?[e,e.getRelativeTile(0,1),e.getRelativeTile(0,-1)].filter(function(t){return null!=t}):[e,e.getRelativeTile(1,0),e.getRelativeTile(-1,0)].filter(function(t){return null!=t}):[]}}AutomaticDoor.properties({open:{calcul:function(t){return!t.prop(this.lockedProperty)&&this.isActivatorPresent(t)}},locked:{default:!1},unlocked:{calcul:function(t){return!t.prop(this.lockedProperty)}}}),e.exports=AutomaticDoor},{"./Character":30,"./Door":35}],30:[function(t,e,i){const r=t("parallelio-tiles").Tiled,n=t("./Damageable"),a=t("./actions/WalkAction"),s=t("./actions/ActionProvider");class Character extends r{constructor(t){"string"==typeof t&&(t={name:t}),super(t)}setDefaults(){if(!this.tile&&null!=this.game.mainTileContainer)return this.putOnRandomTile(this.game.mainTileContainer.tiles)}canGoOnTile(t){return!1!==(null!=t?t.walkable:null)}walkTo(t){var e;return(e=new a({actor:this,target:t})).start(),e}isSelectableBy(t){return!0}}Character.extend(n),Character.properties({name:{},game:{change:function(t,e){if(this.game)return this.setDefaults()}},offsetX:{composed:!0,default:.5},offsetY:{composed:!0,default:.5},tile:{composed:!0},defaultAction:{calcul:function(){return new a({actor:this})}},actionProvider:{calcul:function(t){const e=new s({owner:this});return e.actionsMembers.addPropertyPath("owner.tile.actionProvider.actions"),e}}}),e.exports=Character},{"./Damageable":34,"./actions/ActionProvider":58,"./actions/WalkAction":65,"parallelio-tiles":118}],31:[function(t,e,i){const r=t("parallelio-tiles").TileContainer,n=t("./VisionCalculator"),a=t("./Door"),s=t("./actions/WalkAction"),o=t("./actions/AttackMoveAction"),l=t("spark-starter").watchers.PropertyWatcher;e.exports=class CharacterAI{constructor(t){this.character=t,this.nextActionCallback=(()=>this.nextAction()),this.visionMemory=new r,this.tileWatcher=new l({callback:()=>this.updateVisionMemory(),property:this.character.propertiesManager.getProperty("tile")})}start(){return this.tileWatcher.bind(),this.nextAction()}nextAction(){this.updateVisionMemory();const t=this.getClosestEnemy();if(t)return this.attackMoveTo(t).on("end",this.nextActionCallback);const e=this.getClosestUnexplored();return e?this.walkTo(e).on("end",this.nextActionCallback):(this.resetVisionMemory(),this.walkTo(this.getClosestUnexplored()).on("end",this.nextActionCallback))}updateVisionMemory(){var t;(t=new n(this.character.tile)).calcul(),this.visionMemory=t.toContainer().merge(this.visionMemory,(t,e)=>(null!=t&&(t=this.analyzeTile(t)),null!=t&&null!=e?(t.visibility=Math.max(t.visibility,e.visibility),t):t||e))}analyzeTile(t){var e;return t.ennemySpotted=null!=(e=t.getFinalTile().children)?e.find(t=>this.isEnnemy(t)):null,t.explorable=this.isExplorable(t),t}isEnnemy(t){var e;return null!=(e=this.character.owner)&&"function"==typeof e.isEnemy?e.isEnemy(t):null}getClosestEnemy(){return this.visionMemory.closest(this.character.tile,t=>t.ennemySpotted)}getClosestUnexplored(){return this.visionMemory.closest(this.character.tile,t=>t.visibility<1&&t.explorable)}isExplorable(t){var e;return(t=t.getFinalTile()).walkable||(null!=(e=t.children)?e.find(t=>t instanceof a):null)}attackMoveTo(t){var e;if(t=t.getFinalTile(),(e=new o({actor:this.character,target:t})).isReady())return e.start(),e}walkTo(t){var e;if(t=t.getFinalTile(),(e=new s({actor:this.character,target:t})).isReady())return e.start(),e}}},{"./Door":35,"./VisionCalculator":56,"./actions/AttackMoveAction":60,"./actions/WalkAction":65,"parallelio-tiles":118,"spark-starter":185}],32:[function(t,e,i){const r=t("spark-starter").Element,n=t("./View"),a=t("./Ship"),s=t("./Approach");class Confrontation extends r{start(){this.subject.encounter=this,this.game.mainView=this.view,this.game.add(this.subject.interrior),this.subject.interrior.container=this.view,this.game.add(this.opponent.interrior),this.opponent.interrior.container=this.view,this.approach.start()}}Confrontation.properties({game:{default:null},subject:{default:null},view:{calcul:function(){return new n}},opponent:{calcul:function(){return new a}},approach:{calcul:function(){return new s({subject:this.opponent.interrior,target:this.subject.interrior})}}}),e.exports=Confrontation},{"./Approach":28,"./Ship":50,"./View":55,"spark-starter":185}],33:[function(t,e,i){const r=t("spark-starter").Element,n=t("./LineOfSight"),a=t("parallelio-tiles").Direction;class DamagePropagation extends r{getTileContainer(){return this.tile.container}apply(){this.getDamaged().forEach(t=>{t.target.damage(t.damage)})}getInitialTiles(){return this.getTileContainer().inRange(this.tile,this.range)}getInitialDamages(){const t=this.getInitialTiles();return t.reduce((e,i)=>{if(i.damageable){const r=this.initialDamage(i,t.length);r&&e.push(r)}return e},[])}getDamaged(){var t;if(null==this._damaged){t=null;do{t=this.step(t)}while(t)}return this._damaged}step(t){return null==t?(this._damaged=this.getInitialDamages(),this._damaged):null!=this.extendedDamage?(t=this.extend(t),this._damaged=t.concat(this._damaged),t.length>0&&t):void 0}inDamaged(t,e){const i=e.findIndex(e=>e.target===t);return-1!==i&&i}extend(t){const e=this.getTileContainer();return t.reduce((t,i)=>{if(null==i.target.x)return t;const r=a.adjacents.reduce((t,r)=>{const n=e.getTile(i.target.x+r.x,i.target.y+r.y);return null!=n&&n.damageable&&!1===this.inDamaged(n,this._damaged)&&t.push(n),t},[]);return r.reduce((t,e)=>{const n=this.extendedDamage(e,i,r.length);if(n){const i=this.inDamaged(e,t);!1===i?t.push(n):t[i]=this.mergeDamage(t[i],n)}return t},t)},[])}mergeDamage(t,e){return{target:t.target,power:t.power+e.power,damage:t.damage+e.damage}}modifyDamage(t,e){return"function"==typeof t.modifyDamage?Math.floor(t.modifyDamage(e,this.type)):Math.floor(e)}}DamagePropagation.properties({tile:{default:null},power:{default:10},range:{default:1},type:{default:null}}),DamagePropagation.Normal=class Normal extends DamagePropagation{initialDamage(t,e){var i;if((i=this.modifyDamage(t,this.power))>0)return{target:t,power:this.power,damage:i}}},DamagePropagation.Thermic=class Thermic extends DamagePropagation{extendedDamage(t,e,i){var r,n;if(n=(e.damage-1)/2/i*Math.min(1,e.target.health/e.target.maxHealth*5),(r=this.modifyDamage(t,n))>0)return{target:t,power:n,damage:r}}initialDamage(t,e){var i,r;if(r=this.power/e,(i=this.modifyDamage(t,r))>0)return{target:t,power:r,damage:i}}},DamagePropagation.Kinetic=class Kinetic extends DamagePropagation{extendedDamage(t,e,i){var r,n;if(n=(e.power-e.damage)*Math.min(1,e.target.health/e.target.maxHealth*2)-1,(r=this.modifyDamage(t,n))>0)return{target:t,power:n,damage:r}}initialDamage(t,e){var i;if((i=this.modifyDamage(t,this.power))>0)return{target:t,power:this.power,damage:i}}modifyDamage(t,e){return"function"==typeof t.modifyDamage?Math.floor(t.modifyDamage(e,this.type)):Math.floor(.25*e)}mergeDamage(t,e){return{target:t.target,power:Math.floor((t.power+e.power)/2),damage:Math.floor((t.damage+e.damage)/2)}}},DamagePropagation.Explosive=function(){class Explosive extends DamagePropagation{getDamaged(){var t,e,i,r;this._damaged=[];const n=Math.pow(this.range+1,2);return i=this.power/n,(e=this.tile.health<=this.modifyDamage(this.tile,i))&&(i*=4),this._damaged=Array(...Array(n+1)).reduce(n=>(t=this.rng()*Math.PI*2,null!=(r=this.getTileHitByShard(e,t))&&n.push({target:r,power:i,damage:this.modifyDamage(r,i)}),n),[]),this._damaged}getTileHitByShard(t,e){var i,r,a,s;return i=this.getTileContainer(),r=this.range*this.rng(),a={x:this.tile.x+.5+r*Math.cos(e),y:this.tile.y+.5+r*Math.sin(e)},t?((s=new n(i,this.tile.x+.5,this.tile.y+.5,a.x,a.y)).traversableCallback=(e=>!t||null!=e&&this.traversableCallback(e)),s.getEndPoint().tile):i.getTile(Math.floor(a.x),Math.floor(a.y))}}return Explosive.properties({rng:{default:Math.random},traversableCallback:{default:function(t){return!("function"==typeof t.getSolid&&t.getSolid())}}}),Explosive}.call(this),e.exports=DamagePropagation},{"./LineOfSight":41,"parallelio-tiles":118,"spark-starter":185}],34:[function(t,e,i){const r=t("spark-starter").Element;class Damageable extends r{damage(t){this.health=Math.max(0,this.health-t)}whenNoHealth(){}}Damageable.properties({damageable:{default:!0},maxHealth:{default:1e3},health:{default:1e3,change:function(){if(this.health<=0)return this.whenNoHealth()}}}),e.exports=Damageable},{"spark-starter":185}],35:[function(t,e,i){const r=t("parallelio-tiles").Tiled,n={horizontal:"horizontal",vertical:"vertical"};class Door extends r{updateTileMembers(t){var e,i,r,n;if(null!=t&&(null!=(e=t.walkableMembers)&&e.removeProperty(this.openProperty),null!=(i=t.transparentMembers)&&i.removeProperty(this.openProperty)),this.tile)return null!=(r=this.tile.walkableMembers)&&r.addProperty(this.openProperty),null!=(n=this.tile.transparentMembers)?n.addProperty(this.openProperty):null}}Door.properties({tile:{change:function(t,e){return this.updateTileMembers(e)}},open:{default:!1},direction:{default:n.horizontal}}),Door.directions=n,e.exports=Door},{"parallelio-tiles":118}],36:[function(t,e,i){e.exports=t("spark-starter").Element},{"spark-starter":185}],37:[function(t,e,i){const r=t("spark-starter").Element,n=t("spark-starter").watchers.PropertyWatcher,a=t("./Confrontation");class EncounterManager extends r{init(){return this.locationWatcher.bind()}testEncounter(){if(this.rng()<=this.baseProbability)return this.startEncounter()}startEncounter(){return new a({subject:this.subject,game:this.game}).start()}}EncounterManager.properties({subject:{default:null},game:{default:null},baseProbability:{default:.2},locationWatcher:{calcul:function(){return new n({callback:()=>this.testEncounter(),property:this.subject.propertiesManager.getProperty("location")})}},rng:{default:Math.random}}),e.exports=EncounterManager},{"./Confrontation":32,"spark-starter":185}],38:[function(t,e,i){const r=t("parallelio-tiles").Tile;class Floor extends r{}Floor.properties({walkable:{composed:!0,default:!0},transparent:{composed:!0,default:!0}}),e.exports=Floor},{"parallelio-tiles":118}],39:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-timing"),a=t("./View"),s=t("./Player"),o=t("./saveEngines/LoaderCollection");class Game extends r{start(){return this.currentPlayer}add(t){return Array.isArray(t)?t.map(t=>this.add(t)):(t.game=this,t)}load(t){if(!this.saveEngine)throw new Error("No Save engine enabled");const e=this.saveEngine.load(t),i=this.loaders.load(e);this.add(i)}save(t){if(!this.saveEngine)throw new Error("No Save engine enabled");const e=this.savables.map(t=>t.getSaveData());this.saveEngine.save(e,t)}}Game.properties({timing:{calcul:function(){return new n}},mainView:{calcul:function(){if(this.views.length>0)return this.views.get(0);{const t=this.defaultViewClass;return this.add(new t)}}},views:{collection:!0},currentPlayer:{calcul:function(){if(this.players.length>0)return this.players.get(0);{const t=this.defaultPlayerClass;return this.add(new t)}}},players:{collection:!0},savables:{collection:!0},loaders:{calcul:function(){return new o}}}),Game.prototype.defaultViewClass=a,Game.prototype.defaultPlayerClass=s,e.exports=Game},{"./Player":46,"./View":55,"./saveEngines/LoaderCollection":72,"parallelio-timing":128,"spark-starter":185}],40:[function(t,e,i){const r=t("spark-starter").Collection;e.exports=class Inventory extends r{getByType(t){var e;if((e=this.filter(function(e){return e.type===t})).length)return e[0]}addByType(t,e,i=!1){var r;(r=this.getByType(t))||(r=this.initRessource(t)),i?r.partialChange(r.qte+e):r.qte+=e}initRessource(t,e){return t.initRessource(e)}}},{"spark-starter":185}],41:[function(t,e,i){e.exports=class LineOfSight{constructor(t,e=0,i=0,r=0,n=0){this.tiles=t,this.x1=e,this.y1=i,this.x2=r,this.y2=n}setX1(t){return this.x1=t,this.invalidade()}setY1(t){return this.y1=t,this.invalidade()}setX2(t){return this.x2=t,this.invalidade()}setY2(t){return this.y2=t,this.invalidade()}invalidade(){this.endPoint=null,this.success=null,this.calculated=!1}testTile(t,e,i){return null!=this.traversableCallback?this.traversableCallback(t,e,i):null!=t&&("function"==typeof t.getTransparent?t.getTransparent():null==t.transparent||t.transparent)}testTileAt(t,e,i,r){return this.testTile(this.tiles.getTile(Math.floor(t),Math.floor(e)),i,r)}reverseTracing(){var t,e;t=this.x1,e=this.y1,this.x1=this.x2,this.y1=this.y2,this.x2=t,this.y2=e,this.reversed=!this.reversed}calcul(){var t,e,i,r,n,a,s,o,l,c;for(n=(this.x2-this.x1)/(this.y2-this.y1),o=Math.abs(this.x2-this.x1)+Math.abs(this.y2-this.y1),i=this.x2-this.x1>=0,r=this.y2-this.y1>=0,a=l=this.x1,s=c=this.y1,this.reversed&&(a=i?l:Math.ceil(l)-1,s=r?c:Math.ceil(c)-1);o>Math.abs(l-this.x1)+Math.abs(c-this.y1)&&this.testTileAt(a,s,l,c);)t=i?Math.floor(l)+1:Math.ceil(l)-1,e=r?Math.floor(c)+1:Math.ceil(c)-1,this.x2-this.x1==0?c=e:this.y2-this.y1==0?l=t:Math.abs((t-l)/(this.x2-this.x1))<Math.abs((e-c)/(this.y2-this.y1))?(l=t,c=(t-this.x1)/n+this.y1):(l=(e-this.y1)*n+this.x1,c=e),a=i?l:Math.ceil(l)-1,s=r?c:Math.ceil(c)-1;o<=Math.abs(l-this.x1)+Math.abs(c-this.y1)?(this.endPoint={x:this.x2,y:this.y2,tile:this.tiles.getTile(Math.floor(this.x2),Math.floor(this.y2))},this.success=!0):(this.endPoint={x:l,y:c,tile:this.tiles.getTile(Math.floor(a),Math.floor(s))},this.success=!1)}forceSuccess(){return this.endPoint={x:this.x2,y:this.y2,tile:this.tiles.getTile(Math.floor(this.x2),Math.floor(this.y2))},this.success=!0,this.calculated=!0,!0}getSuccess(){return this.calculated||this.calcul(),this.success}getEndPoint(){return this.calculated||this.calcul(),this.endPoint}}},{}],42:[function(t,e,i){const r=t("spark-starter").Element;class Map extends r{_addToBondaries(t,e){(null==e.top||t.y<e.top)&&(e.top=t.y),(null==e.left||t.x<e.left)&&(e.left=t.x),(null==e.bottom||t.y>e.bottom)&&(e.bottom=t.y),(null==e.right||t.x>e.right)&&(e.right=t.x)}}Map.properties({locations:{collection:{closest:function(t,e){var i,r;return i=null,r=null,this.forEach(function(n){var a;a=n.dist(t,e),(null==i||r>a)&&(i=n,r=a)}),i},closests:function(t,e){var i;return(i=this.map(function(i){return{dist:i.dist(t,e),location:i}})).sort(function(t,e){return t.dist-e.dist}),this.copy(i.map(function(t){return t.location}))}}},boundaries:{calcul:function(){var t;return t={top:null,left:null,bottom:null,right:null},this.locations.forEach(e=>this._addToBondaries(e,t)),t},output:function(t){return Object.assign({},t)}}}),e.exports=Map},{"spark-starter":185}],43:[function(t,e,i){const r=t("parallelio-tiles").Tiled;class Obstacle extends r{updateWalkables(t){var e,i;if(null!=t&&null!=(e=t.walkableMembers)&&e.removeRef({name:"walkable",obj:this}),this.tile)return null!=(i=this.tile.walkableMembers)?i.setValueRef(!1,"walkable",this):null}}Obstacle.properties({tile:{change:function(t,e,i){return i(e),this.updateWalkables(e)}}}),e.exports=Obstacle},{"parallelio-tiles":118}],44:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-timing"),a=t("events");class PathWalk extends r{constructor(t,e,i){super(i),this.walker=t,this.path=e}start(){if(this.path.solution||this.path.calcul(),this.path.solution)return this.pathTimeout=this.timing.setTimeout(()=>this.finish(),this.totalTime),this.walker.tileMembers.addPropertyPath("position.tile",this),this.walker.offsetXMembers.addPropertyPath("position.offsetX",this),this.walker.offsetYMembers.addPropertyPath("position.offsetY",this)}stop(){return this.pathTimeout.pause()}finish(){return this.walker.tile=this.position.tile,this.walker.offsetX=this.position.offsetX,this.walker.offsetY=this.position.offsetY,this.emit("finished"),this.end()}interrupt(){return this.emit("interrupted"),this.end()}end(){return this.emit("end"),this.destroy()}destroy(){return this.walker.walk===this&&(this.walker.walk=null),this.walker.tileMembers.removeRef({name:"position.tile",obj:this}),this.walker.offsetXMembers.removeRef({name:"position.offsetX",obj:this}),this.walker.offsetYMembers.removeRef({name:"position.offsetY",obj:this}),this.pathTimeout.destroy(),this.propertiesManager.destroy(),this.removeAllListeners()}}PathWalk.include(a.prototype),PathWalk.properties({speed:{default:5},timing:{calcul:function(){var t;return null!=(t=this.walker.game)&&t.timing?this.walker.game.timing:new n}},pathLength:{calcul:function(){return this.path.solution.getTotalLength()}},totalTime:{calcul:function(){return this.pathLength/this.speed*1e3}},position:{calcul:function(t){return this.path.getPosAtPrc(t.propPath("pathTimeout.prc")||0)}}}),e.exports=PathWalk},{events:24,"parallelio-timing":128,"spark-starter":185}],45:[function(t,e,i){const r=t("spark-starter").Element,n=t("./LineOfSight"),a=t("parallelio-timing");class PersonalWeapon extends r{canBeUsed(){return this.charged}canUseOn(t){return this.canUseFrom(this.user.tile,t)}canUseFrom(t,e){return 1===this.range?this.inMeleeRange(t,e):this.inRange(t,e)&&this.hasLineOfSight(t,e)}inRange(t,e){var i,r;return r=e.tile||e,(null!=(i=t.dist(r))?i.length:null)<=this.range}inMeleeRange(t,e){var i;return i=e.tile||e,Math.abs(i.x-t.x)+Math.abs(i.y-t.y)===1}hasLineOfSight(t,e){var i,r;return r=e.tile||e,(i=new n(r.container,t.x+.5,t.y+.5,r.x+.5,r.y+.5)).traversableCallback=function(t){return t.walkable},i.getSuccess()}useOn(t){if(this.canBeUsed())return t.damage(this.power),this.charged=!1,this.recharge()}recharge(){this.charging=!0,this.chargeTimeout=this.timing.setTimeout(()=>(this.charging=!1,this.recharged()),this.rechargeTime)}recharged(){this.charged=!0}destroy(){if(this.chargeTimeout)return this.chargeTimeout.destroy()}}PersonalWeapon.properties({rechargeTime:{default:1e3},charged:{default:!0},charging:{default:!0},power:{default:10},dps:{calcul:function(t){return t.prop(this.powerProperty)/t.prop(this.rechargeTimeProperty)*1e3}},range:{default:10},user:{default:null},timing:{calcul:function(){return new a}}}),e.exports=PersonalWeapon},{"./LineOfSight":41,"parallelio-timing":128,"spark-starter":185}],46:[function(t,e,i){const r=t("spark-starter").Element;class Player extends r{setDefaults(){var t;if(t=0===this.game.players.length,this.game.players.add(this),t&&!this.controller&&this.game.defaultPlayerControllerClass){const t=this.game.defaultPlayerControllerClass;this.controller=new t}}canTargetActionOn(t){var e,i;return null!=(e=this.selectedAction||(null!=(i=this.selected)?i.defaultAction:null))&&"function"==typeof e.canTarget&&e.canTarget(t)}guessActionTarget(t){var e;return e=this.selected,"function"==typeof t.canTarget&&null==t.target&&t.actor!==e&&t.canTarget(e)?t.withTarget(e):t}canSelect(t){return"function"==typeof t.isSelectableBy&&t.isSelectableBy(this)}canFocusOn(t){return"function"==typeof t.IsFocusableBy?t.IsFocusableBy(this):"function"==typeof t.IsSelectableBy?t.IsSelectableBy(this):void 0}selectAction(t){t.isReady()?t.start():this.selectedAction=t}setActionTarget(t){var e;(e=(e=this.selectedAction||(null!=this.selected?this.selected.defaultAction:null)).withTarget(t)).isReady()?(e.start(),this.selectedAction=null):this.selectedAction=e}}Player.properties({name:{default:"Player"},focused:{},selected:{change:function(t,e){null!=e&&null!=e.propertiesManager&&e.propertiesManager.getProperty("selected")&&(e.selected=!1),null!=t&&null!=t.propertiesManager&&t.propertiesManager.getProperty("selected")&&(t.selected=this)}},globalActionProviders:{collection:!0},actionProviders:{calcul:function(t){var e,i;return e=t.prop(this.globalActionProvidersProperty).toArray(),(i=t.prop(this.selectedProperty))&&i.actionProvider&&e.push(i.actionProvider),e}},availableActions:{calcul:function(t){return t.prop(this.actionProvidersProperty).reduce((e,i)=>{var r;return r=t.prop(i.actionsProperty).toArray(),null!=t.prop(this.selectedProperty)&&(r=r.map(t=>this.guessActionTarget(t))),r?e.concat(r):e},[])}},selectedAction:{},controller:{change:function(t,e){this.controller&&(this.controller.player=this)}},game:{change:function(t,e){if(this.game)return this.setDefaults()}}}),e.exports=Player},{"spark-starter":185}],47:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-timing");class Projectile extends r{constructor(t){super(t),this.init()}init(){}launch(){this.moving=!0,this.pathTimeout=this.timing.setTimeout(()=>{this.deliverPayload(),this.moving=!1},this.pathLength/this.speed*1e3)}deliverPayload(){const t=new(0,this.propagationType)({tile:this.target.tile||this.target,power:this.power,range:this.blastRange});return t.apply(),this.payloadDelivered(),t}payloadDelivered(){return this.destroy()}destroy(){return this.propertiesManager.destroy()}}Projectile.properties({origin:{default:null},target:{default:null},power:{default:10},blastRange:{default:1},propagationType:{default:null},speed:{default:10},pathLength:{calcul:function(){var t;return null!=this.originTile&&null!=this.targetTile&&(t=this.originTile.dist(this.targetTile))?t.length:100}},originTile:{calcul:function(t){var e;if(null!=(e=t.prop(this.originProperty)))return e.tile||e}},targetTile:{calcul:function(t){var e;if(null!=(e=t.prop(this.targetProperty)))return e.tile||e}},container:{calcul:function(t){var e,i;return e=t.prop(this.originTileProperty),i=t.prop(this.targetTileProperty),e.container===i.container?e.container:t.prop(this.prcPathProperty)>.5?i.container:e.container}},x:{calcul:function(t){var e;return e=t.prop(this.startPosProperty),(t.prop(this.targetPosProperty).x-e.x)*t.prop(this.prcPathProperty)+e.x}},y:{calcul:function(t){var e;return e=t.prop(this.startPosProperty),(t.prop(this.targetPosProperty).y-e.y)*t.prop(this.prcPathProperty)+e.y}},startPos:{calcul:function(t){var e,i,r,n;return n=t.prop(this.originTileProperty),e=t.prop(this.containerProperty),r=this.startOffset,n.container!==e&&(i=e.dist(n.container),r.x+=i.x,r.y+=i.y),{x:n.x+r.x,y:n.y+r.y}},output:function(t){return Object.assign({},t)}},targetPos:{calcul:function(t){var e,i,r,n;return n=t.prop(this.targetTileProperty),e=t.prop(this.containerProperty),r=this.targetOffset,n.container!==e&&(i=e.dist(n.container),r.x+=i.x,r.y+=i.y),{x:n.x+r.x,y:n.y+r.y}},output:function(t){return Object.assign({},t)}},startOffset:{default:{x:.5,y:.5},output:function(t){return Object.assign({},t)}},targetOffset:{default:{x:.5,y:.5},output:function(t){return Object.assign({},t)}},prcPath:{calcul:function(){var t;return(null!=(t=this.pathTimeout)?t.prc:null)||0}},timing:{calcul:function(){return new n}},moving:{default:!1}}),e.exports=Projectile},{"parallelio-timing":128,"spark-starter":185}],48:[function(t,e,i){const r=t("spark-starter").Element;class Ressource extends r{partialChange(t){var e;return e=Math.max(this.minQte,Math.min(this.maxQte,t)),this.qte=e,t-e}}Ressource.properties({type:{default:null},qte:{default:0,ingest:function(t){if(null!==this.maxQte&&t>this.maxQte)throw new Error("Cant have more than "+this.maxQte+" of "+this.type.name);if(null!==this.minQte&&t<this.minQte)throw new Error("Cant have less than "+this.minQte+" of "+this.type.name);return t}},maxQte:{default:null},minQte:{default:0}}),e.exports=Ressource},{"spark-starter":185}],49:[function(t,e,i){const r=t("spark-starter").Element,n=t("./Ressource");class RessourceType extends r{initRessource(t){return"object"!=typeof t&&(t={qte:t}),t=Object.assign({},this.defaultOptions,t),new(0,this.ressourceClass)(t)}}RessourceType.properties({name:{default:null},ressourceClass:{default:n},defaultOptions:{default:{}}}),e.exports=RessourceType},{"./Ressource":48,"spark-starter":185}],50:[function(t,e,i){const r=t("spark-starter").Element,n=t("./Travel"),a=t("./actions/TravelAction"),s=t("./actions/ActionProvider"),o=t("./ShipInterior");class Ship extends r{travelTo(t){var e;(e=new n({traveller:this,startLocation:this.location,targetLocation:t})).valid&&(e.start(),this.travel=e)}}Ship.properties({location:{default:null},travel:{default:null},interrior:{calcul:function(){return new o({ship:this})}},actionProvider:{calcul:function(){const t=new s({owner:this});return t.actionsMembers.add(new a({actor:this})),t}},spaceCoodinate:{calcul:function(t){return t.prop(this.travelProperty)?t.propPath("travel.spaceCoodinate"):{x:t.propPath("location.x"),y:t.propPath("location.y")}}}}),e.exports=Ship},{"./ShipInterior":51,"./Travel":54,"./actions/ActionProvider":58,"./actions/TravelAction":64,"spark-starter":185}],51:[function(t,e,i){const r=t("parallelio-tiles").TileContainer,n=t("./generators/ShipInteriorGenerator");class ShipInterior extends r{setDefaults(){this.tiles.length>0||this.generate(),null==this.game.mainTileContainer&&(this.game.mainTileContainer=this)}generate(t){(t=t||new n).shipInterior=this,t.generate()}}ShipInterior.properties({x:{composed:!0,default:0},y:{composed:!0,default:0},container:{},ship:{},game:{change:function(t,e){if(t)return this.setDefaults()}},airlocks:{collection:!0,calcul:function(){return this.allTiles().filter(t=>"function"==typeof t.attachTo)}}}),e.exports=ShipInterior},{"./generators/ShipInteriorGenerator":68,"parallelio-tiles":118}],52:[function(t,e,i){const r=t("parallelio-tiles").Tiled,n=t("parallelio-timing"),a=t("./Damageable"),s=t("./Projectile");class ShipWeapon extends r{fire(){var t;if(this.canFire){return(t=new(0,this.projectileClass)({origin:this,target:this.target,power:this.power,blastRange:this.blastRange,propagationType:this.propagationType,speed:this.projectileSpeed,timing:this.timing})).launch(),this.charged=!1,this.recharge(),t}}recharge(){this.charging=!0,this.chargeTimeout=this.timing.setTimeout(()=>(this.charging=!1,this.recharged()),this.rechargeTime)}recharged(){if(this.charged=!0,this.autoFire)return this.fire()}}ShipWeapon.extend(a),ShipWeapon.properties({rechargeTime:{default:1e3},power:{default:10},blastRange:{default:1},propagationType:{default:null},projectileSpeed:{default:10},target:{default:null,change:function(){if(this.autoFire)return this.fire()}},charged:{default:!0},charging:{default:!0},enabled:{default:!0},autoFire:{default:!0},criticalHealth:{default:.3},canFire:{get:function(){return this.target&&this.enabled&&this.charged&&this.health/this.maxHealth>=this.criticalHealth}},timing:{calcul:function(){return new n}},projectileClass:{default:s}}),e.exports=ShipWeapon},{"./Damageable":34,"./Projectile":47,"parallelio-tiles":118,"parallelio-timing":128}],53:[function(t,e,i){const r=t("spark-starter").Element;class StarSystem extends r{constructor(t){super(t),this.init()}init(){}linkTo(t){if(!this.links.findStar(t))return this.addLink(new this.constructor.Link(this,t))}addLink(t){return this.links.add(t),t.otherStar(this).links.add(t),t}dist(t,e){var i,r;return i=this.x-t,r=this.y-e,Math.sqrt(i*i+r*r)}isSelectableBy(t){return!0}}StarSystem.properties({x:{},y:{},name:{},links:{collection:{findStar:function(t){return this.find(function(e){return e.star2===t||e.star1===t})}}}}),StarSystem.collenctionFn={closest:function(t,e){var i,r;return i=null,r=null,this.forEach(function(n){var a;a=n.dist(t,e),(null==i||r>a)&&(i=n,r=a)}),i},closests:function(t,e){var i;return(i=this.map(function(i){return{dist:i.dist(t,e),star:i}})).sort(function(t,e){return t.dist-e.dist}),this.copy(i.map(function(t){return t.star}))}},e.exports=StarSystem,StarSystem.Link=class Link extends r{constructor(t,e){super(),this.star1=t,this.star2=e}remove(){return this.star1.links.remove(this),this.star2.links.remove(this)}otherStar(t){return t===this.star1?this.star2:this.star1}getLength(){return this.star1.dist(this.star2.x,this.star2.y)}inBoundaryBox(t,e,i=0){var r,n,a,s;return r=Math.min(this.star1.x,this.star2.x)-i,a=Math.min(this.star1.y,this.star2.y)-i,n=Math.max(this.star1.x,this.star2.x)+i,s=Math.max(this.star1.y,this.star2.y)+i,t>=r&&t<=n&&e>=a&&e<=s}closeToPoint(t,e,i){var r,n,a,s,o,l,c,p,h,u;return!!this.inBoundaryBox(t,e,i)&&(r=this.star1,l={x:t,y:e},c=(o=this.star2).x-r.x,h=o.y-r.y,a=Math.atan(h/c),p=l.x-r.x,u=l.y-r.y,s=Math.sqrt(p*p+u*u),n=a-Math.atan(u/p),Math.abs(Math.sin(n)*s)<=i)}intersectLink(t){var e,i,r,n,a,s,o,l,c,p,h,u;return o=this.star1.x,p=this.star1.y,l=this.star2.x,h=this.star2.y,c=t.star1.x,u=t.star1.y,s=((n=t.star2.x-c)*(p-u)-(a=t.star2.y-u)*(o-c))/(-n*(r=h-p)+(i=l-o)*a),(e=(-r*(o-c)+i*(p-u))/(-n*r+i*a))>0&&e<1&&s>0&&s<1}}},{"spark-starter":185}],54:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-timing");class Travel extends r{start(t){this.valid&&(this.moving=!0,this.traveller.travel=this,this.pathTimeout=this.timing.setTimeout(()=>{this.traveller.location=this.targetLocation,this.traveller.travel=null,this.moving=!1},this.duration))}}Travel.properties({traveller:{default:null},startLocation:{default:null},targetLocation:{default:null},currentSection:{calcul:function(){return this.startLocation.links.findStar(this.targetLocation)}},duration:{default:1e3},moving:{default:!1},valid:{calcul:function(){var t,e;return this.targetLocation!==this.startLocation&&(null!=(null!=(t=this.targetLocation)?t.links:null)&&null!=(null!=(e=this.startLocation)?e.links:null)?null!=this.currentSection:void 0)}},timing:{calcul:function(){return new n}},spaceCoodinate:{calcul:function(t){var e,i,r,n,a;return n=t.propPath("startLocation.x"),a=t.propPath("startLocation.y"),e=t.propPath("targetLocation.x"),i=t.propPath("targetLocation.y"),{x:(n-e)*(r=t.propPath("pathTimeout.prc"))+e,y:(a-i)*r+i}}}}),e.exports=Travel},{"parallelio-timing":128,"spark-starter":185}],55:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-grids").Grid;class View extends r{setDefaults(){var t;this.bounds||(this.grid=this.grid||(null!=(t=this.game.mainViewProperty.value)?t.grid:null)||new n,this.bounds=this.grid.addCell())}destroy(){this.game=null}}View.properties({game:{change:function(t,e){if(this.game&&(this.game.views.add(this),this.setDefaults()),e)return e.views.remove(this)}},x:{default:0},y:{default:0},grid:{default:null},bounds:{default:null}}),e.exports=View},{"parallelio-grids":78,"spark-starter":185}],56:[function(t,e,i){const r=t("./LineOfSight"),n=t("parallelio-tiles").Direction,a=t("parallelio-tiles").TileContainer,s=t("parallelio-tiles").TileReference;e.exports=class VisionCalculator{constructor(t,e={x:.5,y:.5}){this.originTile=t,this.offset=e,this.pts={},this.visibility={},this.stack=[],this.calculated=!1}calcul(){for(this.init();this.stack.length;)this.step();this.calculated=!0}init(){var t;this.pts={},this.visibility={},[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}].forEach(t=>this.setPt(this.originTile.x+t.x,this.originTile.y+t.y,!0)),t=[{x:-1,y:-1},{x:-1,y:0},{x:-1,y:1},{x:-1,y:2},{x:2,y:-1},{x:2,y:0},{x:2,y:1},{x:2,y:2},{x:0,y:-1},{x:1,y:-1},{x:0,y:2},{x:1,y:2}],this.stack=t.map(t=>({x:this.originTile.x+t.x,y:this.originTile.y+t.y}))}setPt(t,e,i){var r;return this.pts[t+":"+e]=i,(r=[{x:0,y:0},{x:-1,y:0},{x:0,y:-1},{x:-1,y:-1}]).forEach(n=>this.addVisibility(t+n.x,e+n.y,i?1/r.length:0))}getPt(t,e){return this.pts[t+":"+e]}addVisibility(t,e,i){return null==this.visibility[t]&&(this.visibility[t]={}),null!=this.visibility[t][e]?this.visibility[t][e]+=i:this.visibility[t][e]=i,this}getVisibility(t,e){return null==this.visibility[t]||null==this.visibility[t][e]?0:this.visibility[t][e]}canProcess(t,e){return!this.stack.some(i=>i.x===t&&i.y===e)&&null==this.getPt(t,e)}step(){var t,e;if(e=this.stack.shift(),(t=new r(this.originTile.container,this.originTile.x+this.offset.x,this.originTile.y+this.offset.y,e.x,e.y)).reverseTracing(),t.traversableCallback=((e,i,r)=>{if(null!=e)return 1===this.getVisibility(e.x,e.y)?t.forceSuccess():e.transparent}),this.setPt(e.x,e.y,t.getSuccess()),t.getSuccess())return n.all.forEach(t=>{var i;if(i={x:e.x+t.x,y:e.y+t.y},this.canProcess(i.x,i.y))return this.stack.push(i)})}getBounds(){var t,e,i,r;for(i in t={top:null,left:null,bottom:null,right:null},e=this.visibility)for(r in e[i])(null==t.top||r<t.top)&&(t.top=r),(null==t.left||i<t.left)&&(t.left=i),(null==t.bottom||r>t.bottom)&&(t.bottom=r),(null==t.right||i>t.right)&&(t.right=i);return t}toContainer(){var t,e,i,r,n,o;const l=new a;for(n in l.owner=!1,e=this.visibility)for(o in t=e[n])r=t[o],i=this.originTile.container.getTile(n,o),0!==r&&null!=i&&((i=new s(i)).visibility=r,l.addTile(i));return l}toMap(){var t,e,i,r,n,a,s,o,l;for(l=t=i=(s=Object.assign({map:[]},this.getBounds())).top,r=s.bottom-1;i<=r?t<=r:t>=r;l=i<=r?++t:--t)for(s.map[l-s.top]=[],o=e=n=s.left,a=s.right-1;n<=a?e<=a:e>=a;o=n<=a?++e:--e)s.map[l-s.top][o-s.left]=this.getVisibility(o,l);return s}}},{"./LineOfSight":41,"parallelio-tiles":118}],57:[function(t,e,i){const r=t("spark-starter").Element,n=t("events");class Action extends r{withActor(t){return this.actor!==t?this.copyWith({actor:t}):this}copyWith(t){return new this.constructor(Object.assign({base:this.baseOrThis()},this.propertiesManager.getManualDataProperties(),t))}baseOrThis(){return this.base||this}start(){return this.actor.currentAction=this,this.execute()}validActor(){return null!=this.actor}isReady(){return this.validActor()}finish(){return this.emit("finished"),this.end()}interrupt(){return this.emit("interrupted"),this.end()}end(){return this.actor.currentAction===this&&(this.actor.currentAction=null),this.emit("end"),this.destroy()}destroy(){return this.propertiesManager.destroy()}}Action.include(n.prototype),Action.properties({actor:{},base:{}}),e.exports=Action},{events:24,"spark-starter":185}],58:[function(t,e,i){const r=t("spark-starter").Element;class ActionProvider extends r{}ActionProvider.properties({actions:{collection:!0,composed:!0},owner:{}}),e.exports=ActionProvider},{"spark-starter":185}],59:[function(t,e,i){const r=t("./WalkAction"),n=t("./TargetAction"),a=t("spark-starter").EventBind,s=t("spark-starter").watchers.PropertyWatcher;class AttackAction extends n{validTarget(){return this.targetIsAttackable()&&(this.canUseWeapon()||this.canWalkToTarget())}targetIsAttackable(){return this.target.damageable&&this.target.health>0}canMelee(){return Math.abs(this.target.tile.x-this.actor.tile.x)+Math.abs(this.target.tile.y-this.actor.tile.y)===1}canUseWeapon(){return null!=this.bestUsableWeapon}canUseWeaponAt(t){var e;return(null!=(e=this.actor.weapons)?e.length:null)&&this.actor.weapons.find(e=>e.canUseFrom(t,this.target))}canWalkToTarget(){return this.walkAction.isReady()}useWeapon(){return this.bestUsableWeapon.useOn(this.target),this.finish()}execute(){return null!=this.actor.walk&&this.actor.walk.interrupt(),null!=this.bestUsableWeapon?this.bestUsableWeapon.charged?this.useWeapon():this.weaponChargeWatcher.bind():(this.walkAction.on("finished",()=>{if(this.interruptBinder.unbind(),this.walkAction.destroy(),this.walkActionProperty.invalidate(),this.isReady())return this.start()}),this.interruptBinder.bindTo(this.walkAction),this.walkAction.execute())}}AttackAction.properties({walkAction:{calcul:function(){var t;return(t=new r({actor:this.actor,target:this.target.tile,parent:this.parent})).pathFinder.arrivedCallback=(t=>this.canUseWeaponAt(t.tile)),t}},bestUsableWeapon:{calcul:function(t){var e,i;return t.propPath("actor.tile"),null!=(e=this.actor.weapons)&&e.length?((i=this.actor.weapons.filter(t=>t.canUseOn(this.target))).sort((t,e)=>e.dps-t.dps),i[0]):null}},interruptBinder:{calcul:function(){return new a("interrupted",null,()=>this.interrupt())},destroy:!0},weaponChargeWatcher:{calcul:function(){return new s({callback:()=>{if(this.bestUsableWeapon.charged)return this.useWeapon()},property:this.bestUsableWeapon.propertiesManager.getProperty("charged")})},destroy:!0}}),e.exports=AttackAction},{"./TargetAction":62,"./WalkAction":65,"spark-starter":185}],60:[function(t,e,i){const r=t("./WalkAction"),n=t("./AttackAction"),a=t("./TargetAction"),s=t("parallelio-pathfinder"),o=t("../LineOfSight"),l=t("spark-starter").watchers.PropertyWatcher,c=t("spark-starter").EventBind;class AttackMoveAction extends a{isEnemy(t){var e;return null!=(e=this.actor.owner)&&"function"==typeof e.isEnemy?e.isEnemy(t):null}validTarget(){return this.walkAction.validTarget()}testEnemySpotted(){if(this.enemySpottedProperty.invalidate(),this.enemySpotted)return this.attackAction=new n({actor:this.actor,target:this.enemySpotted}),this.attackAction.isReady()?(this.attackAction.on("finished",()=>{if(this.isReady())return this.execute()}),this.interruptBinder.bindTo(this.attackAction),this.walkAction.interrupt(),this.walkActionProperty.invalidate(),this.attackAction.execute()):null}execute(){if(!this.testEnemySpotted())return this.walkAction.on("finished",()=>this.finish()),this.interruptBinder.bindTo(this.walkAction),this.tileWatcher.bind(),this.walkAction.execute()}}AttackMoveAction.properties({walkAction:{calcul:function(){return new r({actor:this.actor,target:this.target,parent:this.parent})}},enemySpotted:{calcul:function(){var t;return this.path=new s(this.actor.tile.container,this.actor.tile,!1,{validTile:t=>t.transparent&&new o(this.actor.tile.container,this.actor.tile.x,this.actor.tile.y,t.x,t.y).getSuccess(),arrived:t=>(t.enemy=t.tile.children.find(t=>this.isEnemy(t)),t.enemy),efficiency:t=>{}}),this.path.calcul(),null!=(t=this.path.solution)?t.enemy:null}},tileWatcher:{calcul:function(){return new l({callback:()=>this.testEnemySpotted(),property:this.actor.propertiesManager.getProperty("tile")})},destroy:!0},interruptBinder:{calcul:function(){return new c("interrupted",null,()=>this.interrupt())},destroy:!0}}),e.exports=AttackMoveAction},{"../LineOfSight":41,"./AttackAction":59,"./TargetAction":62,"./WalkAction":65,"parallelio-pathfinder":99,"spark-starter":185}],61:[function(t,e,i){const r=t("./ActionProvider");class SimpleActionProvider extends r{}SimpleActionProvider.properties({actions:{calcul:function(){var t;return"object"==typeof(t=this.actionOptions||this.constructor.actions||[])&&(t=Object.keys(t).map(function(e){return t[e]})),t.map(t=>{if("function"==typeof t.withTarget)return t.withTarget(this);if("function"==typeof t){return new t({target:this})}return t})}}}),e.exports=SimpleActionProvider},{"./ActionProvider":58}],62:[function(t,e,i){const r=t("./Action");class TargetAction extends r{withTarget(t){return this.target!==t?this.copyWith({target:t}):this}canTarget(t){var e;if((e=this.withTarget(t)).validTarget())return e}validTarget(){return null!=this.target}isReady(){return super.isReady()&&this.validTarget()}}TargetAction.properties({target:{}}),e.exports=TargetAction},{"./Action":57}],63:[function(t,e,i){const r=t("./ActionProvider");class TiledActionProvider extends r{validActionTile(t){return null!=t}prepareActionTile(t){t.actionProvider||(t.actionProvider=new r({owner:t}))}}TiledActionProvider.properties({originTile:{calcul:function(t){return t.propPath("owner.tile")}},actionTiles:{collection:!0,calcul:function(t){var e;return(e=t.prop(this.originTileProperty))?this.actionTilesCoord.map(t=>e.getRelativeTile(t.x,t.y)).filter(t=>this.validActionTile(t)):[]},itemAdded:function(t){return this.prepareActionTile(t),t.actionProvider.actionsMembers.addProperty(this.actionsProperty)},itemRemoved:function(t){return t.actionProvider.actionsMembers.removeProperty(this.actionsProperty)}}}),TiledActionProvider.prototype.actionTilesCoord=[{x:0,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:0,y:1}],e.exports=TiledActionProvider},{"./ActionProvider":58}],64:[function(t,e,i){const r=t("./TargetAction"),n=t("../Travel");class TravelAction extends r{validTarget(){return this.travel.valid}execute(){return this.travel.start()}}TravelAction.properties({travel:{calcul:function(){return new n({traveller:this.actor,startLocation:this.actor.location,targetLocation:this.target})}}}),e.exports=TravelAction},{"../Travel":54,"./TargetAction":62}],65:[function(t,e,i){const r=t("parallelio-pathfinder"),n=t("../PathWalk"),a=t("./TargetAction");class WalkAction extends a{execute(){return null!=this.actor.walk&&this.actor.walk.interrupt(),this.walk=this.actor.walk=new n(this.actor,this.pathFinder),this.actor.walk.on("finished",()=>this.finish()),this.actor.walk.on("interrupted",()=>this.interrupt()),this.actor.walk.start()}destroy(){if(super.destroy(),this.walk)return this.walk.destroy()}validTarget(){return!!this.target&&(this.pathFinder.calcul(),null!=this.pathFinder.solution)}}WalkAction.properties({pathFinder:{calcul:function(){return new r(this.actor.tile.container,this.actor.tile,this.target,{validTile:t=>"function"==typeof this.actor.canGoOnTile?this.actor.canGoOnTile(t):t.walkable})}}}),e.exports=WalkAction},{"../PathWalk":44,"./TargetAction":62,"parallelio-pathfinder":99}],66:[function(t,e,i){const r=t("spark-starter").Element,n=t("parallelio-tiles").TileContainer,a=t("parallelio-tiles").Tile,s=t("parallelio-tiles").Direction,o=t("../Airlock"),l=t("../Floor");class AirlockGenerator extends r{generate(){const t=this.getPos();this.structure.allTiles().map(e=>{(e=e.copyAndRotate(this.direction.angle)).x+=t.x,e.y+=t.y,this.tileContainer.removeTileAt(e.x,e.y),this.tileContainer.addTile(e)})}getPos(){const t=this.direction,e=this.tileContainer.boundaries;let i=0;for(;i<20;){const r=this.getAxisPos(t.x,e.left,e.right),n=this.getAxisPos(t.y,e.top,e.bottom),a=this.tileContainer.getTile(r+t.getInverse().x,n+t.getInverse().y);if(a&&a.walkable)return{x:r,y:n};i++}}getAxisPos(t,e,i){return 0===t?Math.floor(this.rng()*(i-e))+e:1===t?i:e}airlockFactory(t){return t.direction=s.up,new o(t)}}AirlockGenerator.properties({tileContainer:{},direction:{default:s.up},rng:{default:Math.random},wallFactory:{calcul:function(){return this.parent?this.parent.wallFactory:function(t){return new a(t)}}},floorFactory:{calcul:function(){return this.parent?this.parent.wallFactory:function(t){return new l(t)}}},structure:{calcul:function(){const t=new n,e=this.wallFactory,i=this.floorFactory,r=this.airlockFactory.bind(this);return t.loadMatrix([[e,r,e],[e,i,e]],{x:-1,y:-1}),t}}}),e.exports=AirlockGenerator},{"../Airlock":27,"../Floor":38,"parallelio-tiles":118,"spark-starter":185}],67:[function(t,e,i){var r=[].indexOf;const n=t("spark-starter").Element,a=t("parallelio-tiles").TileContainer,s=t("parallelio-tiles").Tile,o=t("parallelio-tiles").Direction,l=t("../Door");class RoomGenerator extends n{initTiles(){this.finalTiles=null,this.rooms=[],this.free=this.plan.allTiles().filter(t=>!o.all.some(e=>null==this.plan.getTile(t.x+e.x,t.y+e.y)))}generate(){this.getTiles().forEach(t=>{this.tileContainer.addTile(t)})}calcul(){for(this.initTiles();this.step()||this.newRoom(););this.createDoors(),this.makeFinalTiles()}floorFactory(t){return new s(t.x,t.y)}doorFactory(t){return this.floorFactory(t)}makeFinalTiles(){this.finalTiles=this.plan.allTiles().map(t=>{var e;if(null!=t.factory)return e={x:t.x,y:t.y},null!=t.factoryOptions&&(e=Object.assign(e,t.factoryOptions)),t.factory(e)}).filter(t=>null!=t)}getTiles(){return null==this.finalTiles&&this.calcul(),this.finalTiles}newRoom(){if(this.free.length)return this.volume=Math.floor(this.rng()*(this.maxVolume-this.minVolume))+this.minVolume,this.room=new RoomGenerator.Room,this.room}randomDirections(){var t,e,i,r;for(e=null,r=null,t=(i=o.adjacents.slice()).length;t;)e=Math.floor(this.rng()*t),r=i[--t],i[t]=i[e],i[e]=r;return i}step(){var t,e;if(this.room){if(this.free.length&&this.room.tiles.length<this.volume-1){if(this.room.tiles.length){for(e=this.randomDirections(),t=!1;e.length&&!t;)t=this.expand(this.room,e.pop(),this.volume);return t||this.roomDone(),t}return this.allocateTile(this.randomFreeTile(),this.room),!0}return this.roomDone(),!1}}roomDone(){this.rooms.push(this.room),this.allocateWalls(this.room),this.room=null}expand(t,e,i=0){return t.tiles.slice().reduce((r,n)=>{if(0===i||t.tiles.length<i){const i=this.tileOffsetIsFree(n,e);if(i){this.allocateTile(i,t),r=!0;const a=this.tileOffsetIsFree(n,e,2);a&&!this.tileOffsetIsFree(n,e,3)&&this.allocateTile(a,t)}}return r},!1)}allocateWalls(t){var e,i,n,a,s,l,c,p,h;for(p=[],i=0,n=(c=t.tiles).length;i<n;i++)h=c[i],p.push(function(){var i,n,c,p;for(p=[],i=0,n=(c=o.all).length;i<n;i++)e=c[i],null!=(a=this.plan.getTile(h.x+e.x,h.y+e.y))&&a.room!==t?(r.call(o.corners,e)<0&&(l=this.plan.getTile(h.x+2*e.x,h.y+2*e.y),s=null!=(null!=l?l.room:null)?l.room:null,t.addWall(a,s),null!=s&&s.addWall(a,t)),this.wallFactory&&(a.factory=(t=>this.wallFactory(t)),a.factory.base=this.wallFactory),p.push(this.allocateTile(a))):p.push(null);return p}.call(this));return p}createDoors(){var t,e,i,r,n,a,s,o;for(a=[],i=0,r=(n=this.rooms).length;i<r;i++)s=n[i],a.push(function(){var i,r,n,a;for(a=[],i=0,r=(n=s.wallsByRooms()).length;i<r;i++)null!=(o=n[i]).room&&s.doorsForRoom(o.room)<1?((e=o.tiles[Math.floor(this.rng()*o.tiles.length)]).factory=(t=>this.doorFactory(t)),e.factory.base=this.doorFactory,t=this.plan.getTile(e.x+1,e.y),e.factoryOptions={direction:t.factory&&t.factory.base===this.floorFactory?l.directions.vertical:l.directions.horizontal},s.addDoor(e,o.room),a.push(o.room.addDoor(e,s))):a.push(null);return a}.call(this));return a}allocateTile(t,e=null){var i;if(null!=e&&(e.addTile(t),t.factory=(t=>this.floorFactory(t)),t.factory.base=this.floorFactory),(i=this.free.indexOf(t))>-1)return this.free.splice(i,1)}tileOffsetIsFree(t,e,i=1){return this.tileIsFree(t.x+e.x*i,t.y+e.y*i)}tileIsFree(t,e){var i;return null!=(i=this.plan.getTile(t,e))&&r.call(this.free,i)>=0&&i}randomFreeTile(){return this.free[Math.floor(this.rng()*this.free.length)]}}RoomGenerator.properties({tileContainer:{calcul:function(){return new a}},rng:{default:Math.random},maxVolume:{default:25},minVolume:{default:50},width:{default:30},height:{default:15},plan:{calcul:function(){const t=new a;for(let e=0;e<this.width;e++)for(let i=0;i<this.height;i++)t.addTile(new s(e,i));return t}}}),RoomGenerator.Room=class Room{constructor(){this.tiles=[],this.walls=[],this.doors=[]}addTile(t){this.tiles.push(t),t.room=this}containsWall(t){var e,i,r,n;for(e=0,i=(r=this.walls).length;e<i;e++)if((n=r[e]).tile===t)return n;return!1}addWall(t,e){var i;(i=this.containsWall(t))?i.nextRoom=e:this.walls.push({tile:t,nextRoom:e})}wallsByRooms(){var t,e,i,r,n,a,s;for(a=[],n=[],t=0,e=(r=this.walls).length;t<e;t++)s=r[t],-1===(i=a.indexOf(s.nextRoom))&&(i=a.length,a.push(s.nextRoom),n.push({room:s.nextRoom,tiles:[]})),n[i].tiles.push(s.tile);return n}addDoor(t,e){return this.doors.push({tile:t,nextRoom:e})}doorsForRoom(t){return this.doors.filter(e=>e.nextRoom===t).map(t=>t.tile)}},e.exports=RoomGenerator},{"../Door":35,"parallelio-tiles":118,"spark-starter":185}],68:[function(t,e,i){const r=t("parallelio-tiles").Tile,n=t("./RoomGenerator"),a=t("./AirlockGenerator"),s=t("../Floor"),o=t("../AutomaticDoor"),l=t("spark-starter").Element,c=t("parallelio-tiles").Direction;class ShipInteriorGenerator extends l{generate(){return this.roomGenerator.generate(),this.airlockGenerators.forEach(t=>{t.generate()}),this.shipInterior}wallFactory(t){return new r(t.x,t.y).tap(function(){this.walkable=!1})}floorFactory(t){return new s(t.x,t.y)}doorFactory(t){return new s(t.x,t.y).tap(function(){this.addChild(new o({direction:t.direction}))})}}ShipInteriorGenerator.properties({shipInterior:{},rng:{default:Math.random},roomGenerator:{calcul:function(){const t=new n({tileContainer:this.shipInterior,rng:this.rng});return t.wallFactory=this.wallFactory,t.floorFactory=this.floorFactory,t.doorFactory=this.doorFactory,t}},airlockGenerators:{calcul:function(){return[new a({tileContainer:this.shipInterior,rng:this.rng,direction:c.up}),new a({tileContainer:this.shipInterior,rng:this.rng,direction:c.down})]}}}),e.exports=ShipInteriorGenerator},{"../AutomaticDoor":29,"../Floor":38,"./AirlockGenerator":66,"./RoomGenerator":67,"parallelio-tiles":118,"spark-starter":185}],69:[function(t,e,i){const r=t("spark-starter").Element,n=t("../Map"),a=t("../StarSystem"),s=t("parallelio-strings").starNames;class StarMapGenerator extends r{constructor(t){super(),this.opt=Object.assign({},this.defOpt,t)}generate(){const t=this.opt.mapClass;return this.map=new t,this.stars=this.map.locations.copy(),this.links=[],this.createStars(this.opt.nbStars),this.makeLinks(),this.map}createStars(t){return Array.from(Array(t),()=>this.createStar())}createStar(t={}){var e,i,r;if(!t.x||!t.y){if(null==(i=this.randomStarPos()))return null;t=Object.assign({},t,{x:i.x,y:i.y})}if(!t.name){if(null==(e=this.randomStarName()))return null;t=Object.assign({},t,{name:e})}return r=new(0,this.opt.starClass)(t),this.map.locations.push(r),this.stars.push(r),r}randomStarPos(){var t,e;for(t=0;e={x:Math.floor(this.opt.rng()*(this.opt.maxX-this.opt.minX)+this.opt.minX),y:Math.floor(this.opt.rng()*(this.opt.maxY-this.opt.minY)+this.opt.minY)},t<10&&this.stars.find(t=>t.dist(e.x,e.y)<=this.opt.minStarDist);)t++;if(!(t>=10))return e}randomStarName(){var t,e,i;if(null!=(i=this.opt.starNames)&&i.length)return e=Math.floor(this.opt.rng()*this.opt.starNames.length),t=this.opt.starNames[e],this.opt.starNames.splice(e,1),t}makeLinks(){return this.stars.forEach(t=>this.makeLinksFrom(t))}makeLinksFrom(t){var e,i,r,n,a,s;if(s=this.opt.linkTries,(n=this.opt.linksByStars-t.links.count())>0&&(i=this.stars.filter(e=>e!==t&&!t.links.findStar(e)).closests(t.x,t.y)).count()>0){for(a=[];e=i.shift(),r=this.createLink(t,e),this.validateLink(r)?(this.links.push(r),t.addLink(r),n-=1):s-=1,n>0&&s>0&&i.count()>0;)a.push(null);return a}}createLink(t,e){return new(0,this.opt.linkClass)(t,e)}validateLink(t){return!this.stars.find(e=>e!==t.star1&&e!==t.star2&&t.closeToPoint(e.x,e.y,this.opt.minLinkDist))&&!this.links.find(e=>e.intersectLink(t))}}StarMapGenerator.prototype.defOpt={nbStars:20,minX:0,maxX:500,minY:0,maxY:500,minStarDist:20,minLinkDist:20,linksByStars:3,linkTries:3,mapClass:n,starClass:a,linkClass:a.Link,rng:Math.random,starNames:s},e.exports=StarMapGenerator},{"../Map":42,"../StarSystem":53,"parallelio-strings":109,"spark-starter":185}],70:[function(t,e,i){e.exports={Airlock:t("./Airlock"),Approach:t("./Approach"),AutomaticDoor:t("./AutomaticDoor"),Character:t("./Character"),CharacterAI:t("./CharacterAI"),Confrontation:t("./Confrontation"),Damageable:t("./Damageable"),DamagePropagation:t("./DamagePropagation"),Door:t("./Door"),Element:t("./Element"),EncounterManager:t("./EncounterManager"),Floor:t("./Floor"),Game:t("./Game"),Inventory:t("./Inventory"),LineOfSight:t("./LineOfSight"),Map:t("./Map"),Obstacle:t("./Obstacle"),PathWalk:t("./PathWalk"),PersonalWeapon:t("./PersonalWeapon"),Player:t("./Player"),Projectile:t("./Projectile"),Ressource:t("./Ressource"),RessourceType:t("./RessourceType"),Ship:t("./Ship"),ShipInterior:t("./ShipInterior"),ShipWeapon:t("./ShipWeapon"),StarSystem:t("./StarSystem"),Travel:t("./Travel"),View:t("./View"),VisionCalculator:t("./VisionCalculator"),actions:{Action:t("./actions/Action"),ActionProvider:t("./actions/ActionProvider"),AttackAction:t("./actions/AttackAction"),AttackMoveAction:t("./actions/AttackMoveAction"),SimpleActionProvider:t("./actions/SimpleActionProvider"),TargetAction:t("./actions/TargetAction"),TiledActionProvider:t("./actions/TiledActionProvider"),TravelAction:t("./actions/TravelAction"),WalkAction:t("./actions/WalkAction")},generators:{AirlockGenerator:t("./generators/AirlockGenerator"),RoomGenerator:t("./generators/RoomGenerator"),ShipInteriorGenerator:t("./generators/ShipInteriorGenerator"),StarMapGenerator:t("./generators/StarMapGenerator")},saveEngines:{LoaderCollection:t("./saveEngines/LoaderCollection"),SimpleLoader:t("./saveEngines/SimpleLoader"),SimpleSavable:t("./saveEngines/SimpleSavable")}}},{"./Airlock":27,"./Approach":28,"./AutomaticDoor":29,"./Character":30,"./CharacterAI":31,"./Confrontation":32,"./DamagePropagation":33,"./Damageable":34,"./Door":35,"./Element":36,"./EncounterManager":37,"./Floor":38,"./Game":39,"./Inventory":40,"./LineOfSight":41,"./Map":42,"./Obstacle":43,"./PathWalk":44,"./PersonalWeapon":45,"./Player":46,"./Projectile":47,"./Ressource":48,"./RessourceType":49,"./Ship":50,"./ShipInterior":51,"./ShipWeapon":52,"./StarSystem":53,"./Travel":54,"./View":55,"./VisionCalculator":56,"./actions/Action":57,"./actions/ActionProvider":58,"./actions/AttackAction":59,"./actions/AttackMoveAction":60,"./actions/SimpleActionProvider":61,"./actions/TargetAction":62,"./actions/TiledActionProvider":63,"./actions/TravelAction":64,"./actions/WalkAction":65,"./generators/AirlockGenerator":66,"./generators/RoomGenerator":67,"./generators/ShipInteriorGenerator":68,"./generators/StarMapGenerator":69,"./saveEngines/LoaderCollection":72,"./saveEngines/SimpleLoader":73,"./saveEngines/SimpleSavable":74}],71:[function(t,e,i){const r=t("./libs");e.exports=Object.assign({},r,{grids:t("parallelio-grids"),PathFinder:t("parallelio-pathfinder"),strings:t("parallelio-strings"),tiles:t("parallelio-tiles"),Timing:t("parallelio-timing"),wiring:t("parallelio-wiring"),Spark:t("spark-starter")})},{"./libs":70,"parallelio-grids":78,"parallelio-pathfinder":99,"parallelio-strings":109,"parallelio-tiles":118,"parallelio-timing":128,"parallelio-wiring":135,"spark-starter":185}],72:[function(t,e,i){const r=t("spark-starter").Collection;e.exports=class LoaderCollection extends r{load(t){return t.map(t=>{const e=this.loaders.find(e=>e.match(t));e&&e.load(t)})}}},{"spark-starter":185}],73:[function(t,e,i){e.exports=class SimpleLoader{constructor(t,e=null){this.construct=t,this.alias=e||t.name}register(t){t.loaders.add(this)}match(t){return t.typeAlias===this.alias}load(t){return new(0,this.construct)(t)}}},{}],74:[function(t,e,i){const r=t("./SimpleLoader");e.exports=class SimpleSavable{constructor(t,e=null,i=null){this.obj=t,this.alias=e||t.constructor.name,this.loader=i}makeDefaultLoader(){return this.obj.constructor.loader||(this.obj.constructor.loader=new r(this.obj.constructor,this.alias)),this.obj.constructor.loader}register(t){this.loader||(this.loader=this.makeDefaultLoader()),this.loader.register(t),t.savables.add(this)}getRawData(){return"function"==typeof this.obj.getSaveData?this.obj.getSaveData():this.obj.propertiesManager.getManualDataProperties()}getSaveData(){return Object.assign({typeAlias:this.alias},this.getRawData())}}},{"./SimpleLoader":73}],75:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Grid=i:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Grid=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,r=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("spark-starter").EventEmitter,n=e.hasOwnProperty("GridCell")?e.GridCell:t("./GridCell"),a=e.hasOwnProperty("GridRow")?e.GridRow:t("./GridRow");return function(){class Grid extends i{addCell(t=null){var e,i;return t||(t=new n),i=this.getFreeSpot(),(e=this.rows.get(i.row))||(e=this.addRow()),e.addCell(t),t}addRow(t=null){return t||(t=new a),this.rows.push(t),t}getFreeSpot(){var t;return t=null,this.rows.some(e=>{if(e.cells.length<this.maxColumns)return t={row:e.rowPosition,column:e.cells.length}}),t||(t=this.maxColumns>this.rows.length?{row:this.rows.length,column:0}:{row:0,column:this.maxColumns+1}),t}}return Grid.extend(r),Grid.properties({rows:{collection:!0,itemAdded:function(t){return t.grid=this},itemRemoved:function(t){if(t.grid===this)return t.grid=null}},maxColumns:{calcul:function(t){return t.prop("rows").reduce(function(e,i){return Math.max(e,t.prop("cells",i).length)},0)}}}),Grid}.call(this)})},{"./GridCell":76,"./GridRow":77,"spark-starter":98}],76:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.GridCell=i:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.GridCell=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,r=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("spark-starter").EventEmitter;return function(){class GridCell extends i{}return GridCell.extend(r),GridCell.properties({grid:{calcul:function(t){return t.prop("grid",t.prop("row"))}},row:{},columnPosition:{calcul:function(t){var e;if(e=t.prop("row"))return t.prop("cells",e).indexOf(this)}},width:{calcul:function(t){return 1/t.prop("cells",t.prop("row")).length}},left:{calcul:function(t){return t.prop("width")*t.prop("columnPosition")}},right:{calcul:function(t){return t.prop("width")*(t.prop("columnPosition")+1)}},height:{calcul:function(t){return t.prop("height",t.prop("row"))}},top:{calcul:function(t){return t.prop("top",t.prop("row"))}},bottom:{calcul:function(t){return t.prop("bottom",t.prop("row"))}}}),GridCell}.call(this)})},{"spark-starter":98}],77:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.GridRow=i:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.GridRow=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element,r=e.hasOwnProperty("EventEmitter")?e.EventEmitter:t("spark-starter").EventEmitter,n=e.hasOwnProperty("GridCell")?e.GridCell:t("./GridCell");return function(){class GridRow extends i{addCell(t=null){return t||(t=new n),this.cells.push(t),t}}return GridRow.extend(r),GridRow.properties({grid:{},cells:{collection:!0,itemAdded:function(t){return t.row=this},itemRemoved:function(t){if(t.row===this)return t.row=null}},rowPosition:{calcul:function(t){var e;if(e=t.prop("grid"))return t.prop("rows",e).indexOf(this)}},height:{calcul:function(t){return 1/t.prop("rows",t.prop("grid")).length}},top:{calcul:function(t){return t.prop("height")*t.prop("rowPosition")}},bottom:{calcul:function(t){return t.prop("height")*(t.prop("rowPosition")+1)}}}),GridRow}.call(this)})},{"./GridCell":76,"spark-starter":98}],78:[function(t,e,i){e&&(e.exports={Grid:t("./Grid.js"),GridCell:t("./GridCell.js"),GridRow:t("./GridRow.js")})},{"./Grid.js":75,"./GridCell.js":76,"./GridRow.js":77}],79:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Binder=i:(null==this.Spark&&(this.Spark={}),this.Spark.Binder=i)}(function(){return function(){class Binder{bind(){return this.binded||null==this.callback||null==this.target||this.doBind(),this.binded=!0}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&null!=this.callback&&null!=this.target&&this.doUnbind(),this.binded=!1}doUnbind(){throw new Error("Not implemented")}equals(t){return this.constructor.compareRefered(t,this)}getRef(){}static compareRefered(t,e){return t===e||null!=t&&null!=e&&t.constructor===e.constructor&&this.compareRef(t.ref,e.ref)}static compareRef(t,e){return null!=t&&null!=e&&(t===e||Array.isArray(t)&&Array.isArray(t)&&t.every((i,r)=>this.compareRefered(t[r],e[r]))||"object"==typeof t&&"object"==typeof e&&Object.keys(t).join()===Object.keys(e).join()&&Object.keys(t).every(i=>this.compareRefered(t[i],e[i])))}}return Object.defineProperty(Binder.prototype,"ref",{get:function(){return this.getRef()}}),Binder}.call(this)})},{}],80:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Collection=i:(null==this.Spark&&(this.Spark={}),this.Spark.Collection=i)}(function(){var t;return t=function(){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,i=null){return null==i&&(i=function(t,e){return t===e}),t=this.copy(t.slice()),this.count()!==t.length||(e?this.some(function(e,r){return!i(t.get(r),e)}):this.some(function(e){return!t.pluck(function(t){return i(e,t)})}))}get(t){return this._array[t]}set(t,e){var i;return this._array[t]!==e&&(i=this.toArray(),this._array[t]=e,this.changed(i)),e}add(t){if(!this._array.includes(t))return this.push(t)}remove(t){var e,i;if(-1!==(e=this._array.indexOf(t)))return i=this.toArray(),this._array.splice(e,1),this.changed(i)}pluck(t){var e,i,r;return(i=this._array.findIndex(t))>-1?(r=this.toArray(),e=this._array[i],this._array.splice(i,1),this.changed(r),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var i;return"object"==typeof t?(i=class extends(this){},Object.assign(i.prototype,t),new i(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,i){return t[i]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}return Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){return Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){return Collection.prototype[t]=function(...e){var i,r;return i=this.toArray(),r=this._array[t](...e),this.changed(i),r}}),Collection}.call(this),Object.defineProperty(t.prototype,"length",{get:function(){return this.count()}}),("undefined"!=typeof Symbol&&null!==Symbol?Symbol.iterator:void 0)&&(t.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),t})},{}],81:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Element=i:(null==this.Spark&&(this.Spark={}),this.Spark.Element=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Property")?e.Property:t("./Property"),r=e.hasOwnProperty("Mixable")?e.Mixable:t("./Mixable");return class Element extends r{tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}getFinalProperties(){return null!=this._properties?["_properties"].concat(this._properties.map(function(t){return t.name})):[]}extended(t){var e,r,n,a,s,o;if(null!=this._properties){for(o=[],e=0,r=(s=this._properties).length;e<r;e++)a=s[e],n=Object.assign({},a.options),o.push(new i(a.name,n).bind(t));return o}}static property(t,e){return new i(t,e).bind(this.prototype)}static properties(t){var e,i,r;for(i in r=[],t)e=t[i],r.push(this.property(i,e));return r}}})},{"./Mixable":85,"./Property":87}],82:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.EventBind=i:(null==this.Spark&&(this.Spark={}),this.Spark.EventBind=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Binder")?e.Binder:t("./Binder");return class EventBind extends i{constructor(t,e,i){super(),this.event=t,this.target=e,this.callback=i}getRef(){return{event:this.event,target:this.target,callback:this.callback}}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return super.equals(t)&&t.event===this.event}match(t,e){return t===this.event&&e===this.target}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}})},{"./Binder":79}],83:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.EventEmitter=i:(null==this.Spark&&(this.Spark={}),this.Spark.EventEmitter=i)}(function(){return function(){class EventEmitter{getAllEvents(){return this._events||(this._events={})}getListeners(t){var e;return(e=this.getAllEvents())[t]||(e[t]=[])}hasListener(t,e){return this.getListeners(t).includes(e)}addListener(t,e){if(!this.hasListener(t,e))return this.getListeners(t).push(e),this.listenerAdded(t,e)}listenerAdded(t,e){}removeListener(t,e){var i,r;if(-1!==(i=(r=this.getListeners(t)).indexOf(e)))return r.splice(i,1),this.listenerRemoved(t,e)}listenerRemoved(t,e){}emitEvent(t,...e){return this.getListeners(t).slice().forEach(function(t){return t(...e)})}}return EventEmitter.prototype.emit=EventEmitter.prototype.emitEvent,EventEmitter.prototype.trigger=EventEmitter.prototype.emitEvent,EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter}.call(this)})},{}],84:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Invalidator=i:(null==this.Spark&&(this.Spark={}),this.Spark.Invalidator=i)}(function(e){null==e&&(e={});var i,r=e.hasOwnProperty("Binder")?e.Binder:t("./Binder"),n=e.hasOwnProperty("EventBind")?e.EventBind:t("./EventBind");return i=function(t,e){var i,r;return(r=t.findIndex(e))>-1?(i=t[r],t.splice(r,1),i):null},function(){class Invalidator extends r{constructor(t,e=null){super(),this.property=t,this.obj=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalidated=!1,this.invalidateCallback=(()=>(this.invalidate(),null)),this.invalidateCallback.owner=this}invalidate(){var t;return this.invalidated=!0,"function"==typeof this.property?this.property():"function"==typeof this.callback?this.callback():null!=this.property&&"function"==typeof this.property.invalidate?this.property.invalidate():"string"==typeof this.property?(t="invalidate"+this.property.charAt(0).toUpperCase()+this.property.slice(1),"function"==typeof this.obj[t]?this.obj[t]():this.obj[this.property]=null):void 0}unknown(){return"function"==typeof this.property.unknown?this.property.unknown():this.invalidate()}addEventBind(t,e,i){return this.addBinder(new n(t,e,i))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(i(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t,e){var i;return(i=(()=>this.addUnknown(function(){return e[t]},t,e))).ref={prop:t,target:e},i}addUnknown(t,e,i){if(!this.findUnknown(e,i))return t.ref={prop:e,target:i},this.unknowns.push(t),this.unknown()}findUnknown(t,e){if(null!=t||null!=e)return this.unknowns.find(function(i){return i.ref.prop===t&&i.ref.target===e})}event(t,e=this.obj){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,i=this.obj){return this.event(e,i),t}prop(t,e=this.obj){if("string"!=typeof t)throw new Error("Property name must be a string");return this.checkEmitter(e)?(this.addEventBind(t+"Invalidated",e,this.getUnknownCallback(t,e)),this.value(e[t],t+"Updated",e)):e[t]}propInitiated(t,e=this.obj){var i;return!(i=e.getPropertyInstance(t).initiated)&&this.checkEmitter(e)&&this.event(t+"Updated",e),i}funct(t){var e,i;return e=new Invalidator(()=>this.addUnknown(()=>{var r;if(r=t(e),i!==r)return this.invalidate()},e)),i=t(e),this.invalidationEvents.push(e),i}validateUnknowns(t,e=this.obj){var i;return i=this.unknowns,this.unknowns=[],i.forEach(function(t){return t()})}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalidated=!1,this.invalidationEvents.forEach(function(t){return t.bind()})}recycle(t){var e,i;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=(()=>(this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[])),"function"==typeof t?t.length>1?t(this,e):(i=t(this),e(),i):e}checkEmitter(t){return n.checkEmitter(t,this.strict)}unbind(){return this.invalidationEvents.forEach(function(t){return t.unbind()})}}return Invalidator.strict=!0,Invalidator}.call(this)})},{"./Binder":79,"./EventBind":82}],85:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Mixable=i:(null==this.Spark&&(this.Spark={}),this.Spark.Mixable=i)}(function(){var t=[].indexOf;return function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={make:function(t,e){var i,r,n,a;for(i=0,r=(a=this.getExtensionProperties(t,e)).length;i<r;i++)n=a[i],Object.defineProperty(e,n.name,n);if(e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor"],getExtensionProperties:function(e,i){var r,n,a;return r=this.alwaysFinal,a=this.getPrototypeChain(i),n=[],this.getPrototypeChain(e).every(function(s){var o;if(!a.includes(s))return o=r,null!=e.getFinalProperties&&(o=o.concat(e.getFinalProperties())),"function"==typeof s&&(o=o.concat(["length","prototype","name"])),n=n.concat(Object.getOwnPropertyNames(s).filter(e=>!i.hasOwnProperty(e)&&"__"!==e.substr(0,2)&&t.call(o,e)<0&&!n.find(function(t){return t.name===e})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),n},getPrototypeChain:function(t){var e,i;for(i=[],e=Object.getPrototypeOf(Object);i.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return i}},Mixable}.call(this)})},{}],86:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Overrider=i:(null==this.Spark&&(this.Spark={}),this.Spark.Overrider=i)}(function(){return function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,i){var r,n,a;for(n in a=[],i)r=i[n],a.push(this.make(t,e,n,r));return a},applyMany:function(t,e,i){var r,n,a;for(r in a=[],i)"function"==typeof(n=i[r])&&(n=this.make(t,e,r,n)),a.push(this.apply(t,e,n));return a},make:function(t,e,i,r){var n;return(n={fn:{current:r},name:i}).fn["with"+e]=r,n},emptyFn:function(){},apply:function(t,e,i){var r,n,a,s,o;return r=i.name,n=null!=t._overrides?Object.assign({},t._overrides):{},o=(null!=(a=t._overrides)&&null!=(s=a[r])?s.fn.current:void 0)||t[r],i=Object.assign({},i),null!=n[r]?i.fn=Object.assign({},n[r].fn,i.fn):i.fn=Object.assign({},i.fn),i.fn["without"+e]=o||this.emptyFn,null==o?i.missingWithout="without"+e:i.missingWithout&&(i.fn[i.missingWithout]=o),Object.defineProperty(t,r,{configurable:!0,get:function(){var t,e,n,a;for(n in t=i.fn.current.bind(this),a=i.fn)e=a[n],t[n]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,r,{value:t}),t}}),n[r]=i,t._overrides=n}},Overrider}.call(this)})},{}],87:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Property=i:(null==this.Spark&&(this.Spark={}),this.Spark.Property=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./PropertyTypes/BasicProperty"),r=e.hasOwnProperty("CollectionProperty")?e.CollectionProperty:t("./PropertyTypes/CollectionProperty"),n=e.hasOwnProperty("ComposedProperty")?e.ComposedProperty:t("./PropertyTypes/ComposedProperty"),a=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./PropertyTypes/DynamicProperty"),s=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./PropertyTypes/CalculatedProperty"),o=e.hasOwnProperty("InvalidatedProperty")?e.InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty"),l=e.hasOwnProperty("ActivableProperty")?e.ActivableProperty:t("./PropertyTypes/ActivableProperty"),c=e.hasOwnProperty("UpdatedProperty")?e.UpdatedProperty:t("./PropertyTypes/UpdatedProperty"),p=e.hasOwnProperty("PropertyOwner")?e.PropertyOwner:t("./PropertyOwner"),h=e.hasOwnProperty("Mixable")?e.Mixable:t("./Mixable");return function(){class Property{constructor(t,e={}){this.name=t,this.options=e}bind(t){var e;return this,"function"==typeof t.getProperty&&t.getProperty(this.name)===this||("function"==typeof t.getProperty&&null!=(e=t.getProperty(this.name))&&this.override(e),this.getInstanceType().bind(t,this),t._properties=(t._properties||[]).concat([this]),null!=e&&(t._properties=t._properties.filter(function(t){return t!==e})),this.makeOwner(t)),this}override(t){var e,i,r,n;if(null==this.options.parent){for(e in this.options.parent=t.options,r=[],i=t.options)n=i[e],"function"==typeof this.options[e]&&"function"==typeof n?r.push(this.options[e].overrided=n):void 0===this.options[e]?r.push(this.options[e]=n):r.push(void 0);return r}}makeOwner(t){var e;if(!(null!=(e=t.extensions)?e.includes(p.prototype):void 0))return h.Extension.make(p.prototype,t)}getInstanceVarName(){return this.options.instanceVarName||"_"+this.name}isInstantiated(t){return null!=t[this.getInstanceVarName()]}getInstance(t){var e,i;return i=this.getInstanceVarName(),this.isInstantiated(t)||(e=this.getInstanceType(),t[i]=new e(this,t)),t[i]}getInstanceType(){return this.instanceType||this.composers.forEach(t=>t.compose(this)),this.instanceType}}return Property.prototype.composers=[n,r,a,i,c,s,o,l],Property}.call(this)})},{"./Mixable":85,"./PropertyOwner":88,"./PropertyTypes/ActivableProperty":89,"./PropertyTypes/BasicProperty":90,"./PropertyTypes/CalculatedProperty":91,"./PropertyTypes/CollectionProperty":92,"./PropertyTypes/ComposedProperty":93,"./PropertyTypes/DynamicProperty":94,"./PropertyTypes/InvalidatedProperty":95,"./PropertyTypes/UpdatedProperty":96}],88:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.PropertyOwner=i:(null==this.Spark&&(this.Spark={}),this.Spark.PropertyOwner=i)}(function(){return class PropertyOwner{getProperty(t){return this._properties&&this._properties.find(function(e){return e.name===t})}getPropertyInstance(t){var e;if(e=this.getProperty(t))return e.getInstance(this)}getProperties(){return this._properties.slice()}getPropertyInstances(){return this._properties.map(t=>t.getInstance(this))}getInstantiatedProperties(){return this._properties.filter(t=>t.isInstantiated(this)).map(t=>t.getInstance(this))}getManualDataProperties(){return this._properties.reduce((t,e)=>{var i;return e.isInstantiated(this)&&(i=e.getInstance(this)).calculated&&i.manual&&(t[e.name]=i.value),t},{})}setProperties(t,e={}){var i,r,n;for(i in t)n=t[i],null!=e.whitelist&&-1===e.whitelist.indexOf(i)||null!=e.blacklist&&-1!==e.blacklist.indexOf(i)||null!=(r=this.getPropertyInstance(i))&&r.set(n);return this}destroyProperties(){return this.getInstantiatedProperties().forEach(t=>t.destroy()),this._properties=[],!0}listenerAdded(t,e){return this._properties.forEach(e=>{if(e.getInstanceType().prototype.changeEventName===t)return e.getInstance(this).get()})}extended(t){return t.listenerAdded=this.listenerAdded}}})},{}],89:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.ActivableProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.ActivableProperty=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),r=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./BasicProperty"),n=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class ActivableProperty extends r{isActive(){return!0}manualActive(){return this.active}callbackActive(){return(this.activeInvalidator||new i(this,this.obj)).recycle((t,e)=>(this.active=this.callOptionFunct(this.activeFunct,t),e(),this.active||t.isEmpty()?(t.unbind(),this.activeInvalidator=null):(this.invalidator=t,this.activeInvalidator=t,t.bind()))),this.active}static compose(t){if(void 0!==t.options.active){if(t.instanceType.extend(ActivableProperty),"boolean"==typeof t.options.active)return t.instanceType.prototype.active=t.options.active,t.instanceType.prototype.isActive=this.prototype.manualActive;if("function"==typeof t.options.active)return t.instanceType.prototype.activeFunct=t.options.active,t.instanceType.prototype.isActive=this.prototype.callbackActive}}}return ActivableProperty.extend(n),ActivableProperty.overrides({get:function(){var t;return this.isActive()?(t=this.get.withoutActivableProperty(),this.pendingChanges&&this.changed(this.pendingOld),t):void(this.initiated=!0)},changed:function(t){return this.isActive()?(this.pendingChanges=!1,this.pendingOld=void 0,this.changed.withoutActivableProperty(t)):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t)),this}}),ActivableProperty}.call(this)})},{"../Invalidator":84,"../Overrider":86,"./BasicProperty":90}],90:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.BasicProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.BasicProperty=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Mixable")?e.Mixable:t("../Mixable");return class BasicProperty extends i{constructor(t,e){super(),this.property=t,this.obj=e,this.init()}init(){return this.value=this.ingest(this.default),this.calculated=!1}get(){return this.calculated=!0,this.output()}set(t){return this.setAndCheckChanges(t)}callbackSet(t){return this.callOptionFunct("set",t),this}setAndCheckChanges(t){var e;return t=this.ingest(t),this.revalidated(),this.checkChanges(t,this.value)&&(e=this.value,this.value=t,this.manual=!0,this.changed(e)),this}checkChanges(t,e){return t!==e}destroy(){}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.property.options[t]),"function"==typeof t.overrided&&e.push((...e)=>this.callOptionFunct(t.overrided,...e)),t.apply(this.obj,e)}revalidated(){return this.calculated=!0,this.initiated=!0}ingest(t){return"function"==typeof this.property.options.ingest?this.callOptionFunct("ingest",t):t}output(){return"function"==typeof this.property.options.output?this.callOptionFunct("output",this.value):this.value}changed(t){return this.callChangedFunctions(t),"function"==typeof this.obj.emitEvent&&(this.obj.emitEvent(this.updateEventName,[t]),this.obj.emitEvent(this.changeEventName,[t])),this}callChangedFunctions(t){if("function"==typeof this.property.options.change)return this.callOptionFunct("change",t)}hasChangedFunctions(){return"function"==typeof this.property.options.change}hasChangedEvents(){return"function"==typeof this.obj.getListeners&&this.obj.getListeners(this.changeEventName).length>0}static compose(t){return null==t.instanceType&&(t.instanceType=class extends BasicProperty{}),"function"==typeof t.options.set?t.instanceType.prototype.set=this.prototype.callbackSet:t.instanceType.prototype.set=this.prototype.setAndCheckChanges,t.instanceType.prototype.default=t.options.default,t.instanceType.prototype.initiated=void 0!==t.options.default,this.setEventNames(t)}static setEventNames(t){return t.instanceType.prototype.changeEventName=t.options.changeEventName||t.name+"Changed",t.instanceType.prototype.updateEventName=t.options.updateEventName||t.name+"Updated",t.instanceType.prototype.invalidateEventName=t.options.invalidateEventName||t.name+"Invalidated"}static bind(t,e){var i,r;return i=e.name.charAt(0).toUpperCase()+e.name.slice(1),r={configurable:!0,get:function(){return e.getInstance(this).get()}},!1!==e.options.set&&(r.set=function(t){return e.getInstance(this).set(t)}),Object.defineProperty(t,e.name,r),t["get"+i]=function(){return e.getInstance(this).get()},!1!==e.options.set&&(t["set"+i]=function(t){return e.getInstance(this).set(t),this}),t["invalidate"+i]=function(){return e.getInstance(this).invalidate(),this}}}})},{"../Mixable":85}],91:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.CalculatedProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.CalculatedProperty=i)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var i=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),r=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class CalculatedProperty extends i{calcul(){return this.value=this.callOptionFunct(this.calculFunct),this.manual=!1,this.revalidated(),this.value}static compose(t){if("function"==typeof t.options.calcul&&(t.instanceType.prototype.calculFunct=t.options.calcul,!(t.options.calcul.length>0)))return t.instanceType.extend(CalculatedProperty)}}return CalculatedProperty.extend(r),CalculatedProperty.overrides({get:function(){var t,e;return this.invalidator&&this.invalidator.validateUnknowns(),this.calculated||(e=this.value,t=this.initiated,this.calcul(),this.checkChanges(this.value,e)&&(t?this.changed(e):"function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.updateEventName,[e]))),this.output()}}),CalculatedProperty}.call(this)})},{"../Invalidator":84,"../Overrider":86,"./DynamicProperty":94}],92:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.CollectionProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.CollectionProperty=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),r=e.hasOwnProperty("Collection")?e.Collection:t("../Collection");return function(){class CollectionProperty extends i{ingest(t){return"function"==typeof this.property.options.ingest&&(t=this.callOptionFunct("ingest",t)),null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChangedItems(t,e){var i;return"function"==typeof this.collectionOptions.compare&&(i=this.collectionOptions.compare),new r(t).checkChanges(e,this.collectionOptions.ordered,i)}output(){var t,e,i;return i=this.value,"function"==typeof this.property.options.output&&(i=this.callOptionFunct("output",this.value)),e=this,(t=r.newSubClass(this.collectionOptions,i)).changed=function(t){return e.changed(t)},t}callChangedFunctions(t){return"function"==typeof this.property.options.itemAdded&&this.value.forEach((e,i)=>{if(!t.includes(e))return this.callOptionFunct("itemAdded",e,i)}),"function"==typeof this.property.options.itemRemoved&&t.forEach((t,e)=>{if(!this.value.includes(t))return this.callOptionFunct("itemRemoved",t,e)}),super.callChangedFunctions(t)}hasChangedFunctions(){return super.hasChangedFunctions()||"function"==typeof this.property.options.itemAdded||"function"==typeof this.property.options.itemRemoved}static compose(t){if(null!=t.options.collection&&(t.instanceType=class extends CollectionProperty{},t.instanceType.prototype.collectionOptions=Object.assign({},this.defaultCollectionOptions,"object"==typeof t.options.collection?t.options.collection:{}),null!=t.options.collection.compare))return t.instanceType.prototype.checkChanges=this.prototype.checkChangedItems}}return CollectionProperty.defaultCollectionOptions={compare:!1,ordered:!0},CollectionProperty}.call(this)})},{"../Collection":80,"./DynamicProperty":94}],93:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.ComposedProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.ComposedProperty=i)}(function(e){null==e&&(e={});var i,r=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./CalculatedProperty"),n=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),a=e.hasOwnProperty("Collection")?e.Collection:t("../Collection");return(i=function(){class ComposedProperty extends r{init(){return super.init(),this.initComposed()}initComposed(){return this.property.options.hasOwnProperty("default")?this.default=this.property.options.default:this.default=this.value=!0,this.members=new ComposedProperty.Members(this.property.options.members),this.members.changed=(t=>this.invalidate()),this.join="function"==typeof this.property.options.composed?this.property.options.composed:!1===this.property.options.default?ComposedProperty.joinFunctions.or:ComposedProperty.joinFunctions.and}calcul(){return this.invalidator||(this.invalidator=new n(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.members.reduce((t,e)=>{var i;return i="function"==typeof e?e(this.invalidator):e,this.join(t,i)},this.default),e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value}static compose(t){if(null!=t.options.composed)return t.instanceType=class extends ComposedProperty{}}static bind(t,e){return r.bind(t,e),Object.defineProperty(t,e.name+"Members",{configurable:!0,get:function(){return e.getInstance(this).members}})}}return ComposedProperty.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e}},ComposedProperty}.call(this)).Members=class Members extends a{addPropertyRef(t,e){var i;if(-1===this.findRefIndex(t,e))return(i=function(i){return i.prop(t,e)}).ref={name:t,obj:e},this.push(i)}addValueRef(t,e,i){var r;if(-1===this.findRefIndex(e,i))return(r=function(e){return t}).ref={name:e,obj:i,val:t},this.push(r)}setValueRef(t,e,i){var r,n;return-1===(n=this.findRefIndex(e,i))?this.addValueRef(t,e,i):this.get(n).ref.val!==t?((r=function(e){return t}).ref={name:e,obj:i,val:t},this.set(n,r)):void 0}getValueRef(t,e){return this.findByRef(t,e).ref.val}addFunctionRef(t,e,i){if(-1===this.findRefIndex(e,i))return t.ref={name:e,obj:i},this.push(t)}findByRef(t,e){return this._array[this.findRefIndex(t,e)]}findRefIndex(t,e){return this._array.findIndex(function(i){return null!=i.ref&&i.ref.obj===e&&i.ref.name===t})}removeRef(t,e){var i,r;if(-1!==(i=this.findRefIndex(t,e)))return r=this.toArray(),this._array.splice(i,1),this.changed(r)}},i})},{"../Collection":80,"../Invalidator":84,"./CalculatedProperty":91}],94:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.DynamicProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.DynamicProperty=i)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var i=e.hasOwnProperty("BasicProperty")?e.BasicProperty:t("./BasicProperty");return class DynamicProperty extends i{callbackGet(){var t;return t=this.callOptionFunct("get"),this.revalidated(),t}invalidate(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()),this}_invalidateNotice(){return this.isImmediate()?(this.get(),!1):("function"==typeof this.obj.emitEvent&&this.obj.emitEvent(this.invalidateEventName),!0)}isImmediate(){return!1!==this.property.options.immediate&&(!0===this.property.options.immediate||("function"==typeof this.property.options.immediate?this.callOptionFunct("immediate"):this.hasChangedEvents()||this.hasChangedFunctions()))}static compose(t){if("function"!=typeof t.options.get&&"function"!=typeof t.options.calcul&&"function"!=typeof t.options.active||null==t.instanceType&&(t.instanceType=class extends DynamicProperty{}),"function"==typeof t.options.get)return t.instanceType.prototype.get=this.prototype.callbackGet}}})},{"../Invalidator":84,"./BasicProperty":90}],95:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.InvalidatedProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.InvalidatedProperty=i)}(function(e){null==e&&(e={});var i=e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator"),r=e.hasOwnProperty("CalculatedProperty")?e.CalculatedProperty:t("./CalculatedProperty");return function(){class InvalidatedProperty extends r{unknown(){return(this.calculated||!1===this.active)&&this._invalidateNotice(),this}static compose(t){if("function"==typeof t.options.calcul&&t.options.calcul.length>0)return t.instanceType.extend(InvalidatedProperty)}}return InvalidatedProperty.overrides({calcul:function(){return this.invalidator||(this.invalidator=new i(this,this.obj)),this.invalidator.recycle((t,e)=>(this.value=this.callOptionFunct(this.calculFunct,t),this.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind())),this.revalidated(),this.value},destroy:function(){if(this.destroy.withoutInvalidatedProperty(),null!=this.invalidator)return this.invalidator.unbind()},invalidate:function(){return(this.calculated||!1===this.active)&&(this.calculated=!1,this._invalidateNotice()&&!this.calculated&&null!=this.invalidator&&this.invalidator.unbind()),this}}),InvalidatedProperty}.call(this)})},{"../Invalidator":84,"./CalculatedProperty":91}],96:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.UpdatedProperty=i:(null==this.Spark&&(this.Spark={}),this.Spark.UpdatedProperty=i)}(function(e){null==e&&(e={});e.hasOwnProperty("Invalidator")?e.Invalidator:t("../Invalidator");var i=e.hasOwnProperty("DynamicProperty")?e.DynamicProperty:t("./DynamicProperty"),r=e.hasOwnProperty("Overrider")?e.Overrider:t("../Overrider");return function(){class UpdatedProperty extends i{initRevalidate(){return this.revalidateCallback=(()=>(this.updating=!0,this.get(),this.getUpdater().unbind(),this.pendingChanges&&this.changed(this.pendingOld),this.updating=!1)),this.revalidateCallback.owner=this}getUpdater(){return void 0===this.updater&&(null!=this.property.options.updater?(this.updater=this.property.options.updater,"function"==typeof this.updater.getBinder&&(this.updater=this.updater.getBinder()),"function"!=typeof this.updater.bind||"function"!=typeof this.updater.unbind?this.updater=null:this.updater.callback=this.revalidateCallback):this.updater=null),this.updater}static compose(t){if(null!=t.options.updater)return t.instanceType.extend(UpdatedProperty)}}return UpdatedProperty.extend(r),UpdatedProperty.overrides({init:function(){return this.init.withoutUpdatedProperty(),this.initRevalidate()},_invalidateNotice:function(){var t;return(t=this._invalidateNotice.withoutUpdatedProperty())&&this.getUpdater().bind(),t},isImmediate:function(){return!1},changed:function(t){return this.updating?(this.pendingChanges=!1,this.pendingOld=void 0,this.changed.withoutUpdatedProperty(t)):(this.pendingChanges=!0,void 0===this.pendingOld&&(this.pendingOld=t),this.getUpdater().bind()),this}}),UpdatedProperty}.call(this)})},{"../Invalidator":84,"../Overrider":86,"./DynamicProperty":94}],97:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Spark?Spark:this.Spark);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Spark&&null!==Spark?Spark.Updater=i:(null==this.Spark&&(this.Spark={}),this.Spark.Updater=i)}(function(e){null==e&&(e={});var i,r=e.hasOwnProperty("Binder")?e.Binder:t("./Binder");return(i=class Updater{constructor(){this.callbacks=[],this.next=[],this.updating=!1}update(){for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)this.callbacks.shift()();return this.callbacks=this.next,this.updating=!1,this}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}}).Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,r),i})},{"./Binder":79}],98:[function(t,e,i){e&&(e.exports={Binder:t("./Binder.js"),Collection:t("./Collection.js"),Element:t("./Element.js"),EventBind:t("./EventBind.js"),EventEmitter:t("./EventEmitter.js"),Invalidator:t("./Invalidator.js"),Mixable:t("./Mixable.js"),Overrider:t("./Overrider.js"),Property:t("./Property.js"),PropertyOwner:t("./PropertyOwner.js"),Updater:t("./Updater.js"),ActivableProperty:t("./PropertyTypes/ActivableProperty.js"),BasicProperty:t("./PropertyTypes/BasicProperty.js"),CalculatedProperty:t("./PropertyTypes/CalculatedProperty.js"),CollectionProperty:t("./PropertyTypes/CollectionProperty.js"),ComposedProperty:t("./PropertyTypes/ComposedProperty.js"),DynamicProperty:t("./PropertyTypes/DynamicProperty.js"),InvalidatedProperty:t("./PropertyTypes/InvalidatedProperty.js"),UpdatedProperty:t("./PropertyTypes/UpdatedProperty.js")})},{"./Binder.js":79,"./Collection.js":80,"./Element.js":81,"./EventBind.js":82,"./EventEmitter.js":83,"./Invalidator.js":84,"./Mixable.js":85,"./Overrider.js":86,"./Property.js":87,"./PropertyOwner.js":88,"./PropertyTypes/ActivableProperty.js":89,"./PropertyTypes/BasicProperty.js":90,"./PropertyTypes/CalculatedProperty.js":91,"./PropertyTypes/CollectionProperty.js":92,"./PropertyTypes/ComposedProperty.js":93,"./PropertyTypes/DynamicProperty.js":94,"./PropertyTypes/InvalidatedProperty.js":95,"./PropertyTypes/UpdatedProperty.js":96,"./Updater.js":97}],99:[function(t,e,i){!function(t){var i=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.PathFinder=i:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.PathFinder=i)}(function(e){null==e&&(e={});var i,r=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element;return(i=function(){class PathFinder extends r{constructor(t,e,i,r={}){super(),this.tilesContainer=t,this.from=e,this.to=i,this.reset(),null!=r.validTile&&(this.validTileCallback=r.validTile),null!=r.arrived&&(this.arrivedCallback=r.arrived),null!=r.efficiency&&(this.efficiencyCallback=r.efficiency)}reset(){return this.queue=[],this.paths={},this.solution=null,this.started=!1}calcul(){for(;!this.solution&&(!this.started||this.queue.length);)this.step();return this.getPath()}step(){var t;return this.queue.length?(t=this.queue.pop(),this.addNextSteps(t),!0):this.started?void 0:this.start()}start(){if(this.started=!0,!1===this.to||this.tileIsValid(this.to))return this.addNextSteps(),!0}getPath(){var t,e;if(this.solution){for(t=[this.solution],e=this.solution;null!=e.prev;)t.unshift(e.prev),e=e.prev;return t}}getPosAtPrc(t){if(isNaN(t))throw new Error("Invalid number");if(this.solution)return this.getPosAtTime(this.solution.getTotalLength()*t)}getPosAtTime(t){var e,i;if(this.solution){if(t>=this.solution.getTotalLength())return this.solution.posToTileOffset(this.solution.getExit().x,this.solution.getExit().y);for(i=this.solution;i.getStartLength()>t&&null!=i.prev;)i=i.prev;return e=(t-i.getStartLength())/i.getLength(),i.posToTileOffset(i.getEntry().x+(i.getExit().x-i.getEntry().x)*e,i.getEntry().y+(i.getExit().y-i.getEntry().y)*e)}}getSolutionTileList(){var t,e;if(this.solution){for(e=[(t=this.solution).tile];null!=t.prev;)t=t.prev,e.unshift(t.tile);return e}}tileIsValid(t){return null!=this.validTileCallback?this.validTileCallback(t):null!=t&&(!t.emulated||0!==t.tile&&!1!==t.tile)}getTile(t,e){var i;return null!=this.tilesContainer.getTile?this.tilesContainer.getTile(t,e):null!=(null!=(i=this.tilesContainer[e])?i[t]:void 0)?{x:t,y:e,tile:this.tilesContainer[e][t],emulated:!0}:void 0}getConnectedToTile(t){var e,i;return null!=t.getConnected?t.getConnected():(e=[],(i=this.getTile(t.x+1,t.y))&&e.push(i),(i=this.getTile(t.x-1,t.y))&&e.push(i),(i=this.getTile(t.x,t.y+1))&&e.push(i),(i=this.getTile(t.x,t.y-1))&&e.push(i),e)}addNextSteps(t=null){var e,i,r,n,a,s;for(s=null!=t?t.nextTile:this.from,a=[],e=0,i=(n=this.getConnectedToTile(s)).length;e<i;e++)r=n[e],this.tileIsValid(r)?a.push(this.addStep(new PathFinder.Step(this,null!=t?t:null,s,r))):a.push(void 0);return a}tileEqual(t,e){return t===e||(t.emulated||e.emulated)&&t.x===e.x&&t.y===e.y}arrivedAtDestination(t){return null!=this.arrivedCallback?this.arrivedCallback(t):this.tileEqual(t.tile,this.to)}addStep(t){var e;if(null==this.paths[t.getExit().x]&&(this.paths[t.getExit().x]={}),!(null!=this.paths[t.getExit().x][t.getExit().y]&&this.paths[t.getExit().x][t.getExit().y].getTotalLength()<=t.getTotalLength())&&(null!=this.paths[t.getExit().x][t.getExit().y]&&this.removeStep(this.paths[t.getExit().x][t.getExit().y]),this.paths[t.getExit().x][t.getExit().y]=t,this.queue.splice(this.getStepRank(t),0,t),e=new PathFinder.Step(this,t,t.nextTile,null),this.arrivedAtDestination(e)&&!(null!=this.solution&&this.solution.prev.getTotalLength()<=t.getTotalLength())))return this.solution=e}removeStep(t){var e;if((e=this.queue.indexOf(t))>-1)return this.queue.splice(e,1)}best(){return this.queue[this.queue.length-1]}getStepRank(t){return 0===this.queue.length?0:this._getStepRank(t.getEfficiency(),0,this.queue.length-1)}_getStepRank(t,e,i){var r,n;return n=Math.floor((i-e)/2)+e,(r=this.queue[n].getEfficiency())===t?n:r>t?n===e?e:this._getStepRank(t,e,n-1):n===i?i+1:this._getStepRank(t,n+1,i)}}return PathFinder.properties({validTileCallback:{}}),PathFinder}.call(this)).Step=class Step{constructor(t,e,i,r){this.pathFinder=t,this.prev=e,this.tile=i,this.nextTile=r}posToTileOffset(t,e){var i;return{x:t,y:e,tile:i=Math.floor(t)===this.tile.x&&Math.floor(e)===this.tile.y?this.tile:null!=this.nextTile&&Math.floor(t)===this.nextTile.x&&Math.floor(e)===this.nextTile.y?this.nextTile:null!=this.prev&&Math.floor(t)===this.prev.tile.x&&Math.floor(e)===this.prev.tile.y?this.prev.tile:console.log("Math.floor("+t+") == "+this.tile.x,"Math.floor("+e+") == "+this.tile.y,this),offsetX:t-i.x,offsetY:e-i.y}}getExit(){return null==this.exit&&(null!=this.nextTile?this.exit={x:(this.tile.x+this.nextTile.x+1)/2,y:(this.tile.y+this.nextTile.y+1)/2}:this.exit={x:this.tile.x+.5,y:this.tile.y+.5}),this.exit}getEntry(){return null==this.entry&&(null!=this.prev?this.entry={x:(this.tile.x+this.prev.tile.x+1)/2,y:(this.tile.y+this.prev.tile.y+1)/2}:this.entry={x:this.tile.x+.5,y:this.tile.y+.5}),this.entry}getLength(){return null==this.length&&(this.length=null==this.nextTile||null==this.prev?.5:this.prev.tile.x===this.nextTile.x||this.prev.tile.y===this.nextTile.y?1:Math.sqrt(.5)),this.length}getStartLength(){return null==this.startLength&&(this.startLength=null!=this.prev?this.prev.getTotalLength():0),this.startLength}getTotalLength(){return null==this.totalLength&&(this.totalLength=this.getStartLength()+this.getLength()),this.totalLength}getEfficiency(){return null==this.efficiency&&("function"==typeof this.pathFinder.efficiencyCallback?this.efficiency=this.pathFinder.efficiencyCallback(this):this.efficiency=1.1*-this.getRemaining()-this.getTotalLength()),this.efficiency}getRemaining(){var t,e,i,r;return null==this.remaining&&(t=this.getExit(),i=(e={x:this.pathFinder.to.x+.5,y:this.pathFinder.to.y+.5}).x-t.x,r=e.y-t.y,this.remaining=Math.sqrt(i*i+r*r)),this.remaining}},i})},{"spark-starter":108}],100:[function(t,e,i){var r,n;n=t("spark-properties").PropertiesManager,r=t("./Mixable"),e.exports=function(){class Element extends r{constructor(t){super(),this.initPropertiesManager(t),this.init(),this.propertiesManager.initWatchers()}initPropertiesManager(t){return this.propertiesManager=this.propertiesManager.useScope(this),this.propertiesManager.initProperties(),this.propertiesManager.createScopeGetterSetters(),"object"==typeof t&&this.propertiesManager.setPropertiesData(t),this}init(){return this}tap(t){var e;return e=Array.prototype.slice.call(arguments),"function"==typeof t?t.apply(this,e.slice(1)):this[t].apply(this,e.slice(1)),this}callback(t){return null==this._callbacks&&(this._callbacks={}),null==this._callbacks[t]&&(this._callbacks[t]=((...e)=>(this[t].apply(this,e),null)),this._callbacks[t].owner=this),this._callbacks[t]}destroy(){return this.propertiesManager.destroy()}getFinalProperties(){return["propertiesManager"]}extended(t){return t.propertiesManager?t.propertiesManager=t.propertiesManager.copyWith(this.propertiesManager.propertiesOptions):t.propertiesManager=this.propertiesManager}static property(t,e){return this.prototype.propertiesManager=this.prototype.propertiesManager.withProperty(t,e)}static properties(t){return this.prototype.propertiesManager=this.prototype.propertiesManager.copyWith(t)}}return Element.prototype.propertiesManager=new n,Element}.call(this)},{"./Mixable":104,"spark-properties":158}],101:[function(t,e,i){var r,n;n=t("spark-properties").watchers.PropertyWatcher,r=t("spark-properties").Invalidator,e.exports=class ActivablePropertyWatcher extends n{loadOptions(t){return super.loadOptions(t),this.active=t.active}shouldBind(){var t;return null==this.active||(null==this.invalidator&&(this.invalidator=new r(this,this.scope),this.invalidator.callback=(()=>this.checkBind())),this.invalidator.recycle(),t=this.active(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),t)}}},{"spark-properties":158}],102:[function(t,e,i){var r;r=t("spark-properties").Invalidator,e.exports=class Invalidated{constructor(t){null!=t&&this.loadOptions(t),null!=t&&t.initByLoader&&null!=t.loader||this.init()}loadOptions(t){return this.scope=t.scope,t.loaderAsScope&&null!=t.loader&&(this.scope=t.loader),this.callback=t.callback}init(){return this.update()}unknown(){return this.invalidator.validateUnknowns()}invalidate(){return this.update()}update(){return null==this.invalidator&&(this.invalidator=new r(this,this.scope)),this.invalidator.recycle(),this.handleUpdate(this.invalidator),this.invalidator.endRecycle(),this.invalidator.bind(),this}handleUpdate(t){return null!=this.scope?this.callback.call(this.scope,t):this.callback(t)}destroy(){if(this.invalidator)return this.invalidator.unbind()}}},{"spark-properties":158}],103:[function(t,e,i){var r;r=t("./Overrider"),e.exports=function(){class Loader extends r{constructor(){super(),this.initPreloaded()}initPreloaded(){var t;return t=this.preloaded,this.preloaded=[],this.load(t)}load(t){var e,i;return i=[],e=t.map(t=>{var e;return null==t.instance&&(t=Object.assign({loader:this},t),e=Loader.load(t),(t=Object.assign({instance:e},t)).initByLoader&&null!=e.init&&i.push(e)),t}),this.preloaded=this.preloaded.concat(e),i.forEach(function(t){return t.init()})}preload(t){return Array.isArray(t)||(t=[t]),this.preloaded=(this.preloaded||[]).concat(t)}destroyLoaded(){return this.preloaded.forEach(function(t){var e;return null!=(e=t.instance)&&"function"==typeof e.destroy?e.destroy():void 0})}getFinalProperties(){return super.getFinalProperties().concat(["preloaded"])}extended(t){if(super.extended(t),this.preloaded)return t.preloaded=(t.preloaded||[]).concat(this.preloaded)}static loadMany(t){return t.map(t=>this.load(t))}static load(t){return"function"==typeof t.type.copyWith?t.type.copyWith(t):new t.type(t)}static preload(t){return this.prototype.preload(t)}}return Loader.prototype.preloaded=[],Loader.overrides({init:function(){return this.init.withoutLoader(),this.initPreloaded()},destroy:function(){return this.destroy.withoutLoader(),this.destroyLoaded()}}),Loader}.call(this)},{"./Overrider":105}],104:[function(t,e,i){var r=[].indexOf;e.exports=function(){class Mixable{static extend(t){if(this.Extension.make(t,this),null!=t.prototype)return this.Extension.make(t.prototype,this.prototype)}static include(t){return this.Extension.make(t,this.prototype)}}return Mixable.Extension={makeOnce:function(t,e){var i;if(!(null!=(i=e.extensions)?i.includes(t):void 0))return this.make(t,e)},make:function(t,e){var i,r,n,a,s;for(i=0,r=(s=this.getExtensionProperties(t,e)).length;i<r;i++)a=s[i],Object.defineProperty(e,a.name,a);if(t.getFinalProperties&&e.getFinalProperties?(n=e.getFinalProperties,e.getFinalProperties=function(){return t.getFinalProperties().concat(n.call(this))}):e.getFinalProperties=t.getFinalProperties||e.getFinalProperties,e.extensions=(e.extensions||[]).concat([t]),"function"==typeof t.extended)return t.extended(e)},alwaysFinal:["extended","extensions","__super__","constructor","getFinalProperties"],getExtensionProperties:function(t,e){var i,n,a;return i=this.alwaysFinal,a=this.getPrototypeChain(e),n=[],this.getPrototypeChain(t).every(function(s){var o;if(!a.includes(s))return o=i,null!=t.getFinalProperties&&(o=o.concat(t.getFinalProperties())),"function"==typeof s&&(o=o.concat(["length","prototype","name"])),n=n.concat(Object.getOwnPropertyNames(s).filter(t=>!e.hasOwnProperty(t)&&"__"!==t.substr(0,2)&&r.call(o,t)<0&&!n.find(function(e){return e.name===t})).map(function(t){var e;return(e=Object.getOwnPropertyDescriptor(s,t)).name=t,e})),!0}),n},getPrototypeChain:function(t){var e,i;for(i=[],e=Object.getPrototypeOf(Object);i.push(t),(t=Object.getPrototypeOf(t))&&t!==Object&&t!==e;);return i}},Mixable}.call(this)},{}],105:[function(t,e,i){e.exports=function(){class Overrider{static overrides(t){return this.Override.applyMany(this.prototype,this.name,t)}getFinalProperties(){return null!=this._overrides?["_overrides"].concat(Object.keys(this._overrides)):[]}extended(t){if(null!=this._overrides&&this.constructor.Override.applyMany(t,this.constructor.name,this._overrides),this.constructor===Overrider)return t.extended=this.extended}}return Overrider.Override={makeMany:function(t,e,i){var r,n,a;for(n in a=[],i)r=i[n],a.push(this.make(t,e,n,r));return a},applyMany:function(t,e,i){var r,n,a;for(r in a=[],i)"function"==typeof(n=i[r])&&(n=this.make(t,e,r,n)),a.push(this.apply(t,e,n));return a},make:function(t,e,i,r){var n;return(n={fn:{current:r},name:i}).fn["with"+e]=r,n},emptyFn:function(){},apply:function(t,e,i){var r,n,a,s,o;return r=i.name,n=null!=t._overrides?Object.assign({},t._overrides):{},o=(null!=(a=t._overrides)&&null!=(s=a[r])?s.fn.current:void 0)||t[r],i=Object.assign({},i),null!=n[r]?i.fn=Object.assign({},n[r].fn,i.fn):i.fn=Object.assign({},i.fn),i.fn["without"+e]=o||this.emptyFn,null==o?i.missingWithout="without"+e:i.missingWithout&&(i.fn[i.missingWithout]=o),Object.defineProperty(t,r,{configurable:!0,get:function(){var t,e,n,a;for(n in t=i.fn.current.bind(this),a=i.fn)e=a[n],t[n]=e.bind(this);return this.constructor.prototype!==this&&Object.defineProperty(this,r,{value:t}),t}}),n[r]=i,t._overrides=n}},Overrider}.call(this)},{}],106:[function(t,e,i){var r,n;r=t("spark-binding").Binder,e.exports=n=class Updater{constructor(t){var e;this.callbacks=[],this.next=[],this.updating=!1,null!=(null!=t?t.callback:void 0)&&this.addCallback(t.callback),null!=(null!=t&&null!=(e=t.callbacks)?e.forEach:void 0)&&t.callbacks.forEach(t=>this.addCallback(t))}update(){var t;for(this.updating=!0,this.next=this.callbacks.slice();this.callbacks.length>0;)t=this.callbacks.shift(),this.runCallback(t);return this.callbacks=this.next,this.updating=!1,this}runCallback(t){return t()}addCallback(t){if(this.callbacks.includes(t)||this.callbacks.push(t),this.updating&&!this.next.includes(t))return this.next.push(t)}nextTick(t){return this.updating?this.next.includes(t)?void 0:this.next.push(t):this.addCallback(t)}removeCallback(t){var e;if(-1!==(e=this.callbacks.indexOf(t))&&this.callbacks.splice(e,1),-1!==(e=this.next.indexOf(t)))return this.next.splice(e,1)}getBinder(){return new Updater.Binder(this)}destroy(){return this.callbacks=[],this.next=[]}},n.Binder=function(t){return class Binder extends t{constructor(t,e){super(),this.target=t,this.callback=e}getRef(){return{target:this.target,callback:this.callback}}doBind(){return this.target.addCallback(this.callback)}doUnbind(){return this.target.removeCallback(this.callback)}}}.call(this,r)},{"spark-binding":152}],107:[function(t,e,i){e.exports={Element:t("./Element"),Loader:t("./Loader"),Mixable:t("./Mixable"),Overrider:t("./Overrider"),Updater:t("./Updater"),Invalidated:{ActivablePropertyWatcher:t("./Invalidated/ActivablePropertyWatcher"),Invalidated:t("./Invalidated/Invalidated")}}},{"./Element":100,"./Invalidated/ActivablePropertyWatcher":101,"./Invalidated/Invalidated":102,"./Loader":103,"./Mixable":104,"./Overrider":105,"./Updater":106}],108:[function(t,e,i){var r;r=t("./libs"),e.exports=Object.assign({Collection:t("spark-collection")},r,t("spark-properties"),t("spark-binding"))},{"./libs":107,"spark-binding":152,"spark-collection":156,"spark-properties":158}],109:[function(t,e,i){null!=e&&(e.exports={greekAlphabet:t("./strings/greekAlphabet"),starNames:t("./strings/starNames")})},{"./strings/greekAlphabet":110,"./strings/starNames":111}],110:[function(t,e,i){e.exports=["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]},{}],111:[function(t,e,i){e.exports=["Achernar","Maia","Atlas","Salm","Alnilam","Nekkar","Elnath","Thuban","Achird","Marfik","Auva","Sargas","Alnitak","Nihal","Enif","Torcularis","Acrux","Markab","Avior","Sarin","Alphard","Nunki","Etamin","Turais","Acubens","Matar","Azelfafage","Sceptrum","Alphekka","Nusakan","Fomalhaut","Tyl","Adara","Mebsuta","Azha","Scheat","Alpheratz","Peacock","Fornacis","Unukalhai","Adhafera","Megrez","Azmidiske","Segin","Alrai","Phad","Furud","Vega","Adhil","Meissa","Baham","Seginus","Alrisha","Phaet","Gacrux","Vindemiatrix","Agena","Mekbuda","Becrux","Sham","Alsafi","Pherkad","Gianfar","Wasat","Aladfar","Menkalinan","Beid","Sharatan","Alsciaukat","Pleione","Gomeisa","Wezen","Alathfar","Menkar","Bellatrix","Shaula","Alshain","Polaris","Graffias","Wezn","Albaldah","Menkent","Betelgeuse","Shedir","Alshat","Pollux","Grafias","Yed","Albali","Menkib","Botein","Sheliak","Alsuhail","Porrima","Grumium","Yildun","Albireo","Merak","Brachium","Sirius","Altair","Praecipua","Hadar","Zaniah","Alchiba","Merga","Canopus","Situla","Altarf","Procyon","Haedi","Zaurak","Alcor","Merope","Capella","Skat","Alterf","Propus","Hamal","Zavijah","Alcyone","Mesarthim","Caph","Spica","Aludra","Rana","Hassaleh","Zibal","Alderamin","Metallah","Castor","Sterope","Alula","Ras","Heze","Zosma","Aldhibah","Miaplacidus","Cebalrai","Sualocin","Alya","Rasalgethi","Hoedus","Aquarius","Alfirk","Minkar","Celaeno","Subra","Alzirr","Rasalhague","Homam","Aries","Algenib","Mintaka","Chara","Suhail","Ancha","Rastaban","Hyadum","Cepheus","Algieba","Mira","Chort","Sulafat","Angetenar","Regulus","Izar","Cetus","Algol","Mirach","Cursa","Syrma","Ankaa","Rigel","Jabbah","Columba","Algorab","Miram","Dabih","Tabit","Anser","Rotanev","Kajam","Coma","Alhena","Mirphak","Deneb","Talitha","Antares","Ruchba","Kaus","Corona","Alioth","Mizar","Denebola","Tania","Arcturus","Ruchbah","Keid","Crux","Alkaid","Mufrid","Dheneb","Tarazed","Arkab","Rukbat","Kitalpha","Draco","Alkalurops","Muliphen","Diadem","Taygeta","Arneb","Sabik","Kocab","Grus","Alkes","Murzim","Diphda","Tegmen","Arrakis","Sadalachbia","Kornephoros","Hydra","Alkurhah","Muscida","Dschubba","Tejat","Ascella","Sadalmelik","Kraz","Lacerta","Almaak","Naos","Dsiban","Terebellum","Asellus","Sadalsuud","Kuma","Mensa","Alnair","Nash","Dubhe","Thabit","Asterope","Sadr","Lesath","Maasym","Alnath","Nashira","Electra","Theemim","Atik","Saiph","Phoenix","Norma"]},{}],112:[function(t,e,i){e.exports={rotate:function(t,e,i={x:0,y:0}){const r=t.x-i.x,n=t.y-i.y;return{x:Math.round(Math.cos(e)*r-Math.sin(e)*n)+i.x+0,y:Math.round(Math.sin(e)*r+Math.cos(e)*n)+i.y+0}}}},{}],113:[function(t,e,i){const r=t("./CoordHelper");class Direction{constructor(t,e,i,r,n){this.name=t,this.x=e,this.y=i,this.angle=r,this.inverseName=n}getInverse(){return this.constructor[this.inverseName]}rotate(t){const e=r.rotate(this,t);return Direction.all.find(t=>t.x===e.x&&t.y===e.y)}}Direction.up=new Direction("up",0,-1,0,"down"),Direction.down=new Direction("down",0,1,Math.PI,"up"),Direction.left=new Direction("left",-1,0,Math.PI/2*3,"right"),Direction.right=new Direction("right",1,0,Math.PI/2,"left"),Direction.adjacents=[Direction.up,Direction.down,Direction.left,Direction.right],Direction.topLeft=new Direction("topLeft",-1,-1,Math.PI/4*7,"bottomRight"),Direction.topRight=new Direction("topRight",1,-1,Math.PI/4,"bottomLeft"),Direction.bottomRight=new Direction("bottomRight",1,1,Math.PI/4*3,"topLeft"),Direction.bottomLeft=new Direction("bottomLeft",-1,1,Math.PI/4*5,"topRight"),Direction.corners=[Direction.topLeft,Direction.topRight,Direction.bottomRight,Direction.bottomLeft],Direction.all=[Direction.up,Direction.down,Direction.left,Direction.right,Direction.topLeft,Direction.topRight,Direction.bottomRight,Direction.bottomLeft],e.exports=Direction},{"./CoordHelper":112}],114:[function(t,e,i){const r=t("spark-starter").Element,n=t("./Direction"),a=t("./CoordHelper");class Tile extends r{constructor(t,e=0){let i=t;"object"!=typeof t&&(i={x:t,y:e}),super(i),this.x=i.x,this.y=i.y}getRelativeTile(t,e){return 0===t&&0===e?this:null!=this.container?this.container.getTile(this.x+t,this.y+e):void 0}findDirectionOf(t){if(t.tile&&(t=t.tile),null!=t.x&&null!=t.y)return n.all.find(e=>e.x===t.x-this.x&&e.y===t.y-this.y)}addChild(t,e=!0){return-1===this.children.indexOf(t)&&this.children.push(t),e&&(t.tile=this),t}removeChild(t,e=!0){var i;(i=this.children.indexOf(t))>-1&&this.children.splice(i,1),e&&t.tile===this&&(t.tile=null)}dist(t){var e,i,r,n;return null!=(null!=t?t.getFinalTile:null)&&(t=t.getFinalTile()),null==(null!=t?t.x:null)||null==t.y||null==this.x||null==this.y||this.container!==t.container&&!(e=null!=(i=this.container)&&"function"==typeof i.dist?i.dist(t.container):null)?null:(r=t.x-this.x,n=t.y-this.y,e&&(r+=e.x,n+=e.y),{x:r,y:n,length:Math.sqrt(r*r+n*n)})}copyAndRotate(t,e={x:0,y:0}){return new(0,this.constructor)(Object.assign(this.propertiesManager.getManualDataProperties(),a.rotate(this,t,e)))}getFinalTile(){return this}getCoord(){return{x:this.x,y:this.y}}}Tile.properties({children:{collection:!0},container:{change:function(){if(null!=this.container)return this.adjacentTiles.forEach(function(t){return t.adjacentTilesProperty.invalidate()})}},adjacentTiles:{calcul:function(t){if(t.prop(this.containerProperty))return n.adjacents.map(t=>this.getRelativeTile(t.x,t.y)).filter(t=>null!=t)},collection:!0}}),e.exports=Tile},{"./CoordHelper":112,"./Direction":113,"spark-starter":127}],115:[function(t,e,i){const r=t("spark-starter").Element,n=t("./TileReference");class TileContainer extends r{_addToBondaries(t,e){(null==e.top||t.y<e.top)&&(e.top=t.y),(null==e.left||t.x<e.left)&&(e.left=t.x),(null==e.bottom||t.y>e.bottom)&&(e.bottom=t.y),(null==e.right||t.x>e.right)&&(e.right=t.x)}init(){this.coords={},this.tiles=[]}addTile(t){return this.tiles.includes(t)||(this.tiles.push(t),null==this.coords[t.x]&&(this.coords[t.x]={}),this.coords[t.x][t.y]=t,this.owner&&(t.container=this),this.boundariesProperty.getter.calculated&&this._addToBondaries(t,this.boundariesProperty.value)),this}removeTile(t){var e;if((e=this.tiles.indexOf(t))>-1&&(this.tiles.splice(e,1),delete this.coords[t.x][t.y],this.owner&&(t.container=null),this.boundariesProperty.getter.calculated&&(this.boundaries.top===t.y||this.boundaries.bottom===t.y||this.boundaries.left===t.x||this.boundaries.right===t.x)))return this.boundariesProperty.invalidate()}removeTileAt(t,e){const i=this.getTile(t,e);if(i)return this.removeTile(i)}getTile(t,e){var i;if(null!=(null!=(i=this.coords[t])?i[e]:null))return this.coords[t][e]}loadMatrix(t,e={x:0,y:0}){var i,r,n,a,s;for(s in t)for(a in r=t[s])n=r[a],i={x:parseInt(a)+e.x,y:parseInt(s)+e.y},"function"==typeof n?this.addTile(n(i)):(n.x=i.x,n.y=i.y,this.addTile(n));return this}reduceMatrix(t,e=null,i={x:0,y:0}){let r=e;for(const e in t){const n=t[e];for(const t in n){const a=n[t],s={x:parseInt(t)+i.x,y:parseInt(e)+i.y};r=a(r,this.getTile(s.x,s.y),s)}}return r}inRange(t,e){var i,r,n,a,s,o,l,c,p,h;for(c=[],e--,p=r=a=t.x-e,s=t.x+e;a<=s?r<=s:r>=s;p=a<=s?++r:--r)for(h=n=o=t.y-e,l=t.y+e;o<=l?n<=l:n>=l;h=o<=l?++n:--n)Math.sqrt((p-t.x)*(p-t.x)+(h-t.y)*(h-t.y))<=e&&null!=(i=this.getTile(p,h))&&c.push(i);return c}allTiles(){return this.tiles.slice()}clearAll(){var t,e,i;if(this.owner)for(t=0,e=(i=this.tiles).length;t<e;t++)i[t].container=null;return this.coords={},this.tiles=[],this}closest(t,e){var i,r;return r=function(e){return null==e.score&&(e.score=e.getFinalTile().dist(t).length),e.score},(i=this.tiles.filter(e).map(t=>new n(t))).sort((t,e)=>r(t)-r(e)),i.length>0?i[0].tile:null}copy(){var t;return(t=new TileContainer).coords=this.coords,t.tiles=this.tiles,t.owner=!1,t}merge(t,e,i=!1){var r,n;return(r=new TileContainer).owner=i,n=t.copy(),this.tiles.forEach(function(t){var i,a;if((a=n.getTile(t.x,t.y))&&n.removeTile(a),i=e(t,a))return r.addTile(i)}),n.tiles.forEach(function(t){var i;if(i=e(null,t))return r.addTile(i)}),r}}TileContainer.properties({owner:{default:!0},boundaries:{calcul:function(){var t;return t={top:null,left:null,bottom:null,right:null},this.tiles.forEach(e=>this._addToBondaries(e,t)),t},output:function(t){return Object.assign({},t)}}}),e.exports=TileContainer},{"./TileReference":116,"spark-starter":127}],116:[function(t,e,i){e.exports=class TileReference{constructor(t){this.tile=t,Object.defineProperties(this,{x:{get:()=>this.getFinalTile().x},y:{get:()=>this.getFinalTile().y}})}getFinalTile(){return this.tile.getFinalTile()}}},{}],117:[function(t,e,i){const r=t("spark-starter").Element;class Tiled extends r{putOnRandomTile(t){var e;(e=this.getRandomValidTile(t))&&(this.tile=e)}getRandomValidTile(t,e=this.canGoOnTile.bind(this)){var i,r,n;for(n=t.slice();n.length>0;)if(r=Math.floor(Math.random()*n.length),e(i=n.splice(r,1)[0]))return i;return null}canGoOnTile(t){return!0}getFinalTile(){return this.tile.getFinalTile()}}Tiled.properties({tile:{change:function(t,e){if(null!=e&&e.removeChild(this),this.tile)return this.tile.addChild(this)}},offsetX:{default:0},offsetY:{default:0}}),e.exports=Tiled},{"spark-starter":127}],118:[function(t,e,i){e.exports={CoordHelper:t("./CoordHelper"),Direction:t("./Direction"),Tile:t("./Tile"),TileContainer:t("./TileContainer"),TileReference:t("./TileReference"),Tiled:t("./Tiled")}},{"./CoordHelper":112,"./Direction":113,"./Tile":114,"./TileContainer":115,"./TileReference":116,"./Tiled":117}],119:[function(t,e,i){arguments[4][100][0].apply(i,arguments)},{"./Mixable":123,dup:100,"spark-properties":158}],120:[function(t,e,i){arguments[4][101][0].apply(i,arguments)},{dup:101,"spark-properties":158}],121:[function(t,e,i){arguments[4][102][0].apply(i,arguments)},{dup:102,"spark-properties":158}],122:[function(t,e,i){arguments[4][103][0].apply(i,arguments)},{"./Overrider":124,dup:103}],123:[function(t,e,i){arguments[4][104][0].apply(i,arguments)},{dup:104}],124:[function(t,e,i){arguments[4][105][0].apply(i,arguments)},{dup:105}],125:[function(t,e,i){arguments[4][106][0].apply(i,arguments)},{dup:106,"spark-binding":152}],126:[function(t,e,i){arguments[4][107][0].apply(i,arguments)},{"./Element":119,"./Invalidated/ActivablePropertyWatcher":120,"./Invalidated/Invalidated":121,"./Loader":122,"./Mixable":123,"./Overrider":124,"./Updater":125,dup:107}],127:[function(t,e,i){arguments[4][108][0].apply(i,arguments)},{"./libs":126,dup:108,"spark-binding":152,"spark-collection":156,"spark-properties":158}],128:[function(t,e,i){(function(i,r){!function(t){var i=t("undefined"!=typeof Parallelio?Parallelio:this.Parallelio);i.definition=t,null!=e?e.exports=i:"undefined"!=typeof Parallelio&&null!==Parallelio?Parallelio.Timing=i:(null==this.Parallelio&&(this.Parallelio={}),this.Parallelio.Timing=i)}(function(e){null==e&&(e={});var n,a=e.hasOwnProperty("Element")?e.Element:t("spark-starter").Element;return(n=function(){class Timing extends a{toggle(t){return void 0===t&&(t=!this.running),this.running=t}setTimeout(t,e){return new this.constructor.Timer({time:e,callback:t,timing:this})}setInterval(t,e){return new this.constructor.Timer({time:e,callback:t,repeat:!0,timing:this})}pause(){return this.toggle(!1)}unpause(){return this.toggle(!0)}}return Timing.properties({running:{default:!0}}),Timing}.call(this)).Timer=function(){class Timer extends a{toggle(t){return void 0===t&&(t=!this.paused),this.paused=t}immediateInvalidation(){if(this.running)return this.elapsedTimeProperty.invalidate({preventImmediate:!0,origin:this})}pause(){return this.toggle(!0)}unpause(){return this.toggle(!1)}start(){return this.startTime=this.constructor.now(),this.repeat?this.id=setInterval(this.tick.bind(this),this.remainingTime):this.id=setTimeout(this.tick.bind(this),this.remainingTime)}stop(){return this.remainingTime=this.time-(this.constructor.now()-this.startTime),this.repeat?clearInterval(this.id):clearTimeout(this.id)}static now(){var t;return null!=("undefined"!=typeof window&&null!==window&&null!=(t=window.performance)?t.now:void 0)?window.performance.now():null!=(null!=i?i.uptime:void 0)?1e3*i.uptime():Date.now()}tick(){return this.repetition+=1,null!=this.callback&&this.callback(),this.repeat?(this.startTime=this.constructor.now(),this.remainingTime=this.time):(this.running=!1,this.remainingTime=0)}destroy(){return this.repeat?clearInterval(this.id):clearTimeout(this.id),this.running=!1,this.propertiesManager.destroy()}}return Timer.properties({time:{default:1e3},paused:{default:!1},running:{calcul:function(t){return!t.prop(this.pausedProperty)&&!1!==t.propPath("timing.running")},change:function(t,e){return t?this.start():e?this.stop():void 0}},timing:{default:null},elapsedTime:{calcul:function(t){return t.prop(this.runningProperty)?(r(()=>this.immediateInvalidation()),this.constructor.now()-this.startTime+this.time-this.remainingTime):this.time-this.remainingTime},set:function(t){return this.running?(this.stop(),this.remainingTime=this.time-t,this.remainingTime<=0?this.tick():this.start()):(this.remainingTime=this.time-t,this.elapsedTimeProperty.invalidate())}},prc:{calcul:function(t){return t.prop(this.elapsedTimeProperty)/this.time},set:function(t){return this.elapsedTime=this.time*t}},remainingTime:{calcul:function(t){return this.time}},repeat:{default:!1},repetition:{default:0},callback:{default:null}}),Timer}.call(this),n})}).call(this,t("_process"),t("timers").setImmediate)},{_process:25,"spark-starter":185,timers:26}],129:[function(t,e,i){var r,n,a;n=t("spark-starter").Element,a=t("./SignalOperation"),r=t("spark-starter").watchers.CollectionPropertyWatcher,e.exports=function(){class Connected extends n{canConnectTo(t){return"function"==typeof t.addSignal}acceptSignal(t){return!0}onAddConnection(t){}onRemoveConnection(t){}onNewSignalType(t){}onAddSignal(t,e){}onRemoveSignal(t,e){}onRemoveSignalType(t,e){}onReplaceSignal(t,e,i){}containsSignal(t,e=!1,i){return this.signals.find(function(r){return r.match(t,e,i)})}addSignal(t,e){var i;return(null!=e?e.findLimiter(this):void 0)||(e||(e=new a,i=!0),e.addOperation(()=>{var i;if(!this.containsSignal(t,!0)&&this.acceptSignal(t)&&(i=this.containsSignal(t),this.signals.push(t),this.onAddSignal(t,e),!i))return this.onNewSignalType(t,e)}),i&&e.start()),t}removeSignal(t,e){var i;if(!(null!=e?e.findLimiter(this):void 0)&&(e||(e=new a,i=!0),e.addOperation(()=>{var i;if((i=this.containsSignal(t,!0))&&this.acceptSignal(t)&&(this.signals.splice(this.signals.indexOf(i),1),this.onRemoveSignal(t,e),e.addOperation(()=>{var i;return(i=this.containsSignal(t))?this.onReplaceSignal(t,i,e):this.onRemoveSignalType(t,e)},0)),stepByStep)return e.step()}),i))return e.start()}prepForwardedSignal(t){return t.last===this?t:t.withLast(this)}checkForwardWatcher(){if(!this.forwardWatcher)return this.forwardWatcher=new r({scope:this,property:"outputs",onAdded:function(t,e){return this.forwardedSignals.forEach(e=>this.forwardSignalTo(e,t))},onRemoved:function(t,e){return this.forwardedSignals.forEach(e=>this.stopForwardedSignalTo(e,t))}}),this.forwardWatcher.bind()}forwardSignal(t,e){var i;return this.forwardedSignals.add(t),i=this.prepForwardedSignal(t),this.outputs.forEach(function(r){if(t.last!==r)return r.addSignal(i,e)}),this.checkForwardWatcher()}forwardAllSignalsTo(t,e){return this.signals.forEach(i=>{var r;return r=this.prepForwardedSignal(i),t.addSignal(r,e)})}stopForwardedSignal(t,e){var i;return this.forwardedSignals.remove(t),i=this.prepForwardedSignal(t),this.outputs.forEach(function(r){if(t.last!==r)return r.removeSignal(i,e)})}stopAllForwardedSignalTo(t,e){return this.signals.forEach(i=>{var r;return r=this.prepForwardedSignal(i),t.removeSignal(r,e)})}forwardSignalTo(t,e,i){var r;if(r=this.prepForwardedSignal(t),t.last!==e)return e.addSignal(r,i)}stopForwardedSignalTo(t,e,i){var r;if(r=this.prepForwardedSignal(t),t.last!==e)return e.removeSignal(r,i)}}return Connected.properties({signals:{collection:!0},inputs:{collection:!0},outputs:{collection:!0},forwardedSignals:{collection:!0}}),Connected}.call(this)},{"./SignalOperation":131,"spark-starter":151}],130:[function(t,e,i){var r;r=t("spark-starter").Element,e.exports=class Signal extends r{constructor(t,e="signal",i=!1){super(),this.origin=t,this.type=e,this.exclusive=i,this.last=this.origin}withLast(t){var e;return(e=new this.__proto__.constructor(this.origin,this.type,this.exclusive)).last=t,e}copy(){var t;return(t=new this.__proto__.constructor(this.origin,this.type,this.exclusive)).last=this.last,t}match(t,e=!1,i=this.exclusive){return(!e||t.last===this.last)&&(i||t.origin===this.origin)&&t.type===this.type}}},{"spark-starter":151}],131:[function(t,e,i){var r;r=t("spark-starter").Element,e.exports=class SignalOperation extends r{constructor(){super(),this.queue=[],this.limiters=[]}addOperation(t,e=1){return e?this.queue.unshift(t):this.queue.push(t)}addLimiter(t){if(!this.findLimiter(t))return this.limiters.push(t)}findLimiter(t){return this.limiters.indexOf(t)>-1}start(){var t;for(t=[];this.queue.length;)t.push(this.step());return t}step(){var t;return 0===this.queue.length?this.done():(t=this.queue.shift(t))(this)}done(){}}},{"spark-starter":151}],132:[function(t,e,i){var r,n,a;r=t("./Connected"),n=t("./Signal"),a=t("./SignalOperation"),e.exports=function(){class SignalSource extends r{}return SignalSource.properties({activated:{change:function(){var t;return t=new a,this.activated?this.forwardSignal(this.signal,t):this.stopForwardedSignal(this.signal,t),t.start()}},signal:{calcul:function(){return new n(this,"power",!0)}}}),SignalSource}.call(this)},{"./Connected":129,"./Signal":130,"./SignalOperation":131}],133:[function(t,e,i){var r;r=t("./Connected"),e.exports=class Switch extends r{}},{"./Connected":129}],134:[function(t,e,i){var r,n,a=[].indexOf;n=t("parallelio-tiles").Tiled,t("parallelio-tiles").Direction,r=t("./Connected"),e.exports=function(){class Wire extends n{constructor(t="red"){super(),this.wireType=t}findDirectionsTo(t){return(null!=t.tiles?t.tiles.map(t=>this.tile.findDirectionOf(t)):[this.tile.findDirectionOf(t)]).filter(function(t){return null!=t})}canConnectTo(t){return r.prototype.canConnectTo.call(this,t)&&(null==t.wireType||t.wireType===this.wireType)}onNewSignalType(t,e){return this.forwardSignal(t,e)}}return Wire.extend(r),Wire.properties({outputs:{calcul:function(t){var e;return(e=t.prop(this.tileProperty))?t.prop(e.adjacentTilesProperty).reduce((e,i)=>e.concat(t.prop(i.childrenProperty).filter(t=>this.canConnectTo(t)).toArray()),[]):[]}},connectedDirections:{calcul:function(t){return t.prop(this.outputsProperty).reduce((t,e)=>(this.findDirectionsTo(e).forEach(function(e){if(a.call(t,e)<0)return t.push(e)}),t),[])}}}),Wire}.call(this)},{"./Connected":129,"parallelio-tiles":142}],135:[function(t,e,i){e.exports={Connected:t("./Connected"),Signal:t("./Signal"),SignalOperation:t("./SignalOperation"),SignalSource:t("./SignalSource"),Switch:t("./Switch"),Wire:t("./Wire")}},{"./Connected":129,"./Signal":130,"./SignalOperation":131,"./SignalSource":132,"./Switch":133,"./Wire":134}],136:[function(t,e,i){arguments[4][112][0].apply(i,arguments)},{dup:112}],137:[function(t,e,i){arguments[4][113][0].apply(i,arguments)},{"./CoordHelper":136,dup:113}],138:[function(t,e,i){arguments[4][114][0].apply(i,arguments)},{"./CoordHelper":136,"./Direction":137,dup:114,"spark-starter":151}],139:[function(t,e,i){arguments[4][115][0].apply(i,arguments)},{"./TileReference":140,dup:115,"spark-starter":151}],140:[function(t,e,i){arguments[4][116][0].apply(i,arguments)},{dup:116}],141:[function(t,e,i){arguments[4][117][0].apply(i,arguments)},{dup:117,"spark-starter":151}],142:[function(t,e,i){arguments[4][118][0].apply(i,arguments)},{"./CoordHelper":136,"./Direction":137,"./Tile":138,"./TileContainer":139,"./TileReference":140,"./Tiled":141,dup:118}],143:[function(t,e,i){arguments[4][100][0].apply(i,arguments)},{"./Mixable":147,dup:100,"spark-properties":158}],144:[function(t,e,i){arguments[4][101][0].apply(i,arguments)},{dup:101,"spark-properties":158}],145:[function(t,e,i){arguments[4][102][0].apply(i,arguments)},{dup:102,"spark-properties":158}],146:[function(t,e,i){arguments[4][103][0].apply(i,arguments)},{"./Overrider":148,dup:103}],147:[function(t,e,i){arguments[4][104][0].apply(i,arguments)},{dup:104}],148:[function(t,e,i){arguments[4][105][0].apply(i,arguments)},{dup:105}],149:[function(t,e,i){arguments[4][106][0].apply(i,arguments)},{dup:106,"spark-binding":152}],150:[function(t,e,i){arguments[4][107][0].apply(i,arguments)},{"./Element":143,"./Invalidated/ActivablePropertyWatcher":144,"./Invalidated/Invalidated":145,"./Loader":146,"./Mixable":147,"./Overrider":148,"./Updater":149,dup:107}],151:[function(t,e,i){arguments[4][108][0].apply(i,arguments)},{"./libs":150,dup:108,"spark-binding":152,"spark-collection":156,"spark-properties":158}],152:[function(t,e,i){e.exports={Binder:t("./src/Binder"),EventBind:t("./src/EventBind"),Reference:t("./src/Reference")}},{"./src/Binder":153,"./src/EventBind":154,"./src/Reference":155}],153:[function(t,e,i){e.exports=class Binder{toggleBind(t=!this.binded){return t?this.bind():this.unbind()}bind(){return!this.binded&&this.canBind()&&this.doBind(),this.binded=!0,this}canBind(){return!0}doBind(){throw new Error("Not implemented")}unbind(){return this.binded&&this.canBind()&&this.doUnbind(),this.binded=!1,this}doUnbind(){throw new Error("Not implemented")}destroy(){this.unbind()}}},{}],154:[function(t,e,i){const r=t("./Binder"),n=t("./Reference");e.exports=class EventBind extends r{constructor(t,e,i){super(),this.event=t,this.target=e,this.callback=i}canBind(){return null!=this.callback&&null!=this.target}bindTo(t){return this.unbind(),this.target=t,this.bind()}doBind(){if("function"==typeof this.target.addEventListener)return this.target.addEventListener(this.event,this.callback);if("function"==typeof this.target.addListener)return this.target.addListener(this.event,this.callback);if("function"==typeof this.target.on)return this.target.on(this.event,this.callback);throw new Error("No function to add event listeners was found")}doUnbind(){if("function"==typeof this.target.removeEventListener)return this.target.removeEventListener(this.event,this.callback);if("function"==typeof this.target.removeListener)return this.target.removeListener(this.event,this.callback);if("function"==typeof this.target.off)return this.target.off(this.event,this.callback);throw new Error("No function to remove event listeners was found")}equals(t){return null!=t&&t.constructor===this.constructor&&t.event===this.event&&n.compareVal(t.target,this.target)&&n.compareVal(t.callback,this.callback)}static checkEmitter(t,e=!0){if("function"==typeof t.addEventListener||"function"==typeof t.addListener||"function"==typeof t.on)return!0;if(e)throw new Error("No function to add event listeners was found");return!1}}},{"./Binder":153,"./Reference":155}],155:[function(t,e,i){class Reference{constructor(t){this.data=t}equals(t){return null!=t&&t.constructor===this.constructor&&this.compareData(t.data)}compareData(t){return t instanceof Reference?this.equals(t):this.data===t||null!=this.data&&null!=t&&("object"==typeof this.data&&"object"==typeof t?Object.keys(this.data).length===Object.keys(t).length&&Object.keys(t).every(e=>Reference.compareVal(this.data[e],t[e])):Reference.compareVal(this.data,t))}static compareVal(t,e){return t===e||null!=t&&null!=e&&("function"==typeof t.equals?t.equals(e):"function"==typeof e.equals?e.equals(t):!(!Array.isArray(t)||!Array.isArray(e))&&(t.length===e.length&&t.every((t,i)=>this.compareVal(t,e[i]))))}static makeReferred(t,e){return t.ref=e instanceof Reference?e:new Reference(e),t.equals=function(t){return null!=t&&this.ref.equals(t.ref)},t}}e.exports=Reference},{}],156:[function(t,e,i){e.exports=t("./src/Collection")},{"./src/Collection":157}],157:[function(t,e,i){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,i=null){return null==i&&(i=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,r){return!i(t.get(r),e)}):this.some(function(e){return!t.pluck(function(t){return i(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var i;return this._array[t]!==e&&(i=this.toArray(),this._array[t]=e,this.changed(i)),e}add(t){return this._array.includes(t)?this:this.push(t)}remove(t){var e,i;return-1!==(e=this._array.indexOf(t))&&(i=this.toArray(),this._array.splice(e,1),this.changed(i)),this}pluck(t){var e,i,r;return(i=this._array.findIndex(t))>-1?(r=this.toArray(),e=this._array[i],this._array.splice(i,1),this.changed(r),e):null}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var i;return"object"==typeof t?(i=class extends(this){},Object.assign(i.prototype,t),new i(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,i){return t[i]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["concat","filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){Collection.prototype[t]=function(...e){var i,r;return i=this.toArray(),r=this._array[t](...e),this.changed(i),r}}),Object.defineProperty(Collection.prototype,"length",{get:function(){return this.count()}}),"undefined"!=typeof Symbol&&null!==Symbol&&Symbol.iterator&&(Collection.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),e.exports=Collection},{}],158:[function(t,e,i){e.exports={Invalidator:t("./src/Invalidator"),PropertiesManager:t("./src/PropertiesManager"),Property:t("./src/Property"),getters:{BaseGetter:t("./src/getters/BaseGetter"),CalculatedGetter:t("./src/getters/CalculatedGetter"),CompositeGetter:t("./src/getters/CompositeGetter"),InvalidatedGetter:t("./src/getters/InvalidatedGetter"),ManualGetter:t("./src/getters/ManualGetter"),SimpleGetter:t("./src/getters/SimpleGetter")},setters:{BaseSetter:t("./src/setters/BaseSetter"),BaseValueSetter:t("./src/setters/BaseValueSetter"),CollectionSetter:t("./src/setters/CollectionSetter"),ManualSetter:t("./src/setters/ManualSetter"),SimpleSetter:t("./src/setters/SimpleSetter")},watchers:{CollectionPropertyWatcher:t("./src/watchers/CollectionPropertyWatcher"),PropertyWatcher:t("./src/watchers/PropertyWatcher")}}},{"./src/Invalidator":161,"./src/PropertiesManager":162,"./src/Property":163,"./src/getters/BaseGetter":164,"./src/getters/CalculatedGetter":165,"./src/getters/CompositeGetter":166,"./src/getters/InvalidatedGetter":167,"./src/getters/ManualGetter":168,"./src/getters/SimpleGetter":169,"./src/setters/BaseSetter":170,"./src/setters/BaseValueSetter":171,"./src/setters/CollectionSetter":172,"./src/setters/ManualSetter":173,"./src/setters/SimpleSetter":174,"./src/watchers/CollectionPropertyWatcher":175,"./src/watchers/PropertyWatcher":176}],159:[function(t,e,i){arguments[4][156][0].apply(i,arguments)},{"./src/Collection":160,dup:156}],160:[function(t,e,i){class Collection{constructor(t){null!=t?"function"==typeof t.toArray?this._array=t.toArray():Array.isArray(t)?this._array=t:this._array=[t]:this._array=[]}changed(){}checkChanges(t,e=!0,i=null){return null==i&&(i=function(t,e){return t===e}),t=null!=t?this.copy(t.slice()):[],this.count()!==t.length||(e?this.some(function(e,r){return!i(t.get(r),e)}):this.some(function(e){return!t.pluck(function(t){return i(e,t)})}))}get(t){return this._array[t]}getRandom(){return this._array[Math.floor(Math.random()*this._array.length)]}set(t,e){var i;return this._array[t]!==e&&(i=this.toArray(),this._array[t]=e,this.changed(i)),e}add(t){return this._array.includes(t)?this:this.push(t)}remove(t){var e,i;return-1!==(e=this._array.indexOf(t))&&(i=this.toArray(),this._array.splice(e,1),this.changed(i)),this}pluck(t){var e,i,r;return(i=this._array.findIndex(t))>-1?(r=this.toArray(),e=this._array[i],this._array.splice(i,1),this.changed(r),e):null}concat(...t){return this.copy(this._array.concat(...t.map(t=>null==t.toArray?t:t.toArray())))}toArray(){return this._array.slice()}count(){return this._array.length}static newSubClass(t,e){var i;return"object"==typeof t?(i=class extends(this){},Object.assign(i.prototype,t),new i(e)):new this(e)}copy(t){return null==t&&(t=this.toArray()),new this.constructor(t)}equals(t){return this.count()===("function"==typeof t.count?t.count():t.length)&&this.every(function(e,i){return t[i]===e})}getAddedFrom(t){return this._array.filter(function(e){return!t.includes(e)})}getRemovedFrom(t){return t.filter(t=>!this.includes(t))}}Collection.readFunctions=["every","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","some","toString"],Collection.readListFunctions=["filter","slice"],Collection.writefunctions=["pop","push","reverse","shift","sort","splice","unshift"],Collection.readFunctions.forEach(function(t){Collection.prototype[t]=function(...e){return this._array[t](...e)}}),Collection.readListFunctions.forEach(function(t){Collection.prototype[t]=function(...e){return this.copy(this._array[t](...e))}}),Collection.writefunctions.forEach(function(t){Collection.prototype[t]=function(...e){var i,r;return i=this.toArray(),r=this._array[t](...e),this.changed(i),r}}),Object.defineProperty(Collection.prototype,"length",{get:function(){return this.count()}}),"undefined"!=typeof Symbol&&null!==Symbol&&Symbol.iterator&&(Collection.prototype[Symbol.iterator]=function(){return this._array[Symbol.iterator]()}),e.exports=Collection},{}],161:[function(t,e,i){const r=t("spark-binding").Binder,n=t("spark-binding").EventBind,a=function(t,e){var i,r;return(r=t.findIndex(e))>-1?(i=t[r],t.splice(r,1),i):null};class Invalidator extends r{constructor(t,e=null){super(),this.invalidated=t,this.scope=e,this.invalidationEvents=[],this.recycled=[],this.unknowns=[],this.strict=this.constructor.strict,this.invalid=!1,this.invalidateCallback=(()=>{this.invalidate()}),this.invalidateCallback.owner=this,this.changedCallback=((t,e)=>{this.invalidate(e)}),this.changedCallback.owner=this}invalidate(t){var e;return this.invalid=!0,"function"==typeof this.invalidated?this.invalidated(t):"function"==typeof this.callback?this.callback(t):null!=this.invalidated&&"function"==typeof this.invalidated.invalidate?this.invalidated.invalidate(t):"string"==typeof this.invalidated&&(e="invalidate"+this.invalidated.charAt(0).toUpperCase()+this.invalidated.slice(1),"function"==typeof this.scope[e]?this.scope[e](t):this.scope[this.invalidated]=null),this}unknown(t){return null!=this.invalidated&&"function"==typeof this.invalidated.unknown?this.invalidated.unknown(t):this.invalidate(t)}addEventBind(t,e,i){return this.addBinder(new n(t,e,i))}addBinder(t){if(null==t.callback&&(t.callback=this.invalidateCallback),!this.invalidationEvents.some(function(e){return e.equals(t)}))return this.invalidationEvents.push(a(this.recycled,function(e){return e.equals(t)})||t)}getUnknownCallback(t){var e;return(e=(e=>this.addUnknown(function(){return t.get()},t,e))).prop=t,e.owner=this,e}addUnknown(t,e,i){if(!this.findUnknown(e))return t.prop=e,t.owner=this,this.unknowns.push(t),this.unknown(i)}findUnknown(t){if(null!=t)return this.unknowns.find(function(e){return e.prop===t})}event(t,e=this.scope){if(this.checkEmitter(e))return this.addEventBind(t,e)}value(t,e,i=this.scope){return this.event(e,i),t}prop(t){if(null!=t)return this.addEventBind("invalidated",t.events,this.getUnknownCallback(t)),this.addEventBind("updated",t.events,this.changedCallback),t.get()}propByName(t,e=this.scope){if(null!=e.propertiesManager){const i=e.propertiesManager.getProperty(t);if(i)return this.prop(i)}return null!=e[t+"Property"]?this.prop(e[t+"Property"]):e[t]}propPath(t,e=this.scope){var i,r;for(t=t.split("."),r=e;null!=r&&t.length>0;)i=t.shift(),r=this.propByName(i,r);return r}funct(t){var e,i;return e=new Invalidator(()=>this.addUnknown(()=>{var r;if(r=t(e),i!==r)return this.invalidate()},e)),i=t(e),this.invalidationEvents.push(e),i}validateUnknowns(){return this.unknowns.slice().forEach(function(t){t()}),this.unknowns=[],this}isEmpty(){return 0===this.invalidationEvents.length}bind(){return this.invalid=!1,this.invalidationEvents.forEach(function(t){t.bind()}),this}recycle(t){var e,i;return this.recycled=this.invalidationEvents,this.invalidationEvents=[],e=this.endRecycle.bind(this),"function"==typeof t?t.length>1?t(this,e):(i=t(this),e(),i):e}endRecycle(){return this.recycled.forEach(function(t){return t.unbind()}),this.recycled=[],this}checkEmitter(t){return n.checkEmitter(t,this.strict)}checkPropInstance(t){return"function"==typeof t.get&&this.checkEmitter(t.events)}unbind(){return this.invalidationEvents.forEach(function(t){t.unbind()}),this}}Invalidator.strict=!0,e.exports=Invalidator},{"spark-binding":152}],162:[function(t,e,i){const r=t("./Property");e.exports=class PropertiesManager{constructor(t={},e={}){this.properties=[],this.globalOptions=Object.assign({initWatchers:!1},e),this.propertiesOptions=Object.assign({},t)}copyWith(t={},e={}){return new this.constructor(this.mergePropertiesOptions(this.propertiesOptions,t),Object.assign({},this.globalOptions,e))}withProperty(t,e){const i={};return i[t]=e,this.copyWith(i)}useScope(t){return this.copyWith({},{scope:t})}mergePropertiesOptions(...t){return t.reduce((t,e)=>(Object.keys(e).forEach(i=>{t[i]=this.mergePropertyOptions(t[i]||{},e[i])}),t),{})}mergePropertyOptions(...t){const e=["default","scope"];return t.reduce((t,i)=>(Object.keys(i).forEach(r=>{"function"!=typeof t[r]||"function"!=typeof i[r]||e.includes(r)?t[r]=i[r]:t[r]=this.mergeCallback(t[r],i[r])}),t),{})}mergeCallback(t,e){const i=function(...i){return e.call(this,...i,t.bind(this))};return i.components=(t.components||[t]).concat(t.newFunct||[e]),i.nbParams=e.nbParams||e.length,i}initProperties(){return this.addProperties(this.propertiesOptions),this}createScopeGetterSetters(){return this.properties.forEach(t=>t.createScopeGetterSetters()),this}initWatchers(){return this.properties.forEach(t=>t.initWatchers()),this}initScope(){return this.initProperties(),this.createScopeGetterSetters(),this.initWatchers(),this}addProperty(t,e){const i=new r(Object.assign({name:t},this.globalOptions,e));return this.properties.push(i),i}addProperties(t){return Object.keys(t).forEach(e=>this.addProperty(e,t[e])),this}getProperty(t){return this.properties.find(e=>e.options.name===t)}setPropertiesData(t,e={}){return Object.keys(t).forEach(i=>{if(!(null!=e.whitelist&&-1===e.whitelist.indexOf(i)||null!=e.blacklist&&-1!==e.blacklist.indexOf(i))){const e=this.getProperty(i);e&&e.set(t[i])}}),this}getManualDataProperties(){return this.properties.reduce((t,e)=>(e.getter.calculated&&e.manual&&(t[e.options.name]=e.get()),t),{})}destroy(){this.properties.forEach(t=>t.destroy())}}},{"./Property":163}],163:[function(t,e,i){const r=t("events").EventEmitter,n=t("./getters/SimpleGetter"),a=t("./getters/CalculatedGetter"),s=t("./getters/InvalidatedGetter"),o=t("./getters/ManualGetter"),l=t("./getters/CompositeGetter"),c=t("./setters/ManualSetter"),p=t("./setters/SimpleSetter"),h=t("./setters/BaseValueSetter"),u=t("./setters/CollectionSetter");class Property{constructor(t={}){this.options=Object.assign({},Property.defaultOptions,t),this.init()}init(){this.events=new this.options.EventEmitterClass,this.makeSetter(),this.makeGetter(),this.setter.init(),this.getter.init(),this.options.initWatchers&&this.initWatchers()}getQualifiedName(){if(this.options.name){let t=this.options.name;return this.options.scope&&this.options.scope.constructor&&(t=this.options.scope.constructor.name+"."+t),t}}toString(){const t=this.getQualifiedName();return t?`[Property ${t}]`:"[Property]"}initWatchers(){this.setter.loadInternalWatcher()}makeGetter(){"function"==typeof this.options.get?this.getter=new o(this):null!=this.options.composed&&!1!==this.options.composed?this.getter=new l(this):"function"==typeof this.options.calcul?0===(this.options.calcul.nbParams||this.options.calcul.length)?this.getter=new a(this):this.getter=new s(this):this.getter=new n(this)}makeSetter(){"function"==typeof this.options.set?this.setter=new c(this):null!=this.options.collection&&!1!==this.options.collection?this.setter=new u(this):null!=this.options.composed&&!1!==this.options.composed?this.setter=new h(this):this.setter=new p(this)}copyWith(t){return new this.constructor(Object.assign({},this.options,t))}get(){return this.getter.get()}invalidate(t){return this.getter.invalidate(t),this}unknown(t){return this.getter.unknown(t),this}set(t){return this.setter.set(t)}createScopeGetterSetters(){if(this.options.scope){const t=this;let e={};e[this.options.name+"Property"]={get:function(){return t}},e=this.getter.getScopeGetterSetters(e),e=this.setter.getScopeGetterSetters(e),Object.defineProperties(this.options.scope,e)}return this}destroy(){!0===this.options.destroy&&null!=this.value&&null!=this.value.destroy&&this.value.destroy(),"function"==typeof this.options.destroy&&this.callOptionFunct("destroy",this.value),this.getter.destroy(),this.value=null}callOptionFunct(t,...e){return"string"==typeof t&&(t=this.options[t]),t.apply(this.options.scope||this,e)}}Property.defaultOptions={EventEmitterClass:r,initWatchers:!0},e.exports=Property},{"./getters/CalculatedGetter":165,"./getters/CompositeGetter":166,"./getters/InvalidatedGetter":167,"./getters/ManualGetter":168,"./getters/SimpleGetter":169,"./setters/BaseValueSetter":171,"./setters/CollectionSetter":172,"./setters/ManualSetter":173,"./setters/SimpleSetter":174,events:24}],164:[function(t,e,i){e.exports=class BaseGetter{constructor(t){this.prop=t}init(){this.calculated=!1,this.initiated=!1,this.invalidated=!1}get(){throw new Error("Not implemented")}output(){return"function"==typeof this.prop.options.output?this.prop.callOptionFunct("output",this.prop.value):this.prop.value}revalidated(){return this.calculated=!0,this.initiated=!0,this.invalidated=!1,this}unknown(t){return this.invalidated||(this.invalidated=!0,this.invalidateNotice(t)),this}invalidate(t){return this.calculated=!1,this.invalidated||(this.invalidated=!0,this.invalidateNotice(t)),this}invalidateNotice(t){t=t||{origin:this.prop},this.prop.events.emit("invalidated",t)}getScopeGetterSetters(t){const e=this.prop;return t[this.prop.options.name]=t[this.prop.options.name]||{},t[this.prop.options.name].get=function(){return e.get()},t[this.prop.options.name].enumerable=!0,t[this.prop.options.name].configurable=!0,t}destroy(){}}},{}],165:[function(t,e,i){const r=t("./BaseGetter");e.exports=class CalculatedGetter extends r{get(){if(!this.calculated){const t=this.prop.value,e=this.initiated;this.calcul(),e?this.prop.setter.checkChanges(this.prop.value,t)&&this.prop.setter.changed(t):this.prop.events.emit("updated",t)}return this.invalidated=!1,this.output()}calcul(){return this.prop.setter.setRawValue(this.prop.callOptionFunct("calcul")),this.prop.manual=!1,this.revalidated(),this.prop.value}}},{"./BaseGetter":164}],166:[function(t,e,i){const r=t("./InvalidatedGetter"),n=t("spark-collection"),a=t("../Invalidator"),s=t("spark-binding").Reference;class CompositeGetter extends r{init(){super.init(),null!=this.prop.options.default?this.baseValue=this.prop.options.default:(this.prop.setter.setRawValue(null),this.baseValue=null),this.members=new CompositeGetter.Members(this.prop.options.members),null!=this.prop.options.calcul&&this.members.unshift((t,e)=>this.prop.options.calcul.bind(this.prop.options.scope)(e)),this.members.changed=(t=>this.invalidate()),this.prop.members=this.members,this.join=this.guessJoinFunction()}guessJoinFunction(){return"function"==typeof this.prop.options.composed?this.prop.options.composed:"string"==typeof this.prop.options.composed&&null!=CompositeGetter.joinFunctions[this.prop.options.composed]?CompositeGetter.joinFunctions[this.prop.options.composed]:null!=this.prop.options.collection&&!1!==this.prop.options.collection?CompositeGetter.joinFunctions.concat:!1===this.prop.options.default?CompositeGetter.joinFunctions.or:!0===this.prop.options.default?CompositeGetter.joinFunctions.and:CompositeGetter.joinFunctions.last}calcul(){return this.members.length?(this.invalidator||(this.invalidator=new a(this.prop,this.prop.options.scope)),this.invalidator.recycle((t,e)=>{this.prop.setter.setRawValue(this.members.reduce((t,e)=>{var i;return i="function"==typeof e?e(t,this.invalidator):e,this.join(t,i)},this.baseValue)),e(),t.isEmpty()?this.invalidator=null:t.bind()})):this.prop.setter.setRawValue(this.baseValue),this.revalidated(),this.prop.value}getScopeGetterSetters(t){t=super.getScopeGetterSetters(t);const e=this.members;return t[this.prop.options.name+"Members"]={get:function(){return e}},t}}CompositeGetter.joinFunctions={and:function(t,e){return t&&e},or:function(t,e){return t||e},last:function(t,e){return e},sum:function(t,e){return t+e},concat:function(t,e){return null==t?t=[]:(null!=t.toArray&&(t=t.toArray()),null==t.concat&&(t=[t])),null==e?e=[]:(null!=e.toArray&&(e=e.toArray()),null==e.concat&&(e=[e])),t.concat(e)}},CompositeGetter.Members=class Members extends n{addProperty(t){return-1===this.findRefIndex(null,t)&&this.push(s.makeReferred(function(e,i){return i.prop(t)},{prop:t})),this}addPropertyPath(t,e){return-1===this.findRefIndex(t,e)&&this.push(s.makeReferred(function(i,r){return r.propPath(t,e)},{name:t,obj:e})),this}removeProperty(t){return this.removeRef({prop:t}),this}addValueRef(t,e){if(-1===this.findRefIndex(e)){const i=s.makeReferred(function(e,i){return t},e);i.val=t,this.push(i)}return this}setValueRef(t,e){const i=this.findRefIndex(e);if(-1===i)this.addValueRef(t,e);else if(this.get(i).val!==t){const r=s.makeReferred(function(e,i){return t},e);r.val=t,this.set(i,r)}return this}getValueRef(t){return this.findByRef(t).val}addFunctionRef(t,e){return-1===this.findRefIndex(e)&&(t=s.makeReferred(t,e),this.push(t)),this}findByRef(t){return this._array[this.findRefIndex(t)]}findRefIndex(t){return this._array.findIndex(function(e){return null!=e.ref&&e.ref.compareData(t)})}removeRef(t){var e,i;return-1!==(e=this.findRefIndex(t))&&(i=this.toArray(),this._array.splice(e,1),this.changed(i)),this}},e.exports=CompositeGetter},{"../Invalidator":161,"./InvalidatedGetter":167,"spark-binding":152,"spark-collection":159}],167:[function(t,e,i){const r=t("../Invalidator"),n=t("./CalculatedGetter");e.exports=class InvalidatedGetter extends n{get(){return this.invalidator&&this.invalidator.validateUnknowns(),super.get()}calcul(){return this.invalidator||(this.invalidator=new r(this.prop,this.prop.options.scope)),this.invalidator.recycle((t,e)=>{this.prop.setter.setRawValue(this.prop.callOptionFunct("calcul",t)),this.prop.manual=!1,e(),t.isEmpty()?this.invalidator=null:t.bind()}),this.revalidated(),this.output()}invalidate(t){return super.invalidate(t),this.calculated||null==this.invalidator||this.invalidator.unbind(),this}destroy(){if(null!=this.invalidator)return this.invalidator.unbind()}}},{"../Invalidator":161,"./CalculatedGetter":165}],168:[function(t,e,i){const r=t("./BaseGetter");e.exports=class ManualGetter extends r{get(){return this.prop.setter.setRawValue(this.prop.callOptionFunct("get")),this.calculated=!0,this.initiated=!0,this.output()}}},{"./BaseGetter":164}],169:[function(t,e,i){const r=t("./BaseGetter");e.exports=class SimpleGetter extends r{get(){return this.calculated=!0,this.initiated||(this.initiated=!0,this.prop.events.emit("updated")),this.output()}}},{"./BaseGetter":164}],170:[function(t,e,i){const r=t("../watchers/PropertyWatcher");e.exports=class BaseSetter{constructor(t){this.prop=t}init(){this.setDefaultValue()}setDefaultValue(){this.setRawValue(this.ingest(this.prop.options.default))}loadInternalWatcher(){const t=this.prop.options.change;return"function"==typeof t?this.watcher=new r({property:this.prop,callback:t,scope:this.prop.options.scope,autoBind:!0}):null!=t&&"function"==typeof t.copyWith&&(this.watcher=t.copyWith({property:this.prop,scope:this.prop.options.scope,autoBind:!0})),this.watcher}set(t){throw new Error("Not implemented")}setRawValue(t){return this.prop.value=t,this.prop.value}ingest(t){return"function"==typeof this.prop.options.ingest&&(t=this.prop.callOptionFunct("ingest",t)),t}checkChanges(t,e){return t!==e}changed(t){const e={origin:this.prop};return this.prop.events.emit("updated",t,e),this.prop.events.emit("changed",t,e),this}getScopeGetterSetters(t){const e=this.prop;return t[this.prop.options.name]=t[this.prop.options.name]||{},t[this.prop.options.name].set=function(t){return e.set(t)},t}}},{"../watchers/PropertyWatcher":176}],171:[function(t,e,i){const r=t("./BaseSetter");e.exports=class BaseValueSetter extends r{set(t){return t=this.ingest(t),this.prop.getter.baseValue!==t&&(this.prop.getter.baseValue=t,this.prop.invalidate()),this}}},{"./BaseSetter":170}],172:[function(t,e,i){const r=t("./SimpleSetter"),n=t("spark-collection"),a=t("../watchers/CollectionPropertyWatcher");class CollectionSetter extends r{init(){this.options=Object.assign({},CollectionSetter.defaultOptions,"object"==typeof this.prop.options.collection?this.prop.options.collection:{}),super.init()}loadInternalWatcher(){if("function"==typeof this.prop.options.change||"function"==typeof this.prop.options.itemAdded||"function"==typeof this.prop.options.itemRemoved)return new a({property:this.prop,callback:this.prop.options.change,onAdded:this.prop.options.itemAdded,onRemoved:this.prop.options.itemRemoved,scope:this.prop.options.scope,autoBind:!0});super.loadInternalWatcher()}setRawValue(t){return this.prop.value=this.makeCollection(t),this.prop.value}makeCollection(t){t=this.valToArray(t);const e=this.prop,i=n.newSubClass(this.options,t);return i.changed=function(t){e.setter.changed(t)},i}valToArray(t){return null==t?[]:"function"==typeof t.toArray?t.toArray():Array.isArray(t)?t.slice():[t]}checkChanges(t,e){var i;return"function"==typeof this.options.compare&&(i=this.options.compare),new n(t).checkChanges(e,this.options.ordered,i)}}CollectionSetter.defaultOptions={compare:!1,ordered:!0},e.exports=CollectionSetter},{"../watchers/CollectionPropertyWatcher":175,"./SimpleSetter":174,"spark-collection":159}],173:[function(t,e,i){const r=t("./BaseSetter");e.exports=class ManualSetter extends r{set(t){this.prop.callOptionFunct("set",t)}}},{"./BaseSetter":170}],174:[function(t,e,i){const r=t("./BaseSetter");e.exports=class SimpleSetter extends r{set(t){var e;return t=this.ingest(t),this.prop.getter.revalidated(),this.checkChanges(t,this.prop.value)&&(e=this.prop.value,this.setRawValue(t),this.prop.manual=!0,this.changed(e)),this}}},{"./BaseSetter":170}],175:[function(t,e,i){const r=t("./PropertyWatcher");e.exports=class CollectionPropertyWatcher extends r{loadOptions(t){super.loadOptions(t),this.onAdded=t.onAdded,this.onRemoved=t.onRemoved}handleChange(t,e){if(e=t.copy(e||[]),"function"==typeof this.callback&&this.callback.call(this.scope,t,e),"function"==typeof this.onAdded&&t.forEach((t,i)=>{if(!e.includes(t))return this.onAdded.call(this.scope,t)}),"function"==typeof this.onRemoved)return e.forEach((e,i)=>{if(!t.includes(e))return this.onRemoved.call(this.scope,e)})}}},{"./PropertyWatcher":176}],176:[function(t,e,i){const r=t("spark-binding").Binder,n=t("spark-binding").Reference;e.exports=class PropertyWatcher extends r{constructor(t){super(),this.options=t,this.invalidateCallback=(t=>{this.validContext(t)&&this.invalidate()}),this.updateCallback=((t,e)=>{this.validContext(e)&&this.update(t)}),null!=this.options&&this.loadOptions(this.options),this.init()}loadOptions(t){return this.scope=t.scope,this.property=t.property,this.callback=t.callback,this.autoBind=t.autoBind,this}copyWith(t){return new this.constructor(Object.assign({},this.options,t))}init(){if(this.autoBind)return this.checkBind()}getProperty(){return"string"==typeof this.property?this.getPropByName(this.property):this.property}getPropByName(t,e=this.scope){if(null!=e.propertiesManager)return e.propertiesManager.getProperty(t);if(null!=e[t+"Property"])return e[t+"Property"];throw new Error(`Could not find the property ${t}`)}checkBind(){return this.toggleBind(this.shouldBind())}shouldBind(){return!0}canBind(){return null!=this.getProperty()}doBind(){return this.update(),this.getProperty().events.addListener("invalidated",this.invalidateCallback),this.getProperty().events.addListener("updated",this.updateCallback)}doUnbind(){return this.getProperty().events.removeListener("invalidated",this.invalidateCallback),this.getProperty().events.removeListener("updated",this.updateCallback)}equals(t){return t.constructor===this.constructor&&null!=t&&t.event===this.event&&t.getProperty()===this.getProperty()&&n.compareVal(t.callback,this.callback)}validContext(t){return null==t||!t.preventImmediate}invalidate(){return this.getProperty().get()}update(t){var e;return e=this.getProperty().get(),this.handleChange(e,t)}handleChange(t,e){return this.callback.call(this.scope,t,e)}}},{"spark-binding":152}],177:[function(t,e,i){arguments[4][100][0].apply(i,arguments)},{"./Mixable":181,dup:100,"spark-properties":158}],178:[function(t,e,i){arguments[4][101][0].apply(i,arguments)},{dup:101,"spark-properties":158}],179:[function(t,e,i){arguments[4][102][0].apply(i,arguments)},{dup:102,"spark-properties":158}],180:[function(t,e,i){arguments[4][103][0].apply(i,arguments)},{"./Overrider":182,dup:103}],181:[function(t,e,i){arguments[4][104][0].apply(i,arguments)},{dup:104}],182:[function(t,e,i){arguments[4][105][0].apply(i,arguments)},{dup:105}],183:[function(t,e,i){arguments[4][106][0].apply(i,arguments)},{dup:106,"spark-binding":152}],184:[function(t,e,i){arguments[4][107][0].apply(i,arguments)},{"./Element":177,"./Invalidated/ActivablePropertyWatcher":178,"./Invalidated/Invalidated":179,"./Loader":180,"./Mixable":181,"./Overrider":182,"./Updater":183,dup:107}],185:[function(t,e,i){arguments[4][108][0].apply(i,arguments)},{"./libs":184,dup:108,"spark-binding":152,"spark-collection":156,"spark-properties":158}],186:[function(t,e,i){arguments[4][100][0].apply(i,arguments)},{"./Mixable":190,dup:100,"spark-properties":201}],187:[function(t,e,i){arguments[4][101][0].apply(i,arguments)},{dup:101,"spark-properties":201}],188:[function(t,e,i){arguments[4][102][0].apply(i,arguments)},{dup:102,"spark-properties":201}],189:[function(t,e,i){arguments[4][103][0].apply(i,arguments)},{"./Overrider":191,dup:103}],190:[function(t,e,i){arguments[4][104][0].apply(i,arguments)},{dup:104}],191:[function(t,e,i){arguments[4][105][0].apply(i,arguments)},{dup:105}],192:[function(t,e,i){arguments[4][106][0].apply(i,arguments)},{dup:106,"spark-binding":195}],193:[function(t,e,i){arguments[4][107][0].apply(i,arguments)},{"./Element":186,"./Invalidated/ActivablePropertyWatcher":187,"./Invalidated/Invalidated":188,"./Loader":189,"./Mixable":190,"./Overrider":191,"./Updater":192,dup:107}],194:[function(t,e,i){arguments[4][108][0].apply(i,arguments)},{"./libs":193,dup:108,"spark-binding":195,"spark-collection":199,"spark-properties":201}],195:[function(t,e,i){arguments[4][152][0].apply(i,arguments)},{"./src/Binder":196,"./src/EventBind":197,"./src/Reference":198,dup:152}],196:[function(t,e,i){arguments[4][153][0].apply(i,arguments)},{dup:153}],197:[function(t,e,i){arguments[4][154][0].apply(i,arguments)},{"./Binder":196,"./Reference":198,dup:154}],198:[function(t,e,i){arguments[4][155][0].apply(i,arguments)},{dup:155}],199:[function(t,e,i){arguments[4][156][0].apply(i,arguments)},{"./src/Collection":200,dup:156}],200:[function(t,e,i){arguments[4][157][0].apply(i,arguments)},{dup:157}],201:[function(t,e,i){arguments[4][158][0].apply(i,arguments)},{"./src/Invalidator":204,"./src/PropertiesManager":205,"./src/Property":206,"./src/getters/BaseGetter":207,"./src/getters/CalculatedGetter":208,"./src/getters/CompositeGetter":209,"./src/getters/InvalidatedGetter":210,"./src/getters/ManualGetter":211,"./src/getters/SimpleGetter":212,"./src/setters/BaseSetter":213,"./src/setters/BaseValueSetter":214,"./src/setters/CollectionSetter":215,"./src/setters/ManualSetter":216,"./src/setters/SimpleSetter":217,"./src/watchers/CollectionPropertyWatcher":218,"./src/watchers/PropertyWatcher":219,dup:158}],202:[function(t,e,i){arguments[4][156][0].apply(i,arguments)},{"./src/Collection":203,dup:156}],203:[function(t,e,i){arguments[4][160][0].apply(i,arguments)},{dup:160}],204:[function(t,e,i){arguments[4][161][0].apply(i,arguments)},{dup:161,"spark-binding":195}],205:[function(t,e,i){arguments[4][162][0].apply(i,arguments)},{"./Property":206,dup:162}],206:[function(t,e,i){arguments[4][163][0].apply(i,arguments)},{"./getters/CalculatedGetter":208,"./getters/CompositeGetter":209,"./getters/InvalidatedGetter":210,"./getters/ManualGetter":211,"./getters/SimpleGetter":212,"./setters/BaseValueSetter":214,"./setters/CollectionSetter":215,"./setters/ManualSetter":216,"./setters/SimpleSetter":217,dup:163,events:24}],207:[function(t,e,i){arguments[4][164][0].apply(i,arguments)},{dup:164}],208:[function(t,e,i){arguments[4][165][0].apply(i,arguments)},{"./BaseGetter":207,dup:165}],209:[function(t,e,i){arguments[4][166][0].apply(i,arguments)},{"../Invalidator":204,"./InvalidatedGetter":210,dup:166,"spark-binding":195,"spark-collection":202}],210:[function(t,e,i){arguments[4][167][0].apply(i,arguments)},{"../Invalidator":204,"./CalculatedGetter":208,dup:167}],211:[function(t,e,i){arguments[4][168][0].apply(i,arguments)},{"./BaseGetter":207,dup:168}],212:[function(t,e,i){arguments[4][169][0].apply(i,arguments)},{"./BaseGetter":207,dup:169}],213:[function(t,e,i){arguments[4][170][0].apply(i,arguments)},{"../watchers/PropertyWatcher":219,dup:170}],214:[function(t,e,i){arguments[4][171][0].apply(i,arguments)},{"./BaseSetter":213,dup:171}],215:[function(t,e,i){arguments[4][172][0].apply(i,arguments)},{"../watchers/CollectionPropertyWatcher":218,"./SimpleSetter":217,dup:172,"spark-collection":202}],216:[function(t,e,i){arguments[4][173][0].apply(i,arguments)},{"./BaseSetter":213,dup:173}],217:[function(t,e,i){arguments[4][174][0].apply(i,arguments)},{"./BaseSetter":213,dup:174}],218:[function(t,e,i){arguments[4][175][0].apply(i,arguments)},{"./PropertyWatcher":219,dup:175}],219:[function(t,e,i){arguments[4][176][0].apply(i,arguments)},{dup:176,"spark-binding":195}]},{},[23])(23)});