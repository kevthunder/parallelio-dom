(function(){var t,e,i,n,r,l,o,a,s,u,p,c,y=function(t,e){function i(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;e={},"undefined"!=typeof module&&null!==module?module.exports=e:this.Parallelio.DOM=e,n=(null!=(s=this.Parallelio)?s.Element:void 0)||require("spark-starter").Element,a=function(t){function e(t){this.display=null!=t?t:null,this.hovered=!1,this.keysInterval={}}return y(e,t),e.directionkeys={38:{name:"top",x:0,y:-1},39:{name:"right",x:1,y:0},40:{name:"bottom",x:0,y:1},37:{name:"left",x:-1,y:0}},e.properties({x:{default:0,change:function(){return this.updateDisplayPos()}},y:{default:0,change:function(){return this.updateDisplayPos()}},display:{change:function(){return 0===$(".viewContent",this.display).length&&$(this.display).append('<div class="viewContent"></div>'),this.updateDisplayPos(),$(this.display).mouseenter(this.callback("mouseEnter")),$(this.display).mouseleave(this.callback("mouseLeave"))}}}),e.prototype.mouseEnter=function(){return this.hovered=!0,$("body").keydown(this.callback("keyDown")),$("body").keyup(this.callback("keyUp"))},e.prototype.mouseLeave=function(){var t,e,i,n;this.hovered=!1,$("body").off("keydown",this.callback("keyDown")),$("body").off("keyup",this.callback("keyUp")),i=this.keysInterval,n=[];for(t in i)e=i[t],n.push(clearInterval(e));return n},e.prototype.keyDown=function(t){var i;if(null!=e.directionkeys[t.which])return i=e.directionkeys[t.which],null!=this.keysInterval[i.name]&&clearInterval(this.keysInterval[i.name]),this.keysInterval[i.name]=setInterval(function(t){return function(){return t.x+=2*i.x,t.y+=2*i.y}}(this),10)},e.prototype.keyUp=function(t){var i;if(null!=e.directionkeys[t.which]&&(i=e.directionkeys[t.which],null!=this.keysInterval[i.name]))return clearInterval(this.keysInterval[i.name])},e.prototype.updateDisplayPos=function(){return $(".viewContent",this.display).css({left:this.x+"px",top:this.y+"px"})},e.prototype.containsPoint=function(t,e){var i;for(i=this.display[0];i;)t-=i.offsetLeft,e-=i.offsetTop,i=i.offsetParent;return 0<=t&&t<=this.display.width()&&0<=e&&e<=this.display.height()},e}(n),null!=e&&(e.View=a),t=(null!=(u=this.Parallelio)?u.Tile:void 0)||require("parallelio").Tile,l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return y(e,t),e.include(EventEmitter.prototype),e.size=20,e.prototype.init=function(){return e.__super__.init.call(this),this.containerDisplay=$("#TileContainer")},e.properties({container:{},displayContainer:{calcul:function(t){var e;return e=t.prop("container"),(null!=e?e.getProperty("tileDisplay"):void 0)?t.prop("tileDisplay",e):(null!=e?e.getProperty("display"):void 0)?t.prop("display",e):void 0},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},cls:{change:function(t){if(this.getPropertyInstance("display").calculated&&(null!=t&&this.display.removeClass(t),null!=this.cls))return this.display.addClass(this.cls)}},display:{calcul:function(){var t,e,i;return i=document.createElement("div"),e=this.getDisplayPos(),t=jQuery(i).addClass("tile").addClass(this.cls).css({top:e.y,left:e.x}),t.get(0)._parallelio_obj=this,t}}}),e.prototype.getDisplayPos=function(){return this.tileToDisplayPos(this.x,this.y)},e.prototype.tileToDisplayPos=function(t,i){return{x:t*e.size,y:i*e.size}},e}(t),null!=e&&(e.Tile=l),o=(null!=(p=this.Parallelio)?p.TileContainer:void 0)||require("parallelio").TileContainer,i=(null!=(c=this.Parallelio)?c.RoomGenerator:void 0)||require("parallelio").RoomGenerator,r={},r.Tiled=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return y(e,t),e.include(EventEmitter.prototype),e.properties({container:{},displayContainer:{calcul:function(t){var e;return e=t.prop("container"),e.display||e},change:function(){if(null!=this.displayContainer)return this.display.appendTo(this.displayContainer)}},display:{calcul:function(){var t;return t=$(document.createElement("div")).addClass("ship"),t.get(0)._parallelio_obj=this,t}}}),e.prototype.generate=function(t){return t=t||(new i).tap(function(){return this.wallFactory=function(t){return new l(t.x,t.y).tap(function(){return this.cls="wall",this.walkable=!1})},this.floorFactory=function(t){return new l(t.x,t.y).tap(function(){return this.cls="floor",this.walkable=!0})}}),t.getTiles().forEach(function(t){return function(e){return t.addTile(e)}}(this))},e}(o),null!=e&&(e.Ship=r)}).call(this);